<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- T√≠tulo e Descri√ß√£o -->
    <title>Santo Ros√°rio ¬∑ M√©todo Montfort</title>
    <meta name="description" content="Reze o Santo Ros√°rio pelo M√©todo de S√£o Lu√≠s de Montfort. App completo com medita√ß√µes, calend√°rio e acompanhamento.">
    <meta name="author" content="Seu Nome">
    
    <!-- PWA - ESSENCIAL PARA INSTALA√á√ÉO -->
    <meta name="theme-color" content="#d4a855">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ros√°rio">
    
    <!-- Manifest - OBRIGAT√ìRIO -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- √çcones - OBRIGAT√ìRIO -->
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="./icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="./icon-192.png">
    
    <!-- Startup Image para iOS -->
    <link rel="apple-touch-startup-image" href="./icon-192.png">
    
    <!-- Chrome para Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="app-mobile-web-app-status-bar-style" content="black">
    
    <!-- Microsoft -->
    <meta name="msapplication-config" content="./browserconfig.xml">
    <meta name="msapplication-TileColor" content="#080709">
    <meta name="msapplication-TileImage" content="./icon-144.png">
    
    <!-- Android -->
    <meta name="theme-color" content="#d4a855">
    <meta name="application-name" content="Ros√°rio">
    
    <!-- Seguran√ßa -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://www.gstatic.com/firebasejs https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https:">
    
    <!-- Google Fonts (Pr√©-conex√£o para melhor performance) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    
    <!-- Seus estilos -->
    <style>
        /* Coloque aqui o CSS do seu projeto */
        :root {
            --bg-deep: #080709;
            --bg-primary: #0d0b0e;
            --text-primary: #f4f1eb;
            --gold: #d4a855;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
        }
        
        body {
            background: var(--bg-deep);
            color: var(--text-primary);
            font-family: 'Cormorant Garamond', serif;
            font-size: 18px;
            line-height: 1.6;
        }
    </style>
    
    <!-- Suporte para Safe Area (notches, etc) -->
    <style>
        @supports(padding: max(0px)) {
            body {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
                padding-top: max(0px, env(safe-area-inset-top));
                padding-bottom: max(0px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>

</head>
<body>
<!-- TELA DE AUTENTICA√á√ÉO -->
<div id="auth-screen">
    <div class="auth-container">
        <div class="auth-logo"></div>
        <h1 class="auth-title">Ros√°rio</h1>
        <p class="auth-subtitle">M√©todo de S√£o Lu√≠s de Montfort</p>
        <div class="auth-info">
            ‚ú® <strong>Autentica√ß√£o Segura:</strong> Seus dados s√£o protegidos com Firebase!
        </div>
        <div class="auth-tabs">
            <button class="auth-tab active" data-tab="login" type="button">Entrar</button>
            <button class="auth-tab" data-tab="register" type="button">Criar Conta</button>
        </div>
        <form id="login-form" class="auth-form active">
            <div class="input-group">
                <label class="input-label">Nome de Usu√°rio</label>
                <input type="text" class="input-field" id="login-username" placeholder="Seu nome de usu√°rio" required autocomplete="username">
            </div>
            <div class="input-group">
                <label class="input-label">Senha</label>
                <input type="password" class="input-field" id="login-password" placeholder="Sua senha" required autocomplete="current-password">
            </div>
            <button type="submit" class="auth-btn" id="login-btn">Entrar</button>
            <div class="auth-error" id="login-error"></div>
        </form>
        <form id="register-form" class="auth-form">
            <div class="input-group">
                <label class="input-label">Nome de Usu√°rio</label>
                <input type="text" class="input-field" id="register-username" placeholder="Escolha um nome" required minlength="3" autocomplete="username">
            </div>
            <div class="input-group">
                <label class="input-label">Nome Completo</label>
                <input type="text" class="input-field" id="register-displayname" placeholder="Seu nome completo" required minlength="2" autocomplete="name">
            </div>
            <div class="input-group">
                <label class="input-label">Crie uma Senha</label>
                <input type="password" class="input-field" id="register-password" placeholder="M√≠nimo 6 caracteres" required minlength="6" autocomplete="new-password">
            </div>
            <div class="input-group">
                <label class="input-label">Confirme a Senha</label>
                <input type="password" class="input-field" id="register-confirm" placeholder="Repita a senha" required autocomplete="new-password">
            </div>
            <button type="submit" class="auth-btn" id="register-btn">Criar Conta</button>
            <div class="auth-error" id="register-error"></div>
            <div class="auth-success" id="register-success"></div>
        </form>
    </div>
</div>
<!-- APLICATIVO PRINCIPAL -->
<div id="main-app" class="hidden">
    <div class="app-content">
        <!-- TAB HOME -->
        <div id="tab-home" class="tab-content active">
            <div class="home-screen-content" style="padding: 24px;">
                <!-- Header do usu√°rio -->
                <div style="text-align: center; margin-bottom: 28px;">
                    <p style="font-family: var(--font-body); font-size: 1rem; color: var(--text-muted); margin-bottom: 4px;">
                        Bem-vindo(a),
                    </p>
                    <h2 style="font-family: var(--font-display); font-size: 1.4rem; color: var(--text-primary); letter-spacing: 0.1em;" id="home-user-name">
                        Peregrino
                    </h2>
                </div>
                <!-- Streak Card -->
                <div style="width: 100%; max-width: 360px; margin: 0 auto 24px; background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 32px 24px; text-align: center; position: relative; overflow: visible; min-height: 200px;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--gold-dim), var(--gold), var(--gold-dim));"></div>
                    <svg style="width: 50px; height: 50px; margin: 0 auto 12px; color: var(--gold);" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <div style="font-family: var(--font-display); font-size: 3.5rem; font-weight: 600; color: var(--gold); line-height: 1; text-shadow: 0 0 30px var(--gold-glow);" id="home-streak-count">0</div>
                    <div style="font-family: var(--font-display); font-size: 0.7rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--text-muted); margin-top: 8px;">Dias Consecutivos</div>
                    <p style="font-family: var(--font-body); font-size: 0.95rem; font-style: italic; color: var(--text-dim); margin-top: 12px;" id="home-streak-message">Comece hoje sua jornada de ora√ß√£o</p>
                </div>
                <!-- Inten√ß√£o do Dia -->
                <div style="width: 100%; max-width: 360px; margin: 0 auto 24px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 24px; min-height: 120px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 14px;">
                        <svg style="width: 24px; height: 24px; color: var(--burgundy-light);" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        <span style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-muted);">Inten√ß√£o do Dia</span>
                    </div>
                    <p style="font-family: var(--font-body); font-size: 1.1rem; font-style: italic; color: var(--text-secondary); line-height: 1.6;" id="home-intention">Carregando...</p>
                </div>
                <!-- Mist√©rio do Dia -->
                <div style="width: 100%; max-width: 360px; margin: 0 auto 28px; text-align: center;">
                    <p style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.3em; text-transform: uppercase; color: var(--text-dim); margin-bottom: 4px;" id="home-today-day">Segunda-feira</p>
                    <p style="font-family: var(--font-body); font-size: 1.1rem; color: var(--gold);" id="home-today-mystery">Mist√©rios Gozosos</p>
                </div>
            </div>
        </div>
        <!-- TAB ROS√ÅRIO -->
        <div id="tab-rosary" class="tab-content">
            <div style="padding: 24px 24px 100px 24px; min-height: 100%;">
                <h2 style="font-family: var(--font-display); font-size: 1.2rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-primary); text-align: center; margin-bottom: 32px;">
                    Escolha o Ros√°rio
                </h2>
                <!-- Mist√©rio do Dia -->
                <div style="width: 100%; max-width: 360px; margin: 0 auto 32px; text-align: center; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 20px;">
                    <p style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.3em; text-transform: uppercase; color: var(--text-dim); margin-bottom: 8px;" id="rosary-today-day">Segunda-feira</p>
                    <p style="font-family: var(--font-body); font-size: 1.15rem; color: var(--gold); margin-bottom: 4px;" id="rosary-today-mystery">Mist√©rios Gozosos</p>
                    <p style="font-family: var(--font-body); font-size: 0.85rem; color: var(--text-dim); font-style: italic;">Recomendado para hoje</p>
                </div>
                <!-- Bot√µes dos Mist√©rios -->
                <div style="width: 100%; max-width: 360px; margin: 0 auto;">
                    <div style="display: flex; flex-direction: column; gap: 14px;">
                        <button type="button" class="btn-mystery" onclick="app.start('gozosos')" style="padding: 20px 18px; font-size: 0.9rem; width: 100%;">
                            Mist√©rios Gozosos
                        </button>
                        <button type="button" class="btn-mystery" onclick="app.start('dolorosos')" style="padding: 20px 18px; font-size: 0.9rem; width: 100%;">
                            Mist√©rios Dolorosos
                        </button>
                        <button type="button" class="btn-mystery" onclick="app.start('gloriosos')" style="padding: 20px 18px; font-size: 0.9rem; width: 100%;">
                            Mist√©rios Gloriosos
                        </button>
                        <button type="button" class="btn-mystery btn-complete" onclick="app.start('completo')" style="padding: 24px 18px; font-size: 0.95rem; width: 100%; margin-top: 8px;">
                            Ros√°rio Completo
                            <small style="display: block; margin-top: 6px; font-size: 0.75rem; opacity: 0.8;">Gozosos, Dolorosos e Gloriosos</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- TAB CALEND√ÅRIO -->
        <div id="tab-calendar" class="tab-content">
            <div style="padding: 24px 24px 100px 24px; min-height: 100%;">
                <h2 style="font-family: var(--font-display); font-size: 1.2rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-primary); text-align: center; margin-bottom: 24px;">
                    Calend√°rio de Ora√ß√£o
                </h2>
                <!-- Inten√ß√£o do Dia no Calend√°rio -->
                <div style="width: 100%; max-width: 400px; margin: 0 auto 24px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 14px;">
                        <svg style="width: 24px; height: 24px; color: var(--burgundy-light);" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        <span style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-muted);">Inten√ß√£o do Dia</span>
                    </div>
                    <p style="font-family: var(--font-body); font-size: 1.05rem; font-style: italic; color: var(--text-secondary); line-height: 1.6;" id="calendar-intention">Carregando...</p>
                </div>
                <!-- Seletor de M√™s -->
                <div style="width: 100%; max-width: 400px; margin: 0 auto 16px; display: flex; align-items: center; justify-content: space-between;">
                    <button type="button" id="prev-month-btn" style="background: none; border: 1px solid var(--border-subtle); border-radius: 4px; padding: 8px 12px; color: var(--text-secondary); cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--gold-dim)'; this.style.color='var(--gold)';" onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.color='var(--text-secondary)';">
                        <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                    </button>
                    <h3 style="font-family: var(--font-display); font-size: 1rem; letter-spacing: 0.1em; color: var(--text-primary);" id="calendar-month-year">Janeiro 2026</h3>
                    <button type="button" id="next-month-btn" style="background: none; border: 1px solid var(--border-subtle); border-radius: 4px; padding: 8px 12px; color: var(--text-secondary); cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--gold-dim)'; this.style.color='var(--gold)';" onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.color='var(--text-secondary)';">
                        <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </button>
                </div>
                <!-- Calend√°rio Grid -->
                <div style="width: 100%; max-width: 400px; margin: 0 auto; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 16px;">
                    <!-- Dias da Semana -->
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 12px;">
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Dom</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Seg</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Ter</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Qua</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Qui</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Sex</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">S√°b</div>
                    </div>
                    <!-- Grid de Dias -->
                    <div id="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
                        <!-- Dias ser√£o inseridos via JavaScript -->
                    </div>
                </div>
                <!-- Legenda -->
                <div style="width: 100%; max-width: 400px; margin: 24px auto 0; display: flex; gap: 16px; justify-content: center; font-family: var(--font-body); font-size: 0.85rem; color: var(--text-muted);">
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--gold); box-shadow: 0 0 8px var(--gold-glow);"></div>
                        <span>Rezou</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; border: 1px solid var(--border-subtle);"></div>
                        <span>N√£o rezou</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- TAB PERFIL -->
        <div id="tab-profile" class="tab-content">
            <div style="padding: 24px 24px 100px 24px; min-height: 100%; display: flex; flex-direction: column; align-items: center;">
                <!-- Avatar e Nome -->
                <div style="text-align: center; margin-bottom: 32px;">
                    <div style="width: 80px; height: 80px; margin: 0 auto 16px; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: var(--font-display); font-size: 2rem; color: var(--bg-deep); cursor: pointer; transition: all 0.3s;" id="profile-avatar" onclick="openAvatarModal()" onmouseover="this.style.transform='scale(1.08)'; this.style.boxShadow='0 8px 25px rgba(212, 168, 85, 0.4)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                        üë§
                    </div>
                    <h2 style="font-family: var(--font-display); font-size: 1.4rem; letter-spacing: 0.1em; color: var(--text-primary); margin-bottom: 8px;" id="profile-name">
                        Usu√°rio
                    </h2>
                    <p style="font-family: var(--font-body); font-size: 0.75rem; color: var(--text-dim); font-style: italic; cursor: pointer;" onclick="openAvatarModal()">
                        Clique no avatar para alterar
                    </p>
                </div>
                <!-- Streak Card -->
                <div style="width: 100%; max-width: 360px; margin-bottom: 24px; background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 32px 24px; text-align: center; position: relative; overflow: visible; min-height: 200px;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--gold-dim), var(--gold), var(--gold-dim));"></div>
                    <svg style="width: 50px; height: 50px; margin: 0 auto 12px; color: var(--gold);" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <div style="font-family: var(--font-display); font-size: 3.5rem; font-weight: 600; color: var(--gold); line-height: 1; text-shadow: 0 0 30px var(--gold-glow);" id="profile-streak-count">0</div>
                    <div style="font-family: var(--font-display); font-size: 0.7rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--text-muted); margin-top: 8px;">Dias Consecutivos</div>
                    <p style="font-family: var(--font-body); font-size: 0.95rem; font-style: italic; color: var(--text-dim); margin-top: 12px;" id="profile-streak-message">Comece hoje sua jornada de ora√ß√£o</p>
                </div>
                <!-- Estat√≠sticas -->
                <div style="width: 100%; max-width: 360px; margin-bottom: 28px;">
                    <h3 style="font-family: var(--font-display); font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-muted); text-align: center; margin-bottom: 16px;">Estat√≠sticas</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                        <!-- Total de Ros√°rios -->
                        <div style="background: rgba(212, 168, 85, 0.05); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-family: var(--font-display); font-size: 2rem; font-weight: 600; color: var(--gold);" id="profile-total-rosaries">0</div>
                            <div style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-muted); margin-top: 4px;">Ros√°rios</div>
                        </div>
                        <!-- Maior Streak -->
                        <div style="background: rgba(212, 168, 85, 0.05); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-family: var(--font-display); font-size: 2rem; font-weight: 600; color: var(--gold);" id="profile-longest-streak">0</div>
                            <div style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-muted); margin-top: 4px;">Recorde</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <!-- Total Ave Marias -->
                        <div style="background: rgba(138, 61, 80, 0.08); border: 1px solid rgba(138, 61, 80, 0.2); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-family: var(--font-display); font-size: 2rem; font-weight: 600; color: var(--burgundy-light);" id="profile-total-aves">0</div>
                            <div style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-muted); margin-top: 4px;">Ave Marias</div>
                        </div>
                        <!-- Total Pai Nossos -->
                        <div style="background: rgba(138, 61, 80, 0.08); border: 1px solid rgba(138, 61, 80, 0.2); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-family: var(--font-display); font-size: 2rem; font-weight: 600; color: var(--burgundy-light);" id="profile-total-paters">0</div>
                            <div style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-muted); margin-top: 4px;">Pai Nossos</div>
                        </div>
                    </div>
                </div>
                <!-- Bot√£o Sair -->
                <button type="button" style="width: 100%; max-width: 300px; padding: 16px; background: linear-gradient(135deg, rgba(180, 60, 60, 0.2) 0%, rgba(180, 60, 60, 0.08) 100%); border: 1px solid rgba(180, 60, 60, 0.3); border-radius: 8px; font-family: var(--font-display); font-size: 0.8rem; letter-spacing: 0.1em; text-transform: uppercase; color: #c07070; cursor: pointer; transition: all 0.3s;" onclick="firebaseAuth.logoutUser()" onmouseover="this.style.background='rgba(180, 60, 60, 0.15)'; this.style.borderColor='rgba(180, 60, 60, 0.5)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.background='linear-gradient(135deg, rgba(180, 60, 60, 0.2) 0%, rgba(180, 60, 60, 0.08) 100%)'; this.style.borderColor='rgba(180, 60, 60, 0.3)'; this.style.transform='translateY(0)';">
                    Sair da Conta
                </button>
            </div>
        </div>
    </div>
    <!-- BOTTOM NAVIGATION -->
    <nav class="bottom-nav">
        <button type="button" class="nav-item active" data-tab="home">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
            <span class="nav-label">In√≠cio</span>
        </button>
        <button type="button" class="nav-item" id="nav-rosary-btn" data-tab="rosary">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="1.5"/>
                <circle cx="12" cy="3" r="2.5"/>
                <circle cx="19.5" cy="7.5" r="2"/>
                <circle cx="19.5" cy="16.5" r="2"/>
                <circle cx="12" cy="21" r="2.5"/>
                <circle cx="4.5" cy="16.5" r="2"/>
                <circle cx="4.5" cy="7.5" r="2"/>
            </svg>
            <span class="nav-label">Ros√°rio</span>
        </button>
        <button type="button" class="nav-item" data-tab="calendar">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <span class="nav-label">Calend√°rio</span>
        </button>
        <button type="button" class="nav-item" data-tab="profile">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
            <span class="nav-label">Perfil</span>
        </button>
    </nav>
</div>
<!-- MODAL DE SELE√á√ÉO DE AVATAR -->
<div id="avatar-modal">
    <div class="avatar-modal-content">
        <button type="button" class="avatar-modal-close" onclick="closeAvatarModal()">√ó</button>
        <h2 class="avatar-modal-title">Escolha seu Avatar</h2>
        <div class="avatar-grid" id="avatar-grid">
            <!-- Avatares ser√£o inseridos aqui via JavaScript -->
        </div>
        <button type="button" class="avatar-save-btn" id="avatar-save-btn" onclick="saveAvatar()">
            Salvar Avatar
        </button>
    </div>
</div>
<!-- TELA DE ORA√á√ÉO (sobrep√µe tudo quando ativa) -->
<div id="prayer-screen">
    <div class="rosary-rail">
        <div class="rosary-chain"></div>
        <div class="center-guide"></div>
        <div id="bead-track"></div>
    </div>
    <div class="prayer-main">
        <header class="prayer-header">
            <button class="back-btn" onclick="app.confirmExit()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                Sair
            </button>
            <div class="progress-compact">
                <div class="progress-bar-mini"><div class="progress-fill-mini" id="progress-fill"></div></div>
                <span class="progress-text" id="progress-text">1/59</span>
            </div>
        </header>
        <div class="prayer-body" id="prayer-body">
            <div class="prayer-group" id="prayer-group"></div>
            <div class="prayer-mystery" id="prayer-mystery"></div>
            <h2 class="prayer-name" id="prayer-name"></h2>
            <div class="prayer-count" id="prayer-count"></div>
            <div class="meditation-box" id="meditation-box">
                <div class="meditation-label">Medita√ß√£o</div>
                <p class="meditation-text" id="meditation-text"></p>
            </div>
            <button class="prayer-text-toggle" id="prayer-text-toggle" onclick="app.toggleText()">
                <span>Ver texto da ora√ß√£o</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M6 9l6 6 6-6"/></svg>
            </button>
            <div class="prayer-full-text" id="prayer-full-text"></div>
            <p class="nav-hint">Toque nas contas ou use as setas para navegar</p>
        </div>
        <footer class="prayer-footer">
            <button class="nav-btn" id="prev-btn" onclick="app.prev()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <button class="nav-btn primary" id="next-btn" onclick="app.next()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M9 18l6-6-6-6"/></svg>
            </button>
        </footer>
    </div>
</div>
<div id="completion-screen">
    <svg class="completion-icon" viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="50" cy="50" r="42"/>
        <path d="M28 50l16 16 28-32" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <h2 class="completion-title">Deo Gratias</h2>
    <p class="completion-subtitle" id="completion-msg"></p>
    <div class="completion-stats">
        <div class="stat"><div class="stat-value" id="stat-aves">0</div><div class="stat-label">Ave Marias</div></div>
        <div class="stat"><div class="stat-value" id="stat-paters">0</div><div class="stat-label">Pai Nossos</div></div>
    </div>
    <button class="btn-home" onclick="app.home()">Voltar ao In√≠cio</button>
</div>
<button class="audio-toggle" id="audio-toggle" onclick="app.toggleAudio()" title="Ativar/Desativar sons (M)">
    <svg id="audio-icon-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="display:none;">
        <path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
    </svg>
    <svg id="audio-icon-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M11 5L6 9H2v6h4l5 4V5z"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/>
    </svg>
</button>
<!-- Firebase SDK v9 (modular) -->
<script type="module">
import{ initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import{ getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
import{ getDatabase, ref, set, get, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
// Firebase Config
const firebaseConfig ={
    apiKey: "AIzaSyAD_SvPlYGGZM1JMZmIjfai-a3TPPKDxLg",
    authDomain: "rosario-app-a9da0.firebaseapp.com",
    databaseURL: "https://rosario-app-a9da0-default-rtdb.firebaseio.com",
    projectId: "rosario-app-a9da0",
    storageBucket: "rosario-app-a9da0.firebasestorage.app",
    messagingSenderId: "928215518242",
    appId: "1:928215518242:web:09c61bfbfc0fc947570e7b"
};
const firebaseApp = initializeApp(firebaseConfig);
const auth = getAuth(firebaseApp);
const database = getDatabase(firebaseApp);
// Converter username para email interno
function usernameToEmail(username){
    return username.toLowerCase().replace(/\s+/g, '') + '@rosario.app';
}
// Mensagens de erro em portugu√™s
function getFirebaseErrorMessage(errorCode){
    const errors ={
        'auth/email-already-in-use': 'Este nome de usu√°rio j√° est√° em uso!',
        'auth/invalid-email': 'Nome de usu√°rio inv√°lido!',
        'auth/operation-not-allowed': 'Opera√ß√£o n√£o permitida!',
        'auth/weak-password': 'Senha muito fraca! Use no m√≠nimo 6 caracteres.',
        'auth/user-disabled': 'Usu√°rio desabilitado!',
        'auth/user-not-found': 'Usu√°rio n√£o encontrado!',
        'auth/wrong-password': 'Senha incorreta!',
        'auth/invalid-credential': 'Credenciais inv√°lidas! Verifique seu usu√°rio e senha.',
        'auth/too-many-requests': 'Muitas tentativas. Aguarde um momento e tente novamente.'
    };
    return errors[errorCode] || 'Erro ao processar solicita√ß√£o. Tente novamente.';
}
function showElement(id){ document.getElementById(id).classList.add('visible');}
function hideElement(id){ document.getElementById(id).classList.remove('visible');}
function showError(id, message){
    const el = document.getElementById(id);
    el.textContent = message;
    showElement(id);
    setTimeout(() => hideElement(id), 5000);
}
function showSuccess(id, message){
    const el = document.getElementById(id);
    el.textContent = message;
    showElement(id);
}
function setButtonLoading(btnId, isLoading){
    const btn = document.getElementById(btnId);
    btn.disabled = isLoading;
    if (isLoading) btn.innerHTML = '<span class="loading"></span>';
}
// Autentica√ß√£o
async function registerUser(username, displayName, password){
    try{
        setButtonLoading('register-btn', true);
        const email = usernameToEmail(username);
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        await set(ref(database, 'users/' + user.uid),{
            username: username,
            displayName: displayName,
            avatar: 'üë§',
            createdAt: new Date().toISOString(),
            prayedDays:{},
            totalRosaries: 0,
            totalAves: 0,
            totalPaters: 0,
            currentStreak: 0,
            longestStreak: 0
        });
        showSuccess('register-success', 'Conta criada com sucesso! Entrando...');
        setTimeout(() =>{
            document.getElementById('register-form').reset();
            hideElement('register-success');
        }, 2000);
    } catch (error){
        console.error('Erro no registro:', error);
        showError('register-error', getFirebaseErrorMessage(error.code));
    } finally{
        setButtonLoading('register-btn', false);
        document.getElementById('register-btn').textContent = 'Criar Conta';
    }
}
async function loginUser(username, password){
    try{
        setButtonLoading('login-btn', true);
        const email = usernameToEmail(username);
        await signInWithEmailAndPassword(auth, email, password);
    } catch (error){
        console.error('Erro no login:', error);
        showError('login-error', getFirebaseErrorMessage(error.code));
        setButtonLoading('login-btn', false);
        document.getElementById('login-btn').textContent = 'Entrar';
    }
}
async function logoutUser(){
    if (confirm('Deseja realmente sair?')){
        try{
            await signOut(auth);
            document.querySelectorAll('.input-field').forEach(f => f.value = '');
        } catch (error){
            console.error('Erro ao sair:', error);
            alert('Erro ao sair da conta. Tente novamente.');
        }
    }
}
// Auth State Observer
onAuthStateChanged(auth, async (user) =>{
    if (user){
        setButtonLoading('login-btn', false);
        document.getElementById('login-btn').textContent = 'Entrar';
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        // Carregar dados do usu√°rio
        const userRef = ref(database, 'users/' + user.uid);
        const snapshot = await get(userRef);
        if (snapshot.exists()){
            window.userProfile = snapshot.val();
            window.currentUser = user;
            // Atualizar UI
            updateUserInterface();
        }
    } else{
        document.getElementById('main-app').classList.add('hidden');
        document.getElementById('auth-screen').classList.remove('hidden');
        window.userProfile = null;
        window.currentUser = null;
    }
});
// Atualizar interface com dados do usu√°rio
function updateUserInterface(){
    const profile = window.userProfile;
    if (!profile) return;
    const displayName = profile.displayName || profile.username;
    const initial = displayName.charAt(0).toUpperCase();
    const avatar = profile.avatar || initial;
    // Atualizar Home
    document.getElementById('home-user-name').textContent = displayName;
    // Atualizar Perfil
    document.getElementById('profile-name').textContent = displayName;
    document.getElementById('profile-avatar').textContent = avatar;
    // Atualizar Streak
    const streak = profile.currentStreak || 0;
    const streakMessage = streak === 0 ? 'Comece hoje sua jornada de ora√ß√£o' :
                         streak === 1 ? 'Continue orando! Voc√™ come√ßou bem!' :
                         streak < 7 ? '√ìtimo progresso! Continue assim!' :
                         streak < 30 ? 'Parab√©ns! Voc√™ est√° firme na f√©!' :
                         'Incr√≠vel! Que exemplo de perseveran√ßa!';
    document.getElementById('home-streak-count').textContent = streak;
    document.getElementById('home-streak-message').textContent = streakMessage;
    document.getElementById('profile-streak-count').textContent = streak;
    document.getElementById('profile-streak-message').textContent = streakMessage;
    // Atualizar Estat√≠sticas
    document.getElementById('profile-total-rosaries').textContent = profile.totalRosaries || 0;
    document.getElementById('profile-longest-streak').textContent = profile.longestStreak || 0;
    document.getElementById('profile-total-aves').textContent = profile.totalAves || 0;
    document.getElementById('profile-total-paters').textContent = profile.totalPaters || 0;
    // Atualizar Inten√ß√£o e Mist√©rio do Dia
    const intentions = [
        "Pelos que sofrem persegui√ß√£o por causa da f√©.",
        "Pela convers√£o dos pecadores e a salva√ß√£o das almas.",
        "Pelas voca√ß√µes sacerdotais e religiosas.",
        "Pela paz no mundo e o fim das guerras.",
        "Pelos enfermos e todos que cuidam deles.",
        "Pelas almas do purgat√≥rio, especialmente as mais abandonadas.",
        "Pela santifica√ß√£o das fam√≠lias.",
        "Pelos jovens, para que encontrem seu caminho em Cristo.",
        "Pela Igreja e pelo Santo Padre.",
        "Pelos mission√°rios em terras distantes.",
    ];
    const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
    const intention = intentions[dayOfYear % intentions.length];
    document.getElementById('home-intention').textContent = intention;
    document.getElementById('calendar-intention').textContent = intention;
    const days = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
    const today = new Date();
    document.getElementById('home-today-day').textContent = days[today.getDay()];
    document.getElementById('rosary-today-day').textContent = days[today.getDay()];
    const dayMap ={ 0: 'Gloriosos', 1: 'Gozosos', 2: 'Dolorosos', 3: 'Gloriosos', 4: 'Gozosos', 5: 'Dolorosos', 6: 'Gozosos' };
    document.getElementById('home-today-mystery').textContent = 'Mist√©rios ' + dayMap[today.getDay()];
    document.getElementById('rosary-today-mystery').textContent = 'Mist√©rios ' + dayMap[today.getDay()];
    // Renderizar Calend√°rio
    renderCalendar();
}
// Estado do calend√°rio
let currentCalendarMonth = new Date().getMonth();
let currentCalendarYear = new Date().getFullYear();
// Renderizar Calend√°rio
function renderCalendar(){
    const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                       'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
    document.getElementById('calendar-month-year').textContent = 
        `${monthNames[currentCalendarMonth]} ${currentCalendarYear}`;
    const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1).getDay();
    const daysInMonth = new Date(currentCalendarYear, currentCalendarMonth + 1, 0).getDate();
    const grid = document.getElementById('calendar-grid');
    grid.innerHTML = '';
    // Dias vazios antes do in√≠cio do m√™s
    for (let i = 0; i < firstDay; i++){
        const emptyDay = document.createElement('div');
        emptyDay.style.cssText = 'height: 40px;';
        grid.appendChild(emptyDay);
    }
    // Dias do m√™s
    const today = new Date();
    const isCurrentMonth = currentCalendarMonth === today.getMonth() && 
                          currentCalendarYear === today.getFullYear();
    const prayedDays = window.userProfile?.prayedDays ||{};
    for (let day = 1; day <= daysInMonth; day++){
        const dateKey = `${currentCalendarYear}-${String(currentCalendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const hasPrayed = prayedDays[dateKey] === true;
        const isToday = isCurrentMonth && day === today.getDate();
        const dayEl = document.createElement('div');
        dayEl.textContent = day;
        dayEl.style.cssText = `
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-family: var(--font-body);
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            ${hasPrayed ? `
                background: var(--gold);
                color: var(--bg-deep);
                font-weight: 600;
                box-shadow: 0 0 12px var(--gold-glow);
            ` : `
                color: var(--text-secondary);
                border: 1px solid var(--border-subtle);
            `}
            ${isToday ? `
                border: 2px solid var(--gold);
                ${!hasPrayed ? 'color: var(--gold);' : ''}
            ` : ''}
        `;
        dayEl.onmouseover = () =>{
            if (!hasPrayed){
                dayEl.style.borderColor = 'var(--gold-dim)';
                dayEl.style.color = 'var(--gold)';
            }
        };
        dayEl.onmouseout = () =>{
            if (!hasPrayed){
                dayEl.style.borderColor = 'var(--border-subtle)';
                dayEl.style.color = 'var(--text-secondary)';
                if (isToday){
                    dayEl.style.borderColor = 'var(--gold)';
                    dayEl.style.color = 'var(--gold)';
                }
            }
        };
        grid.appendChild(dayEl);
    }
}
// Event Listeners
document.addEventListener('DOMContentLoaded', () =>{
    // Auth tabs
    document.querySelectorAll('.auth-tab').forEach(tab =>{
        tab.addEventListener('click', () =>{
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab + '-form').classList.add('active');
        });
    });
    // Login form
    document.getElementById('login-form').addEventListener('submit', (e) =>{
        e.preventDefault();
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value;
        loginUser(username, password);
    });
    // Register form
    document.getElementById('register-form').addEventListener('submit', (e) =>{
        e.preventDefault();
        const username = document.getElementById('register-username').value.trim();
        const displayName = document.getElementById('register-displayname').value.trim();
        const password = document.getElementById('register-password').value;
        const confirm = document.getElementById('register-confirm').value;
        if (password !== confirm){
            showError('register-error', 'As senhas n√£o coincidem!');
            return;
        }
        if (username.length < 3){
            showError('register-error', 'Nome de usu√°rio muito curto! Use no m√≠nimo 3 caracteres.');
            return;
        }
        registerUser(username, displayName, password);
    });
    // Navega√ß√£o de tabs
    document.querySelectorAll('.nav-item[data-tab]').forEach(btn =>{
        btn.addEventListener('click', () =>{
            // Atualizar nav items
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            btn.classList.add('active');
            // Atualizar tab contents
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
        });
    });
    // Bot√£o Ros√°rio na navbar - abre modal
    document.getElementById('nav-rosary-btn').addEventListener('click', () =>{
        document.getElementById('rosary-modal').classList.add('active');
    });
    // Navega√ß√£o do Calend√°rio
    document.getElementById('prev-month-btn').addEventListener('click', () =>{
        currentCalendarMonth--;
        if (currentCalendarMonth < 0){
            currentCalendarMonth = 11;
            currentCalendarYear--;
        }
        renderCalendar();
    });
    document.getElementById('next-month-btn').addEventListener('click', () =>{
        currentCalendarMonth++;
        if (currentCalendarMonth > 11){
            currentCalendarMonth = 0;
            currentCalendarYear++;
        }
        renderCalendar();
    });
});
// Exportar fun√ß√µes globalmente
window.firebaseAuth ={ logoutUser };
window.updateUserInterface = updateUserInterface;
window.renderCalendar = renderCalendar;
</script>
<script>
// ===== SISTEMA DE √ÅUDIO INTERATIVO =====
const AudioSystem ={
    ctx: null,
    enabled: false,
    init(){
        if (!this.ctx){
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (this.ctx.state === 'suspended') this.ctx.resume();
    },
    // Som de conta - madeira de ter√ßo
    playBead(type = 'ave'){
        if (!this.enabled) return;
        this.init();
        const now = this.ctx.currentTime;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        const filter = this.ctx.createBiquadFilter();
        filter.type = 'lowpass';
        osc.type = 'triangle'; // Som mais org√¢nico
        if (type === 'pater'){
            // Som de madeira mais grossa/densa para Pai Nosso
            osc.frequency.setValueAtTime(180, now);
            osc.frequency.exponentialRampToValueAtTime(90, now + 0.08);
            filter.frequency.setValueAtTime(600, now);
            filter.Q.setValueAtTime(3, now);
            gain.gain.setValueAtTime(0.25, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);
        } else if (type === 'special'){
            // Som de madeira m√©dia para contas especiais
            osc.frequency.setValueAtTime(220, now);
            osc.frequency.exponentialRampToValueAtTime(110, now + 0.06);
            filter.frequency.setValueAtTime(500, now);
            filter.Q.setValueAtTime(4, now);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.12);
        } else{
            // Som de madeira leve/seca para Ave Maria
            osc.frequency.setValueAtTime(260, now);
            osc.frequency.exponentialRampToValueAtTime(130, now + 0.05);
            filter.frequency.setValueAtTime(450, now);
            filter.Q.setValueAtTime(5, now);
            gain.gain.setValueAtTime(0.18, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
        }
        osc.connect(filter);
        filter.connect(gain);
        gain.connect(this.ctx.destination);
        osc.start(now);
        osc.stop(now + 0.2);
        // Adiciona textura de toque de madeira
        this.addWoodTexture(type);
    },
    addWoodTexture(type){
        const now = this.ctx.currentTime;
        const bufferSize = this.ctx.sampleRate * 0.02;
        const noiseBuffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
        const data = noiseBuffer.getChannelData(0);
        // Ru√≠do mais acentuado no in√≠cio (percussivo)
        for (let i = 0; i < bufferSize; i++){
            const envelope = Math.exp(-i / (bufferSize * 0.15));
            data[i] = (Math.random() * 2 - 1) * 0.4 * envelope;
        }
        const noise = this.ctx.createBufferSource();
        noise.buffer = noiseBuffer;
        const noiseGain = this.ctx.createGain();
        const noiseFilter = this.ctx.createBiquadFilter();
        noiseFilter.type = 'bandpass';
        // Frequ√™ncias mais baixas para som de madeira
        noiseFilter.frequency.setValueAtTime(type === 'pater' ? 800 : 1200, now);
        noiseFilter.Q.setValueAtTime(2, now);
        const vol = type === 'pater' ? 0.15 : 0.1;
        noiseGain.gain.setValueAtTime(vol, now);
        noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.02);
        noise.connect(noiseFilter);
        noiseFilter.connect(noiseGain);
        noiseGain.connect(this.ctx.destination);
        noise.start(now);
    },
    // Som de sino ao iniciar
    playBell(){
        if (!this.enabled) return;
        this.init();
        const now = this.ctx.currentTime;
        const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5
        frequencies.forEach((freq, i) =>{
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.frequency.setValueAtTime(freq, now);
            osc.type = 'sine';
            const startTime = now + i * 0.12;
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.1 / (i + 1), startTime + 0.06);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + 2.5);
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.start(startTime);
            osc.stop(startTime + 3);
        });
    },
    // Som de conclus√£o - acorde ascendente
    playComplete(){
        if (!this.enabled) return;
        this.init();
        const now = this.ctx.currentTime;
        const notes = [261.63, 329.63, 392, 523.25]; // C4, E4, G4, C5
        notes.forEach((freq, i) =>{
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.frequency.setValueAtTime(freq, now);
            osc.type = 'sine';
            const startTime = now + i * 0.18;
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.12, startTime + 0.06);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + 2);
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.start(startTime);
            osc.stop(startTime + 2.5);
        });
    },
    toggle(){
        this.enabled = !this.enabled;
        return this.enabled;
    }
};
// ===== TEXTOS DAS ORA√á√ïES =====
const TEXTS ={
    cross: `Em nome do Pai, e do Filho, e do Esp√≠rito Santo. Am√©m.`,
    credo: `Creio em Deus Pai todo-poderoso, Criador do C√©u e da terra; e em Jesus Cristo, seu √∫nico Filho, Nosso Senhor, que foi concebido pelo poder do Esp√≠rito Santo; nasceu da Virgem Maria; padeceu sob P√¥ncio Pilatos, foi crucificado, morto e sepultado; desceu √† mans√£o dos mortos; ressuscitou ao terceiro dia; subiu aos C√©us; est√° sentado √† direita de Deus Pai todo-poderoso, de onde h√° de vir a julgar os vivos e os mortos. Creio no Esp√≠rito Santo; na Santa Igreja Cat√≥lica; na comunh√£o dos Santos; na remiss√£o dos pecados; na ressurrei√ß√£o da carne; na vida eterna. Am√©m.`,
    pater: `Pai nosso que estais nos C√©us, santificado seja o vosso Nome, venha a n√≥s o vosso Reino, seja feita a vossa vontade assim na terra como no C√©u. O p√£o nosso de cada dia nos dai hoje, perdoai-nos as nossas ofensas assim como n√≥s perdoamos a quem nos tem ofendido, e n√£o nos deixeis cair em tenta√ß√£o, mas livrai-nos do Mal. Am√©m.`,
    ave: `Ave Maria, cheia de gra√ßa, o Senhor √© convosco, bendita sois v√≥s entre as mulheres e bendito √© o fruto do vosso ventre, Jesus. Santa Maria, M√£e de Deus, rogai por n√≥s pecadores, agora e na hora da nossa morte. Am√©m.`,
    gloria: `Gl√≥ria ao Pai, e ao Filho, e ao Esp√≠rito Santo. Assim como era no princ√≠pio, agora e sempre, e por todos os s√©culos dos s√©culos. Am√©m.`,
    fatima: `√ì meu Jesus, perdoai-nos, livrai-nos do fogo do inferno, levai as almas todas para o C√©u, principalmente as que mais precisarem da vossa Miseric√≥rdia.`,
    salve: `Salve Rainha, M√£e de Miseric√≥rdia, vida, do√ßura e esperan√ßa nossa, salve! A v√≥s bradamos, os degredados filhos de Eva. A v√≥s suspiramos, gemendo e chorando neste vale de l√°grimas. Eia pois, advogada nossa, esses vossos olhos misericordiosos a n√≥s volvei. E depois deste desterro, mostrai-nos Jesus, bendito fruto do vosso ventre. √ì clemente, √≥ piedosa, √≥ doce sempre Virgem Maria. Rogai por n√≥s, Santa M√£e de Deus, para que sejamos dignos das promessas de Cristo. Am√©m.`
};
// ===== MEDITA√á√ïES MONTFORT =====
const MONTFORT ={
    intro: ["Em honra do Pai Eterno, que gera seu Filho contemplando-Se.", "Em honra do Verbo Eterno, igual ao Pai, que com Ele produz o Esp√≠rito Santo.", "Em honra do Esp√≠rito Santo, que procede do Pai e do Filho por via de amor."],
    gozosos:{ name: "Mist√©rios Gozosos", mysteries: [
{ title: "A Anuncia√ß√£o do Anjo a Nossa Senhora", pater: "A caridade de Deus, imensa.", aves: ["Para lamentar o desgra√ßado estado de Ad√£o desobediente, sua justa condena√ß√£o e a de todos os seus filhos.", "Os desejos dos patriarcas e profetas, que pediam a vinda do Messias.", "Os desejos e as preces da Sant√≠ssima Virgem, que apressaram a vinda do Messias.", "A caridade do Pai Eterno, que nos deu Seu divino Filho.", "O amor do Filho, que se entregou por n√≥s.", "A embaixada e a sauda√ß√£o do arcanjo Gabriel.", "O temor virginal de Maria.", "A f√© e o consentimento da Sant√≠ssima Virgem.", "A cria√ß√£o da alma e a forma√ß√£o do Corpo de Jesus Cristo no seio de Maria, pelo Esp√≠rito Santo.", "A adora√ß√£o do Verbo Encarnado, pelos anjos, no seio de Maria."] },
{ title: "A Visita√ß√£o de Nossa Senhora a Santa Isabel", pater: "A majestade de Deus, ador√°vel.", aves: ["O gozo do Cora√ß√£o de Maria e a morada durante nove meses, do Verbo em seu seio.", "O sacrif√≠cio que Jesus Cristo fez de Si mesmo ao Pai, ao entrar neste Mundo.", "As complac√™ncias de Jesus no seio humilde e virginal de Maria, e de Nossa Senhora, no gozo do seu Deus.", "A d√∫vida de S√£o Jos√© acerca da maternidade de Maria.", "A elei√ß√£o dos escolhidos, combinada entre Jesus e Maria, em seu seio.", "O fervor de Maria na sua visita a Santa Isabel.", "A santifica√ß√£o de Jo√£o Batista no ventre de sua m√£e.", "A gratid√£o da Sant√≠ssima Virgem para com Deus, no Magnificat.", "A sua caridade e humildade em servir sua prima.", "A m√∫tua depend√™ncia de Jesus e de Maria, e a devo√ß√£o que devemos ter para com um e outra."] },
{ title: "O Nascimento de Jesus em Bel√©m", pater: "As riquezas de Deus, infinitas.", aves: ["Os desprezos e inj√∫rias feitas a Maria e a S√£o Jos√© em Bel√©m.", "A pobreza do est√°bulo onde Deus veio ao mundo.", "A alta contempla√ß√£o e o excessivo amor de Maria no momento de dar √† luz.", "A sa√≠da do Verbo Eterno do seio de Maria sem romper o selo de sua virgindade.", "As adora√ß√µes e c√¢nticos dos anjos no nascimento de Jesus.", "A formosura arrebatadora de Sua divina inf√¢ncia.", "A vinda dos pastores ao est√°bulo, com seus presentes.", "A circuncis√£o de Jesus Cristo e Suas dores amorosas.", "A imposi√ß√£o do nome de Jesus Cristo e suas grandezas.", "A adora√ß√£o dos reis magos e seus presentes."] },
{ title: "A Apresenta√ß√£o de Jesus no Templo", pater: "A sabedoria de Deus, eterna.", aves: ["A obedi√™ncia de Jesus e de Maria √† Lei.", "O sacrif√≠cio que ali fez Jesus de sua humanidade.", "O sacrif√≠cio que ali fez Maria de sua honra.", "O gozo e os c√¢nticos de Sime√£o e Ana, a profetisa.", "O resgate de Jesus pela oferenda de duas rolas.", "A matan√ßa dos santos inocentes.", "A fuga de Jesus para o Egito, pela obedi√™ncia de S√£o Jos√© √† voz do anjo.", "A estada misteriosa no Egito.", "A Sua volta para Nazar√©.", "O seu crescimento em idade, sabedoria e gra√ßa."] },
{ title: "O Encontro de Jesus no Templo", pater: "A santidade de Deus, incompreens√≠vel.", aves: ["A Sua vida oculta, laboriosa e obediente na casa de Nazar√©.", "A sua perda e encontro no Templo entre os doutores.", "O seu jejum e tenta√ß√µes no deserto.", "O seu Batismo por S√£o Jo√£o Batista.", "A sua prega√ß√£o admir√°vel.", "Os seus milagres portentosos.", "A elei√ß√£o de seus doze Ap√≥stolos e os poderes que lhes deu.", "A sua transfigura√ß√£o maravilhosa.", "O lava-p√©s dos Ap√≥stolos.", "A institui√ß√£o da Sagrada Eucaristia."] }
    ]},
    dolorosos:{ name: "Mist√©rios Dolorosos", mysteries: [
{ title: "A Agonia de Jesus no Horto", pater: "A felicidade de Deus, essencial.", aves: ["Os divinos retiros que fez Jesus em Sua vida, principalmente no horto.", "As suas ora√ß√µes humildes e fervorosas durante Sua vida e nas v√©speras da Paix√£o.", "A paci√™ncia e do√ßura com que suportou Seus Ap√≥stolos, particularmente no horto.", "O t√©dio de sua Alma durante toda a Sua vida, principalmente no horto.", "Os rios de sangue que a dor fez brotar de seu Ser ador√°vel.", "O consolo que teve por bem aceitar de um anjo na agonia.", "A sua conformidade com a vontade do Pai, apesar da repugn√¢ncia de Sua natureza.", "A Sua trai√ß√£o por Judas e pris√£o pelos judeus.", "O valor com que saiu ao encontro dos algozes e a for√ßa da palavra com que os lan√ßou por terra.", "O abandono que sofreu de Seus Ap√≥stolos."] },
{ title: "A Flagela√ß√£o de Jesus", pater: "A paci√™ncia de Deus, admir√°vel.", aves: ["As cordas com que Jesus foi atado.", "A bofetada que recebeu em casa de Caif√°s.", "As nega√ß√µes de S√£o Pedro.", "As ignom√≠nias que sofreu em casa de Herodes, quando lhe puseram a veste branca.", "O despojamento de Suas vestes.", "Os desprezos e insultos que sofreu de seus verdugos pela Sua nudez.", "As varas espinhosas e os a√ßoites cru√©is com que foi golpeado.", "A coluna em que foi atado.", "O sangue que derramou e as chagas que recebeu.", "A Sua queda no pr√≥prio sangue por causa da fraqueza."] },
{ title: "A Coroa√ß√£o de Espinhos", pater: "A formosura de Deus, inef√°vel.", aves: ["O despojamento de Suas vestes pela terceira vez.", "A Sua coroa de espinhos.", "O v√©u com que Lhe vendaram os olhos.", "As bofetadas e os escarros com que Lhe cobriram o rosto.", "O andrajo que Lhe puseram sobre os ombros.", "A cana que Lhe puseram nas m√£os.", "A pedra pontiaguda sobre a qual O sentaram.", "Os ultrajes e os insultos que Lhe fizeram.", "O sangue e os suores que escorriam de Sua cabe√ßa ador√°vel.", "Os cabelos e a barba que Lhe arrancaram."] },
{ title: "Jesus Carrega a Cruz", pater: "A onipot√™ncia de Deus, sem limites.", aves: ["A apresenta√ß√£o de Nosso Senhor diante do povo com o 'Eis o Homem'.", "O haver sido preferido a Barrab√°s.", "Os falsos testemunhos que contra Ele deram.", "A Sua condena√ß√£o √† morte.", "O amor com que abra√ßou e beijou a Cruz.", "O trabalho espantoso que teve em carreg√°-la.", "As quedas de pura debilidade sob seu peso.", "O encontro doloroso com Sua Santa M√£e.", "O v√©u de Ver√¥nica, no qual Seu rosto se estampou.", "As suas l√°grimas, as de Sua Santa M√£e e das piedosas mulheres que O seguiram at√© o Calv√°rio."] },
{ title: "A Crucifica√ß√£o e Morte de Jesus", pater: "A justi√ßa de Deus, espantosa.", aves: ["As cinco chagas de Jesus e o sangue que derramou na Cruz.", "O seu cora√ß√£o traspassado e a Cruz em que foi crucificado.", "Os cravos e a lan√ßa que O atravessaram.", "A vergonha e a inf√¢mia que sofreu, sendo crucificado entre dois ladr√µes.", "A compaix√£o de Sua M√£e Sant√≠ssima.", "As sete √∫ltimas palavras.", "O seu desamparo e Seu sil√™ncio.", "A afli√ß√£o de todo o Universo.", "A Sua morte cruel e ignominiosa.", "A descida da Cruz e sepultamento."] }
    ]},
    gloriosos:{ name: "Mist√©rios Gloriosos", mysteries: [
{ title: "A Ressurrei√ß√£o de Jesus", pater: "A eternidade de Deus, sem princ√≠pio.", aves: ["A descida da Alma de Nosso Senhor aos Infernos.", "O gozo e a sa√≠da das almas dos Santos Padres que estavam no limbo.", "A reuni√£o de Sua Alma e de Seu Corpo no sepulcro.", "A sua milagrosa sa√≠da do Sepulcro.", "As suas vit√≥rias sobre a morte, o pecado, o mundo e o dem√¥nio.", "Os quatro dons gloriosos de Seu Corpo.", "O poder que Lhe deu Seu pai no c√©u e na terra.", "As apari√ß√µes com que honrou Sua Santa M√£e.", "As conversa√ß√µes sobre o C√©u e a ceia que fez com Seus Ap√≥stolos.", "A autoridade e miss√£o que lhes deu, para que fossem pregar por toda a Terra."] },
{ title: "A Ascens√£o de Jesus ao C√©u", pater: "A imensidade de Deus, sem limites.", aves: ["A promessa que fez Jesus aos Ap√≥stolos de lhes enviar o Esp√≠rito Santo.", "A reuni√£o no Monte das Oliveiras.", "A ben√ß√£o que lhes deu ao se elevar da Terra aos C√©us.", "A Sua gloriosa e admir√°vel Ascens√£o por Sua pr√≥pria virtude at√© o C√©u Emp√≠reo.", "O recebimento e o triunfo que lhe fez Deus, Seu Pai, e toda a corte celestial.", "O poder triunfante com que abriu as portas do C√©u, onde nenhum mortal havia entrado.", "O seu assento √† direita do Pai, como Seu Filho querido, igual a Ele mesmo.", "O poder que Lhe deu de julgar os vivos e os mortos.", "A Sua √∫ltima vinda sobre a Terra, na qual Seu poder e majestade aparecer√£o em todo o seu esplendor.", "A justi√ßa que far√° no √∫ltimo Ju√≠zo, recompensando os bons e castigando os maus por toda a eternidade."] },
{ title: "A Vinda do Esp√≠rito Santo", pater: "A provid√™ncia de Deus, universal.", aves: ["A Verdade do Esp√≠rito Santo, Deus que procede do Pai e do Filho.", "O dom do Esp√≠rito Santo pelo Pai e pelo Filho sobre os Ap√≥stolos.", "O grande estrondo com que desceu, sinal de Sua for√ßa e Seu poder.", "As l√≠nguas de fogo que enviou sobre os Ap√≥stolos.", "A plenitude de gra√ßas com que distinguiu Maria, Sua fiel esposa.", "A Sua conduta maravilhosa, com os santos e com o pr√≥prio Jesus Cristo.", "Os doze frutos do Esp√≠rito Santo.", "Os sete dons do Esp√≠rito Santo.", "Para pedir em particular o dom da Sabedoria e a vinda de Seu reino aos cora√ß√µes.", "Para obter a vit√≥ria sobre os tr√™s esp√≠ritos que Lhe s√£o opostos: o esp√≠rito da carne, do mundo e do dem√¥nio."] },
{ title: "A Assun√ß√£o de Nossa Senhora", pater: "A liberalidade de Deus, inenarr√°vel.", aves: ["A predestina√ß√£o eterna de Maria, como obra-prima das m√£os de Deus.", "A Sua Concei√ß√£o Imaculada, a plenitude de gra√ßas e o uso da raz√£o no seio de sua m√£e.", "A Sua Natividade que regozijou todo o Universo.", "A Sua apresenta√ß√£o e sua vida no Templo.", "A Sua vida admir√°vel e isenta de todo pecado.", "A plenitude de suas virtudes singulares.", "A Sua virgindade fecunda e seu parto sem dor.", "A Sua maternidade divina e sua alian√ßa com a Sant√≠ssima Trindade.", "A Sua morte preciosa e cheia de amor.", "A Sua ressurrei√ß√£o e assun√ß√£o triunfante."] },
{ title: "A Coroa√ß√£o de Nossa Senhora", pater: "A gl√≥ria de Deus, inacess√≠vel.", aves: ["A tr√≠plice coroa com que a Sant√≠ssima Trindade coroou Maria.", "O gozo e a gl√≥ria nova que recebeu o C√©u por seu triunfo.", "Para reconhec√™-la como Rainha do C√©u e da Terra, dos anjos e dos homens.", "A tesoureira e dispensadora de todas as gra√ßas de Deus.", "A Medianeira e advogada dos homens.", "A destruidora e a ru√≠na do dem√¥nio e das heresias.", "O ref√∫gio seguro dos pecadores.", "A m√£e e nutriz dos crist√£os.", "A que √© gozo e do√ßura dos justos.", "A que √© asilo universal dos vivos, consolo todo-poderoso dos aflitos, dos moribundos e das almas do purgat√≥rio."] }
    ]}
};
// ===== APP =====
const app ={
    state:{ type: null, beads: [], index: 0, showText: false },
    els:{},
    init(){
        this.els ={
            mainApp: document.getElementById('main-app'),
            prayer: document.getElementById('prayer-screen'),
            completion: document.getElementById('completion-screen'),
            track: document.getElementById('bead-track'),
            progressFill: document.getElementById('progress-fill'),
            progressText: document.getElementById('progress-text'),
            group: document.getElementById('prayer-group'),
            mystery: document.getElementById('prayer-mystery'),
            name: document.getElementById('prayer-name'),
            count: document.getElementById('prayer-count'),
            meditationBox: document.getElementById('meditation-box'),
            meditationText: document.getElementById('meditation-text'),
            textToggle: document.getElementById('prayer-text-toggle'),
            fullText: document.getElementById('prayer-full-text'),
            prevBtn: document.getElementById('prev-btn'),
            audioToggle: document.getElementById('audio-toggle'),
            audioIconOn: document.getElementById('audio-icon-on'),
            audioIconOff: document.getElementById('audio-icon-off')
        };
        this.setTodayInfo();
        this.setupGestures();
        this.setupKeyboard();
    },
    setTodayInfo(){
        const days = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
        const mysteries ={ 0: 'Gloriosos', 1: 'Gozosos', 2: 'Dolorosos', 3: 'Gloriosos', 4: 'Gozosos', 5: 'Dolorosos', 6: 'Gozosos' };
        const d = new Date().getDay();
        document.getElementById('today-info').innerHTML = `Hoje √© <strong>${days[d]}</strong> ‚Äî Mist√©rios <strong>${mysteries[d]}</strong>`;
    },
    setupGestures(){
        let startY = 0;
        let startX = 0;
        const body = document.getElementById('prayer-body');
        body.addEventListener('touchstart', e =>{ 
            startY = e.touches[0].clientY;
            startX = e.touches[0].clientX;
        },{ passive: true });
        body.addEventListener('touchmove', e =>{
            // Prevenir scroll durante swipe vertical
            const dy = Math.abs(startY - e.touches[0].clientY);
            const dx = Math.abs(startX - e.touches[0].clientX);
            if (dy > dx && dy > 10){
                e.preventDefault();
            }
        },{ passive: false });
        body.addEventListener('touchend', e =>{
            if (!this.state.type) return;
            const endY = e.changedTouches[0].clientY;
            const endX = e.changedTouches[0].clientX;
            const dy = startY - endY;
            const dx = Math.abs(startX - endX);
            // S√≥ processar se movimento vertical for maior que horizontal
            if (Math.abs(dy) > 30 && Math.abs(dy) > dx){
                if (dy > 0){
                    // Swipe para cima = pr√≥xima
                    this.next();
                } else{
                    // Swipe para baixo = anterior
                    this.prev();
                }
            }
        },{ passive: true });
        // Scroll wheel
        let wheelTimeout;
        window.addEventListener('wheel', e =>{
            if (!this.state.type || wheelTimeout) return;
            if (e.deltaY > 0) this.next();
            else if (e.deltaY < 0) this.prev();
            wheelTimeout = setTimeout(() =>{ wheelTimeout = null;}, 180);
        },{ passive: true });
    },
    setupKeyboard(){
        document.addEventListener('keydown', e =>{
            if (!this.state.type) return;
            if (['ArrowDown', 'ArrowRight', ' '].includes(e.key)){ e.preventDefault(); this.next();}
            if (['ArrowUp', 'ArrowLeft'].includes(e.key)){ e.preventDefault(); this.prev();}
            if (e.key === 'Escape') this.confirmExit();
            if (e.key.toLowerCase() === 't') this.toggleText();
            if (e.key.toLowerCase() === 'm') this.toggleAudio();
        });
    },
    toggleAudio(){
        const enabled = AudioSystem.toggle();
        this.els.audioToggle.classList.toggle('active', enabled);
        this.els.audioIconOn.style.display = enabled ? 'block' : 'none';
        this.els.audioIconOff.style.display = enabled ? 'none' : 'block';
        if (enabled) AudioSystem.playBell();
    },
    generateBeads(type){
        const beads = []; let id = 0;
        const add = (beadType, name, textKey, meditation = '', meta ={}) =>{ beads.push({ id: id++, beadType, name, textKey, meditation, ...meta });};
        add('special', 'Sinal da Cruz', 'cross', 'F√© na presen√ßa de Deus; F√© no Evangelho; F√© e obedi√™ncia ao Papa como Vig√°rio de Jesus Cristo.');
        add('special', 'Creio em Deus Pai', 'credo', 'Professamos nossa f√© no Deus Uno e Trino e em todos os artigos da Santa F√© Cat√≥lica.');
        add('pater', 'Pai Nosso', 'pater', 'Unidade de um s√≥ Deus, vivo e verdadeiro.');
        MONTFORT.intro.forEach((med, i) =>{ add('ave', 'Ave Maria', 'ave', med,{ count: `${i + 1}¬™ Ave Maria ¬∑ Virtudes Teologais` });});
        add('special', 'Gl√≥ria ao Pai', 'gloria', 'Damos gl√≥ria √† Sant√≠ssima Trindade.');
        let groups = type === 'completo' ? [MONTFORT.gozosos, MONTFORT.dolorosos, MONTFORT.gloriosos] : [MONTFORT[type]];
        groups.forEach(group =>{
            group.mysteries.forEach((mystery, mIdx) =>{
                const mysteryNum = mIdx + 1;
                add('pater', 'Pai Nosso', 'pater', mystery.pater,{ group: group.name, mystery: mystery.title, count: `${mysteryNum}¬∫ Mist√©rio` });
                mystery.aves.forEach((med, aIdx) =>{ add('ave', 'Ave Maria', 'ave', med,{ group: group.name, mystery: mystery.title, count: `${mysteryNum}¬™ Dezena ¬∑ ${aIdx + 1}¬™ Ave Maria` });});
                add('special', 'Gl√≥ria ao Pai', 'gloria', '',{ group: group.name, mystery: mystery.title, count: `${mysteryNum}¬™ Dezena` });
                add('special', 'Ora√ß√£o de F√°tima', 'fatima', 'Ora√ß√£o ensinada por Nossa Senhora aos pastorinhos de F√°tima.',{ group: group.name, mystery: mystery.title, count: `${mysteryNum}¬™ Dezena` });
            });
        });
        add('special', 'Salve Rainha', 'salve', 'Saudemos a Rainha do C√©u e da Terra, nossa M√£e e Advogada.');
        return beads;
    },
    start(type){
        this.state.type = type;
        this.state.beads = this.generateBeads(type);
        this.state.index = 0;
        this.state.showText = false;
        this.els.track.innerHTML = '';
        this.state.beads.forEach((bead, idx) =>{
            const el = document.createElement('div');
            el.className = `bead ${bead.beadType}`;
            if (bead.beadType !== 'ave' && bead.beadType !== 'pater') el.classList.add('special');
            // Adicionar classe espec√≠fica para Gl√≥ria e F√°tima (ret√¢ngulos arredondados)
            if (bead.textKey === 'gloria' || bead.textKey === 'fatima'){
                el.classList.add('rectangle-bead');
            }
            if (idx === 0) el.classList.add('active');
            el.onclick = () => this.goTo(idx);
            this.els.track.appendChild(el);
        });
        this.els.prayer.classList.add('active');
        AudioSystem.playBell();
        this.update();
    },
    goTo(idx){
        if (idx >= 0 && idx < this.state.beads.length){
            this.state.index = idx;
            this.update();
            AudioSystem.playBead(this.state.beads[idx].beadType);
        }
    },
    next(){
        if (this.state.index < this.state.beads.length - 1){
            this.state.index++;
            this.update();
            AudioSystem.playBead(this.state.beads[this.state.index].beadType);
        } else{
            this.complete();
        }
    },
    prev(){
        if (this.state.index > 0){
            this.state.index--;
            this.update();
            AudioSystem.playBead(this.state.beads[this.state.index].beadType);
        }
    },
    update(){
        const idx = this.state.index;
        const bead = this.state.beads[idx];
        const total = this.state.beads.length;
        const pct = ((idx + 1) / total) * 100;
        this.els.progressFill.style.width = `${pct}%`;
        this.els.progressText.textContent = `${idx + 1} / ${total}`;
        const animatedEls = [this.els.group, this.els.mystery, this.els.name, this.els.count, this.els.meditationBox];
        animatedEls.forEach(el => el.classList.remove('visible'));
        setTimeout(() =>{
            this.els.group.textContent = bead.group || '';
            this.els.mystery.textContent = bead.mystery || '';
            this.els.name.textContent = bead.name;
            this.els.count.textContent = bead.count || '';
            this.els.meditationText.textContent = bead.meditation;
            this.els.fullText.innerHTML = `<p>${TEXTS[bead.textKey]}</p>`;
            // L√≥gica de exibi√ß√£o do texto
            const isShortPrayer = bead.textKey === 'gloria' || bead.textKey === 'fatima';
            if (isShortPrayer){
                // Gl√≥ria e F√°tima: sempre mostrar texto, esconder bot√£o
                this.els.fullText.classList.add('visible');
                this.els.textToggle.style.display = 'none';
            } else{
                // Outras ora√ß√µes: esconder texto por padr√£o, mostrar bot√£o
                this.els.textToggle.style.display = 'flex';
                if (!this.state.showText){
                    this.els.fullText.classList.remove('visible');
                    this.els.textToggle.classList.remove('expanded');
                    this.els.textToggle.querySelector('span').textContent = 'Ver texto da ora√ß√£o';
                } else{
                    this.els.fullText.classList.add('visible');
                    this.els.textToggle.classList.add('expanded');
                    this.els.textToggle.querySelector('span').textContent = 'Esconder texto';
                }
            }
            animatedEls.forEach(el => el.classList.add('visible'));
        }, 120);
        this.els.prevBtn.disabled = idx === 0;
        const beadEls = this.els.track.children;
        Array.from(beadEls).forEach(el => el.classList.remove('active'));
        beadEls[idx].classList.add('active');
        const activeEl = beadEls[idx];
        const beadCenter = activeEl.offsetTop + activeEl.offsetHeight / 2;
        this.els.track.style.transform = `translate(-50%, -${beadCenter}px)`;
    },
    toggleText(){
        this.state.showText = !this.state.showText;
        if (this.state.showText){
            this.els.fullText.classList.add('visible');
            this.els.textToggle.classList.add('expanded');
            this.els.textToggle.querySelector('span').textContent = 'Ocultar texto';
        } else{
            this.els.fullText.classList.remove('visible');
            this.els.textToggle.classList.remove('expanded');
            this.els.textToggle.querySelector('span').textContent = 'Ver texto da ora√ß√£o';
        }
    },
    confirmExit(){ if (confirm('Deseja realmente sair do Ros√°rio?')) this.home();},
    home(){
        this.state.type = null;
        this.els.prayer.classList.remove('active');
        this.els.completion.classList.remove('active');
    },
    complete(){
        AudioSystem.playComplete();
        const aves = this.state.beads.filter(b => b.beadType === 'ave').length;
        const paters = this.state.beads.filter(b => b.beadType === 'pater').length;
        document.getElementById('stat-aves').textContent = aves;
        document.getElementById('stat-paters').textContent = paters;
        const msgs ={
            gozosos: 'Voc√™ completou os Mist√©rios Gozosos. Que a alegria de Maria esteja convosco.',
            dolorosos: 'Voc√™ completou os Mist√©rios Dolorosos. Que os sofrimentos de Cristo vos fortale√ßam.',
            gloriosos: 'Voc√™ completou os Mist√©rios Gloriosos. Que a gl√≥ria do C√©u vos aguarde.',
            completo: 'Voc√™ completou o Santo Ros√°rio inteiro! Que Nossa Senhora interceda por v√≥s.'
        };
        document.getElementById('completion-msg').textContent = msgs[this.state.type];
        // Salvar no Firebase
        if (window.currentUser && window.userProfile){
            this.saveCompletion(aves, paters);
        }
        this.els.prayer.classList.remove('active');
        this.els.completion.classList.add('active');
    },
    async saveCompletion(aves, paters){
        try{
            // Importar update do Firebase
            const{ getDatabase, ref, update, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
            const database = getDatabase();
            const userId = window.currentUser.uid;
            const today = new Date();
            const dateKey = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            // Atualizar dados
            const updates ={};
            updates[`users/${userId}/prayedDays/${dateKey}`] = true;
            updates[`users/${userId}/totalRosaries`] = (window.userProfile.totalRosaries || 0) + 1;
            updates[`users/${userId}/totalAves`] = (window.userProfile.totalAves || 0) + aves;
            updates[`users/${userId}/totalPaters`] = (window.userProfile.totalPaters || 0) + paters;
            // Calcular streak
            const userRef = ref(database, `users/${userId}`);
            const snapshot = await get(userRef);
            const userData = snapshot.val();
            const prayedDays = userData.prayedDays ||{};
            // Verificar se rezou ontem
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayKey = `${yesterday.getFullYear()}-${String(yesterday.getMonth() + 1).padStart(2, '0')}-${String(yesterday.getDate()).padStart(2, '0')}`;
            let newStreak = 1;
            if (prayedDays[yesterdayKey]){
                newStreak = (userData.currentStreak || 0) + 1;
            }
            updates[`users/${userId}/currentStreak`] = newStreak;
            updates[`users/${userId}/longestStreak`] = Math.max(newStreak, userData.longestStreak || 0);
            await update(ref(database), updates);
            // Atualizar perfil local
            window.userProfile.prayedDays ={ ...prayedDays, [dateKey]: true };
            window.userProfile.totalRosaries = (window.userProfile.totalRosaries || 0) + 1;
            window.userProfile.totalAves = (window.userProfile.totalAves || 0) + aves;
            window.userProfile.totalPaters = (window.userProfile.totalPaters || 0) + paters;
            window.userProfile.currentStreak = newStreak;
            window.userProfile.longestStreak = Math.max(newStreak, window.userProfile.longestStreak || 0);
            // Atualizar UI
            if (window.updateUserInterface){
                window.updateUserInterface();
            }
        } catch (error){
            console.error('Erro ao salvar conclus√£o:', error);
        }
    }
};
app.init();
window.app = app;
// ===== SISTEMA DE AVATARES =====
const AVATARS = [
    'üë§', // Padr√£o
    'üôè', // M√£os rezando
    'üìø', // Ros√°rio
    '‚úùÔ∏è', // Cruz
    '‚õ™', // Igreja
    'üïäÔ∏è', // Pomba (Esp√≠rito Santo)
    'üåü', // Estrela
    '‚ù§Ô∏è', // Cora√ß√£o
    'üåπ', // Rosa (Nossa Senhora)
    'üìñ', // B√≠blia
    'üïØÔ∏è', // Vela
    'üëë', // Coroa (Cristo Rei)
    'üòá', // Anjo
    'üåô', // Lua
    '‚òÄÔ∏è', // Sol
    'üí´', // Estrela cadente
];
let selectedAvatar = 'üë§';
// Renderizar grid de avatares
function renderAvatarGrid(){
    const grid = document.getElementById('avatar-grid');
    grid.innerHTML = '';
    AVATARS.forEach(avatar =>{
        const option = document.createElement('div');
        option.className = 'avatar-option';
        option.textContent = avatar;
        option.onclick = () => selectAvatar(avatar, option);
        // Marcar avatar atual como selecionado
        if (window.userProfile && window.userProfile.avatar === avatar){
            option.classList.add('selected');
            selectedAvatar = avatar;
        }
        grid.appendChild(option);
    });
}
// Selecionar avatar
function selectAvatar(avatar, element){
    selectedAvatar = avatar;
    // Remover sele√ß√£o anterior
    document.querySelectorAll('.avatar-option').forEach(opt =>{
        opt.classList.remove('selected');
    });
    // Adicionar sele√ß√£o ao novo
    element.classList.add('selected');
}
// Abrir modal
window.openAvatarModal = function(){
    renderAvatarGrid();
    document.getElementById('avatar-modal').classList.add('active');
};
// Fechar modal
window.closeAvatarModal = function(){
    document.getElementById('avatar-modal').classList.remove('active');
};
// Salvar avatar
window.saveAvatar = async function(){
    if (!window.currentUser || !selectedAvatar) return;
    const saveBtn = document.getElementById('avatar-save-btn');
    saveBtn.disabled = true;
    saveBtn.textContent = 'Salvando...';
    try{
        const{ getDatabase, ref, update } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
        const database = getDatabase();
        await update(ref(database, `users/${window.currentUser.uid}`),{
            avatar: selectedAvatar
        });
        // Atualizar perfil local
        window.userProfile.avatar = selectedAvatar;
        // Atualizar UI
        document.getElementById('profile-avatar').textContent = selectedAvatar;
        // Fechar modal
        closeAvatarModal();
        saveBtn.disabled = false;
        saveBtn.textContent = 'Salvar Avatar';
    } catch (error){
        console.error('Erro ao salvar avatar:', error);
        alert('Erro ao salvar avatar. Tente novamente.');
        saveBtn.disabled = false;
        saveBtn.textContent = 'Salvar Avatar';
    }
};
// Fechar modal ao clicar fora
document.addEventListener('click', (e) =>{
    const modal = document.getElementById('avatar-modal');
    if (e.target === modal){
        closeAvatarModal();
    }
});
</script>

<!-- PWA Service Worker Registration -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then((reg) => console.log('Service Worker registrado!', reg.scope))
        .catch((err) => console.log('Falha ao registrar:', err));
    });
  }
</script>
</script>
</body>
</html>
