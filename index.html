<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Santo Rosário · Método Montfort</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/rosario-tradicional/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/rosario-tradicional/icon-192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/rosario-tradicional/icon-192.png">
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Reze o Santo Rosário pelo Método de São Luís de Montfort. App completo com meditações, calendário e acompanhamento.">
    <meta name="theme-color" content="#080709">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Rosário">
    <link rel="manifest" href="/rosario-tradicional/manifest.json">
    <link rel="apple-touch-icon" href="/rosario-tradicional/icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/rosario-tradicional/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/rosario-tradicional/icon-192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/rosario-tradicional/icon-192.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg-deep: #080709;
            --bg-primary: #0d0b0e;
            --bg-secondary: #151316;
            --bg-elevated: #1d1a1f;
            --bg-card: #1a171c;
            --text-primary: #f4f1eb;
            --text-secondary: #c2b8aa;
            --text-muted: #7d7470;
            --text-dim: #4d4845;
            --gold: #d4a855;
            --gold-bright: #f5d680;
            --gold-light: #e8c45a;
            --gold-dim: #a58540;
            --gold-dark: #6a5225;
            --gold-glow: rgba(212, 168, 85, 0.5);
            --burgundy: #6b2d3d;
            --burgundy-light: #8a3d50;
            --burgundy-bright: #a04d62;
            --burgundy-glow: rgba(138, 61, 80, 0.5);
            --cream: #faf5e8;
            --border-subtle: rgba(212, 168, 85, 0.1);
            --border-gold: rgba(212, 168, 85, 0.25);
            --font-display: 'Cinzel', serif;
            --font-body: 'Cormorant Garamond', serif;
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
            --bead-size: 48px;
            --bead-size-small: 36px;
            --bead-size-pater: 56px;
            --bead-gap: 20px;
            --rail-width: 110px;
        }
        *{ box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent;}
        html, body{ height: 100%; overflow: hidden;}
        body{
            background: var(--bg-deep);
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: 18px;
            line-height: 1.6;
        }
        /* Textura de fundo refinada */
        body::before{
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(ellipse at 15% 15%, rgba(107, 45, 61, 0.12) 0%, transparent 45%),
                radial-gradient(ellipse at 85% 85%, rgba(212, 168, 85, 0.08) 0%, transparent 45%),
                radial-gradient(ellipse at 50% 50%, rgba(20, 18, 22, 0.5) 0%, transparent 100%);
            pointer-events: none;
            z-index: 0;
        }
        /* ===== TELA DE AUTENTICAÇÃO ===== */
        #auth-screen{
    position: fixed; inset: 0;
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: flex-start;
    padding: 28px;
    padding-top: 60px;
    overflow-y: auto;
    overflow-x: hidden;
    z-index: 200;
    transition: opacity 0.6s var(--ease-out), visibility 0.6s;
}
        #auth-screen.hidden{ opacity: 0; visibility: hidden; pointer-events: none;}
        .auth-container{ width: 100%; max-width: 380px; text-align: center;}
        .auth-logo{ width: 50px; height: 70px; position: relative; margin: 0 auto 24px;}
        .auth-logo::before,
        .auth-logo::after{
            content: ''; position: absolute;
            background: linear-gradient(180deg, var(--gold-bright) 0%, var(--gold) 50%, var(--gold-dim) 100%);
            border-radius: 2px;
        }
        .auth-logo::before{ width: 4px; height: 100%; left: 50%; transform: translateX(-50%);}
        .auth-logo::after{ width: 40px; height: 4px; top: 20px; left: 50%; transform: translateX(-50%);}
        .auth-title{
            font-family: var(--font-display); font-size: 1.8rem; font-weight: 500;
            letter-spacing: 0.2em; color: var(--text-primary); margin-bottom: 6px;
        }
        .auth-subtitle{
            font-family: var(--font-body); font-size: 1rem; font-style: italic;
            color: var(--text-muted); margin-bottom: 20px;
        }
        .auth-info{
            background: rgba(212, 168, 85, 0.1); border: 1px solid var(--border-subtle);
            border-radius: 8px; padding: 16px; margin-bottom: 24px;
            font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6;
        }
        .auth-tabs{ display: flex; margin-bottom: 28px; border-bottom: 1px solid var(--border-subtle);}
        .auth-tab{
            flex: 1; padding: 14px; background: none; border: none;
            font-family: var(--font-display); font-size: 0.75rem;
            letter-spacing: 0.15em; text-transform: uppercase;
            color: var(--text-muted); cursor: pointer;
            transition: all 0.3s; position: relative;
        }
        .auth-tab::after{
            content: ''; position: absolute; bottom: -1px;
            left: 50%; transform: translateX(-50%); width: 0; height: 2px;
            background: var(--gold); transition: width 0.3s var(--ease-out);
        }
        .auth-tab.active{ color: var(--gold);}
        .auth-tab.active::after{ width: 60%;}
        .auth-form{ display: none;}
        .auth-form.active{ display: block;}
        .input-group{ margin-bottom: 18px; text-align: left;}
        .input-label{
            display: block; font-family: var(--font-display);
            font-size: 0.6rem; letter-spacing: 0.2em;
            text-transform: uppercase; color: var(--text-dim); margin-bottom: 8px;
        }
        .input-field{
            width: 100%; padding: 14px 16px; background: #0f0d10;
            border: 1px solid var(--border-subtle); border-radius: 4px;
            font-family: var(--font-body); font-size: 1.05rem;
            color: var(--text-primary); transition: all 0.3s;
        }
        .input-field:focus{
            outline: none; border-color: var(--gold-dim);
            box-shadow: 0 0 0 3px rgba(212, 168, 85, 0.1);
        }
        .input-field::placeholder{ color: var(--text-dim);}
        .auth-btn{
            width: 100%; padding: 16px; margin-top: 8px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%);
            border: none; border-radius: 4px;
            font-family: var(--font-display); font-size: 0.85rem;
            letter-spacing: 0.15em; text-transform: uppercase;
            color: var(--bg-deep); cursor: pointer; transition: all 0.3s;
        }
        .auth-btn:hover{
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 168, 85, 0.3);
        }
        .auth-btn:disabled{ opacity: 0.6; cursor: not-allowed;}
        .auth-error, .auth-success{
            margin-top: 16px; padding: 12px; border-radius: 4px;
            font-size: 0.9rem; display: none;
        }
        .auth-error{
            background: rgba(180, 60, 60, 0.15);
            border: 1px solid rgba(180, 60, 60, 0.3);
            color: #e07070;
        }
        .auth-success{
            background: rgba(74, 158, 107, 0.15);
            border: 1px solid rgba(74, 158, 107, 0.3);
            color: #70e070;
        }
        .auth-error.visible, .auth-success.visible{ display: block;}
        .loading{
            display: inline-block; width: 20px; height: 20px;
            border: 3px solid rgba(212, 168, 85, 0.3);
            border-radius: 50%; border-top-color: var(--gold);
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin{ to{ transform: rotate(360deg);} }
        /* ===== MODAL DE AVATAR ===== */
        #avatar-modal{
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 300;
            padding: 24px;
        }
        #avatar-modal.active{
            opacity: 1;
            visibility: visible;
        }
        .avatar-modal-content{
            width: 100%;
            max-width: 420px;
            background: var(--bg-card);
            border: 1px solid var(--border-gold);
            border-radius: 16px;
            padding: 32px 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            position: relative;
        }
        .avatar-modal-close{
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            line-height: 1;
        }
        .avatar-modal-close:hover{
            color: var(--gold);
        }
        .avatar-modal-title{
            font-family: var(--font-display);
            font-size: 1.1rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 28px;
        }
        .avatar-grid{
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        .avatar-option{
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.02);
            border: 2px solid var(--border-subtle);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s var(--ease-smooth);
        }
        .avatar-option:hover{
            border-color: var(--gold-dim);
            background: rgba(212, 168, 85, 0.05);
            transform: scale(1.08);
        }
        .avatar-option.selected{
            border-color: var(--gold);
            background: linear-gradient(135deg, rgba(212, 168, 85, 0.15) 0%, rgba(212, 168, 85, 0.05) 100%);
            box-shadow: 0 0 20px rgba(212, 168, 85, 0.3);
            transform: scale(1.1);
        }
        .avatar-save-btn{
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--gold-dim) 0%, var(--gold) 100%);
            border: 1px solid var(--gold-light);
            border-radius: 8px;
            font-family: var(--font-display);
            font-size: 0.85rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--bg-deep);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        .avatar-save-btn:hover{
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-bright) 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 168, 85, 0.4);
        }
        .avatar-save-btn:disabled{
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        /* ===== HOME COM SCROLL E SHADOW ===== */
        .home-screen-content{
            overflow-y: auto;
            overflow-x: hidden;
            height: 100%;
            padding: 24px 24px 100px 24px; /* Padding extra no final */
            position: relative;
        }
        /* Ajustes de tamanho para as caixas */
        .tab-content{
            display: none;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
        }
        .tab-content.active{
            display: block;
        }
        /* Shadow gradient para todas as tabs */
        .tab-content::after{
            content: '';
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to top, rgba(8, 7, 9, 1) 0%, rgba(8, 7, 9, 0.8) 50%, transparent 100%);
            pointer-events: none;
            z-index: 50;
        }
        /* Shadow específico para home */
        .home-screen-content::after{
            content: '';
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to top, rgba(8, 7, 9, 1) 0%, rgba(8, 7, 9, 0.8) 50%, transparent 100%);
            pointer-events: none;
            z-index: 50;
        }
        /* ===== ESTRUTURA PRINCIPAL COM NAVBAR ===== */
        #main-app{
            position: fixed; inset: 0;
            display: flex; flex-direction: column;
            transition: opacity 0.6s var(--ease-out), visibility 0.6s;
            z-index: 100;
        }
        #main-app.hidden{ opacity: 0; visibility: hidden; pointer-events: none;}
        .app-content{
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 70px;
        }
        .tab-content{
            display: none;
            width: 100%;
            height: 100%;
        }
        .tab-content.active{
            display: flex;
            flex-direction: column;
        }
        /* Bottom Navigation */
        .bottom-nav{
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-deep) 100%);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            z-index: 150;
        }
        .nav-item{
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px 0;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        .nav-icon{
            width: 26px;
            height: 26px;
            color: var(--text-dim);
            transition: all 0.3s;
            margin-bottom: 4px;
        }
        .nav-label{
            font-family: var(--font-display);
            font-size: 0.5rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--text-dim);
            transition: all 0.3s;
        }
        .nav-item.active .nav-icon{
            color: var(--gold);
            filter: drop-shadow(0 0 8px var(--gold-glow));
        }
        .nav-item.active .nav-label{
            color: var(--gold);
        }
        .nav-item::before{
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: var(--gold);
            transition: width 0.3s var(--ease-out);
        }
        .nav-item.active::before{
            width: 40px;
        }
        /* ===== TELA INICIAL (HOME TAB) ===== */
        .home-screen-content{
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100%;
            padding: 28px;
        }
        /* Cruz decorativa */
        .home-cross{
            width: 50px;
            height: 70px;
            position: relative;
            margin-bottom: 24px;
        }
        .home-cross::before,
        .home-cross::after{
            content: '';
            position: absolute;
            background: linear-gradient(180deg, var(--gold-bright) 0%, var(--gold) 50%, var(--gold-dim) 100%);
            border-radius: 2px;
        }
        .home-cross::before{
            width: 4px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
        }
        .home-cross::after{
            width: 36px;
            height: 4px;
            top: 18px;
            left: 50%;
            transform: translateX(-50%);
        }
        .home-cross-glow{
            position: absolute;
            inset: -20px;
            background: radial-gradient(circle, var(--gold-glow) 0%, transparent 70%);
            opacity: 0.5;
            animation: cross-glow 4s ease-in-out infinite;
        }
        @keyframes cross-glow{
            0%, 100%{ opacity: 0.4; transform: scale(0.95);}
            50%{ opacity: 0.7; transform: scale(1.05);}
        }
        .home-title{
            font-family: var(--font-display);
            font-size: 2.2rem;
            font-weight: 500;
            letter-spacing: 0.25em;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-shadow: 0 2px 20px rgba(0,0,0,0.5);
        }
        .home-subtitle{
            font-family: var(--font-body);
            font-size: 1.1rem;
            font-style: italic;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        .home-method{
            font-family: var(--font-display);
            font-size: 0.6rem;
            letter-spacing: 0.3em;
            color: var(--gold);
            text-transform: uppercase;
            margin-bottom: 36px;
            padding: 10px 20px;
            border: 1px solid var(--border-gold);
            background: linear-gradient(135deg, rgba(212, 168, 85, 0.08) 0%, rgba(212, 168, 85, 0.02) 100%);
            position: relative;
        }
        .home-method::before,
        .home-method::after{
            content: '✦';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gold-dim);
            font-size: 0.5rem;
        }
        .home-method::before{ left: 8px;}
        .home-method::after{ right: 8px;}
        .today-info{
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 32px;
            text-align: center;
        }
        .today-info strong{
            color: var(--gold);
            font-weight: 500;
        }
        .menu-section{
            width: 100%;
            max-width: 360px;
            margin-bottom: 24px;
        }
        .menu-label{
            font-family: var(--font-display);
            font-size: 0.55rem;
            letter-spacing: 0.35em;
            color: var(--text-dim);
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .menu-label::before,
        .menu-label::after{
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-subtle), transparent);
        }
        .menu-grid{
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        /* ===== BOTÕES ELEGANTES - ESTILO ORIGINAL MELHORADO ===== */
        .btn-mystery{
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            padding: 22px 28px;
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 400;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.5s var(--ease-smooth);
            position: relative;
            overflow: hidden;
        }
        /* Efeito de luz que passa */
        .btn-mystery::before{
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(212, 168, 85, 0.15) 50%, 
                transparent 100%);
            transition: left 0.7s var(--ease-smooth);
        }
        /* Linha dourada inferior */
        .btn-mystery::after{
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
            transition: width 0.5s var(--ease-smooth);
        }
        .btn-mystery:hover::before{
            left: 100%;
        }
        .btn-mystery:hover::after{
            width: 70%;
        }
        .btn-mystery:hover{
            border-color: var(--gold-dim);
            color: var(--gold);
            background: rgba(212, 168, 85, 0.06);
            transform: translateY(-4px);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.4),
                0 0 50px rgba(212, 168, 85, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        .btn-mystery:active{
            transform: translateY(-2px);
            transition: transform 0.1s;
        }
        /* Botão do Rosário Completo */
        .btn-complete{
            background: linear-gradient(135deg, rgba(107, 45, 61, 0.2) 0%, rgba(107, 45, 61, 0.08) 100%);
            border: 1px solid rgba(138, 61, 80, 0.35);
            color: var(--cream);
            padding: 24px 28px;
            margin-top: 4px;
        }
        .btn-complete::before{
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(212, 168, 85, 0.2) 50%, 
                transparent 100%);
        }
        .btn-complete:hover{
            background: linear-gradient(135deg, rgba(107, 45, 61, 0.3) 0%, rgba(107, 45, 61, 0.12) 100%);
            border-color: var(--gold-dim);
            box-shadow: 
                0 18px 45px rgba(0, 0, 0, 0.45),
                0 0 60px rgba(212, 168, 85, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.06);
        }
        .btn-complete small{
            display: block;
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-style: italic;
            font-weight: 400;
            letter-spacing: 0.02em;
            text-transform: none;
            color: var(--text-muted);
            margin-top: 8px;
        }
        /* Botão de áudio */
        .audio-toggle{
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s var(--ease-smooth);
            z-index: 200;
        }
        .audio-toggle:hover{
            border-color: var(--gold-dim);
            color: var(--gold);
            transform: scale(1.05);
        }
        .audio-toggle.active{
            color: var(--gold);
            border-color: var(--gold-dim);
            background: rgba(212, 168, 85, 0.12);
            box-shadow: 0 0 20px rgba(212, 168, 85, 0.2);
        }
        .audio-toggle svg{ width: 22px; height: 22px;}
        /* ===== TELA DE ORAÇÃO ===== */
        #prayer-screen{
            position: fixed; inset: 0;
            display: flex; flex-direction: row;
            background: var(--bg-deep);
            opacity: 0; visibility: hidden;
            transition: opacity 0.6s var(--ease-out), visibility 0.6s;
            z-index: 200;
        }
        #prayer-screen.active{ opacity: 1; visibility: visible;}
        /* Trilho do Rosário */
        .rosary-rail{
            position: relative;
            width: var(--rail-width);
            height: 100%;
            background: linear-gradient(90deg, var(--bg-primary) 0%, var(--bg-deep) 100%);
            border-right: 1px solid rgba(212, 168, 85, 0.06);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
        }
        .rosary-rail::before,
        .rosary-rail::after{
            content: '';
            position: absolute;
            left: 0; right: 0;
            height: 140px;
            z-index: 10;
            pointer-events: none;
        }
        .rosary-rail::before{
            top: 0;
            background: linear-gradient(180deg, var(--bg-deep) 0%, rgba(8, 7, 9, 0.8) 50%, transparent 100%);
        }
        .rosary-rail::after{
            bottom: 0;
            background: linear-gradient(0deg, var(--bg-deep) 0%, rgba(8, 7, 9, 0.8) 50%, transparent 100%);
        }
        /* Corrente dourada */
        .rosary-chain{
            position: absolute;
            top: 50%; left: 50%;
            width: 3px;
            height: calc(100% + 300px);
            transform: translate(-50%, -50%);
            background: linear-gradient(180deg, 
                transparent 0%, 
                var(--gold-dark) 3%,
                var(--gold-dim) 15%,
                var(--gold) 50%,
                var(--gold-dim) 85%,
                var(--gold-dark) 97%,
                transparent 100%);
            opacity: 0.4;
            border-radius: 2px;
        }
        /* Guia central */
        .center-guide{
            position: absolute;
            top: 50%;
            left: 15%;
            right: 15%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(212, 168, 85, 0.2), transparent);
            transform: translateY(-50%);
            z-index: 5;
        }
        /* Container das contas */
        #bead-track{
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, 0);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--bead-gap);
            transition: transform 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            will-change: transform;
            padding: 100px 0;
        }
        /* ===== CONTAS BRILHANTES E REALISTAS ===== */
        .bead{
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.45s var(--ease-smooth);
            position: relative;
            flex-shrink: 0;
            background: transparent;
        }
        /* Aura de luz ao redor da conta ativa */
        .bead::before{
            content: '';
            position: absolute;
            inset: -15px;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
            transform: scale(0.5);
            z-index: -1;
        }
        .bead.active::before{
            opacity: 1;
            transform: scale(1);
            animation: bead-aura 2.5s ease-in-out infinite;
        }
        @keyframes bead-aura{
            0%, 100%{ opacity: 1; transform: scale(1);}
            50%{ opacity: 0.6; transform: scale(1.25);}
        }
        /* Brilho interno sutil */
        .bead::after{
            content: '';
            position: absolute;
            inset: 3px;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        .bead:hover::after,
        .bead.active::after{
            opacity: 1;
        }
        /* ===== CONTA AVE MARIA - Círculo dourado hollow pequeno ===== */
        .bead.ave{
            width: var(--bead-size-small);
            height: var(--bead-size-small);
            border: 2.5px solid var(--gold);
            box-shadow: 
                0 0 12px rgba(212, 168, 85, 0.4),
                0 0 20px rgba(212, 168, 85, 0.15),
                inset 0 0 8px rgba(212, 168, 85, 0.2);
        }
        .bead.ave::before{
            background: radial-gradient(circle, rgba(212, 168, 85, 0.5) 0%, transparent 70%);
        }
        .bead.ave::after{
            background: radial-gradient(circle at 30% 30%, rgba(255, 230, 150, 0.4) 0%, transparent 60%);
        }
        .bead.ave:hover{
            transform: scale(1.12);
            border-color: var(--gold-bright);
            box-shadow: 
                0 0 20px rgba(212, 168, 85, 0.6),
                0 0 35px rgba(212, 168, 85, 0.3),
                inset 0 0 15px rgba(212, 168, 85, 0.3);
        }
        .bead.ave.active{
            width: var(--bead-size);
            height: var(--bead-size);
            transform: scale(1.2);
            border-width: 3px;
            border-color: var(--gold-bright);
            box-shadow: 
                0 0 30px rgba(212, 168, 85, 0.8),
                0 0 50px rgba(212, 168, 85, 0.5),
                0 0 80px rgba(212, 168, 85, 0.25),
                inset 0 0 25px rgba(212, 168, 85, 0.4);
            animation: bead-pulse 2s ease-in-out infinite;
        }
        @keyframes bead-pulse{
            0%, 100%{ 
                border-color: var(--gold-bright);
                box-shadow: 
                    0 0 30px rgba(212, 168, 85, 0.8),
                    0 0 50px rgba(212, 168, 85, 0.5),
                    0 0 80px rgba(212, 168, 85, 0.25),
                    inset 0 0 25px rgba(212, 168, 85, 0.4);
            }
            50%{ 
                border-color: #ffe890;
                box-shadow: 
                    0 0 40px rgba(212, 168, 85, 1),
                    0 0 70px rgba(212, 168, 85, 0.6),
                    0 0 100px rgba(212, 168, 85, 0.3),
                    inset 0 0 35px rgba(212, 168, 85, 0.5);
            }
        }
        /* ===== CONTA PAI NOSSO - Círculo dourado hollow maior ===== */
        .bead.pater{
            width: calc(var(--bead-size-small) + 14px);
            height: calc(var(--bead-size-small) + 14px);
            border: 3px solid var(--gold-bright);
            box-shadow: 
                0 0 18px rgba(212, 168, 85, 0.6),
                0 0 30px rgba(212, 168, 85, 0.3),
                inset 0 0 12px rgba(212, 168, 85, 0.3);
        }
        .bead.pater::before{
            background: radial-gradient(circle, var(--gold-glow) 0%, transparent 65%);
        }
        .bead.pater::after{
            background: radial-gradient(circle at 25% 25%, rgba(255, 240, 180, 0.6) 0%, transparent 55%);
        }
        .bead.pater:hover{
            transform: scale(1.12);
            border-color: #ffe890;
            box-shadow: 
                0 0 25px rgba(212, 168, 85, 0.8),
                0 0 45px rgba(212, 168, 85, 0.5),
                inset 0 0 20px rgba(212, 168, 85, 0.4);
        }
        .bead.pater.active{
            width: var(--bead-size-pater);
            height: var(--bead-size-pater);
            transform: scale(1.2);
            border-width: 4px;
            border-color: #ffe890;
            box-shadow: 
                0 0 40px rgba(212, 168, 85, 1),
                0 0 65px rgba(212, 168, 85, 0.7),
                0 0 100px rgba(212, 168, 85, 0.4),
                inset 0 0 30px rgba(212, 168, 85, 0.5);
            animation: bead-pulse-pater 2s ease-in-out infinite;
        }
        @keyframes bead-pulse-pater{
            0%, 100%{ 
                border-color: #ffe890;
                box-shadow: 
                    0 0 40px rgba(212, 168, 85, 1),
                    0 0 65px rgba(212, 168, 85, 0.7),
                    0 0 100px rgba(212, 168, 85, 0.4),
                    inset 0 0 30px rgba(212, 168, 85, 0.5);
            }
            50%{ 
                border-color: #fff5c0;
                box-shadow: 
                    0 0 50px rgba(255, 230, 150, 1),
                    0 0 85px rgba(212, 168, 85, 0.8),
                    0 0 120px rgba(212, 168, 85, 0.5),
                    inset 0 0 40px rgba(212, 168, 85, 0.6);
            }
        }
        /* ===== CONTA ESPECIAL - Círculo dourado hollow médio com toque burgundy ===== */
        .bead.special{
            width: calc(var(--bead-size-small) + 10px);
            height: calc(var(--bead-size-small) + 10px);
            border: 2.5px solid var(--gold);
            box-shadow: 
                0 0 15px rgba(212, 168, 85, 0.5),
                0 0 25px rgba(138, 61, 80, 0.3),
                inset 0 0 10px rgba(212, 168, 85, 0.25);
        }
        .bead.special::before{
            background: radial-gradient(circle, rgba(212, 168, 85, 0.4) 0%, rgba(138, 61, 80, 0.2) 40%, transparent 70%);
        }
        .bead.special::after{
            background: radial-gradient(circle at 28% 28%, rgba(255, 230, 150, 0.5) 0%, transparent 55%);
        }
        .bead.special:hover{
            transform: scale(1.12);
            border-color: var(--gold-bright);
            box-shadow: 
                0 0 22px rgba(212, 168, 85, 0.7),
                0 0 38px rgba(138, 61, 80, 0.4),
                inset 0 0 18px rgba(212, 168, 85, 0.35);
        }
        .bead.special.active{
            width: calc(var(--bead-size) + 10px);
            height: calc(var(--bead-size) + 10px);
            transform: scale(1.2);
            border-width: 3.5px;
            border-color: var(--gold-bright);
            box-shadow: 
                0 0 35px rgba(212, 168, 85, 0.85),
                0 0 55px rgba(138, 61, 80, 0.5),
                0 0 85px rgba(212, 168, 85, 0.35),
                inset 0 0 28px rgba(212, 168, 85, 0.45);
            animation: bead-pulse-special 2.2s ease-in-out infinite;
        }
        @keyframes bead-pulse-special{
            0%, 100%{ 
                border-color: var(--gold-bright);
                box-shadow: 
                    0 0 35px rgba(212, 168, 85, 0.85),
                    0 0 55px rgba(138, 61, 80, 0.5),
                    0 0 85px rgba(212, 168, 85, 0.35),
                    inset 0 0 28px rgba(212, 168, 85, 0.45);
            }
            50%{ 
                border-color: #ffe890;
                box-shadow: 
                    0 0 45px rgba(212, 168, 85, 1),
                    0 0 70px rgba(138, 61, 80, 0.6),
                    0 0 105px rgba(212, 168, 85, 0.45),
                    inset 0 0 38px rgba(212, 168, 85, 0.55);
            }
        }
        /* ===== CONTAS RETANGULARES (Glória e Fátima) ===== */
        .bead.rectangle-bead{
            border-radius: 18px !important;
            width: calc(var(--bead-size-small) + 20px) !important;
            height: calc(var(--bead-size-small) - 4px) !important;
        }
        .bead.rectangle-bead.active{
            width: calc(var(--bead-size) + 24px) !important;
            height: var(--bead-size) !important;
            border-radius: 20px !important;
        }
        .bead.rectangle-bead:hover{
            transform: scale(1.08);
        }
        .bead.rectangle-bead.active{
            transform: scale(1.15);
        }
        /* Conteúdo principal */
        .prayer-main{
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            position: relative;
        }
        .prayer-header{
            padding: 18px 24px;
            background: linear-gradient(180deg, var(--bg-primary) 0%, transparent 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }
        .back-btn{
            background: none;
            border: none;
            color: var(--text-muted);
            font-family: var(--font-display);
            font-size: 0.65rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            cursor: pointer;
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .back-btn:hover{
            color: var(--gold);
            transform: translateX(-3px);
        }
        .back-btn svg{ width: 16px; height: 16px;}
        .progress-compact{
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .progress-bar-mini{
            width: 90px;
            height: 3px;
            background: var(--bg-elevated);
            border-radius: 2px;
            overflow: hidden;
        }
        .progress-fill-mini{
            height: 100%;
            background: linear-gradient(90deg, var(--gold-dim), var(--gold), var(--gold-bright));
            transition: width 0.5s var(--ease-out);
            border-radius: 2px;
        }
        .progress-text{
            font-family: var(--font-display);
            font-size: 0.65rem;
            color: var(--text-dim);
            letter-spacing: 0.08em;
        }
        .prayer-body{
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 32px 32px;
            overflow-y: auto;
        }
        .prayer-group{
            font-family: var(--font-display);
            font-size: 0.6rem;
            letter-spacing: 0.28em;
            text-transform: uppercase;
            color: var(--gold-dim);
            margin-bottom: 8px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.45s var(--ease-out);
        }
        .prayer-group.visible{ opacity: 1; transform: translateY(0);}
        .prayer-mystery{
            font-family: var(--font-body);
            font-size: 1.2rem;
            font-style: italic;
            color: var(--text-secondary);
            margin-bottom: 18px;
            min-height: 1.5em;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.45s var(--ease-out) 0.05s;
        }
        .prayer-mystery.visible{ opacity: 1; transform: translateY(0);}
        .prayer-name{
            font-family: var(--font-display);
            font-size: 2.2rem;
            font-weight: 500;
            color: var(--text-primary);
            letter-spacing: 0.05em;
            margin-bottom: 8px;
            opacity: 0;
            transform: translateY(-12px);
            transition: all 0.45s var(--ease-out) 0.1s;
        }
        .prayer-name.visible{ opacity: 1; transform: translateY(0);}
        .prayer-count{
            font-family: var(--font-display);
            font-size: 0.7rem;
            letter-spacing: 0.18em;
            color: var(--text-dim);
            margin-bottom: 24px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.45s var(--ease-out) 0.15s;
        }
        .prayer-count.visible{ opacity: 1; transform: translateY(0);}
        /* Caixa de meditação refinada */
        .meditation-box{
            background: linear-gradient(135deg, rgba(212, 168, 85, 0.1) 0%, rgba(212, 168, 85, 0.03) 100%);
            border-left: 3px solid var(--gold);
            padding: 20px 24px;
            margin-bottom: 24px;
            opacity: 0;
            transform: translateX(-15px);
            transition: all 0.5s var(--ease-out) 0.2s;
            position: relative;
        }
        .meditation-box::before{
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, var(--gold-dim), transparent);
        }
        .meditation-box.visible{ opacity: 1; transform: translateX(0);}
        .meditation-label{
            font-family: var(--font-display);
            font-size: 0.55rem;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 10px;
        }
        .meditation-text{
            font-family: var(--font-body);
            font-size: 1.2rem;
            font-style: italic;
            color: var(--text-primary);
            line-height: 1.75;
        }
        /* Toggle do texto da oração */
        .prayer-text-toggle{
            background: none;
            border: 1px solid var(--border-subtle);
            color: var(--text-muted);
            font-family: var(--font-display);
            font-size: 0.6rem;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            padding: 12px 18px;
            cursor: pointer;
            transition: all 0.35s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-bottom: 14px;
        }
        .prayer-text-toggle:hover{
            border-color: var(--border-gold);
            color: var(--gold);
            background: rgba(212, 168, 85, 0.04);
        }
        .prayer-text-toggle svg{
            width: 14px;
            height: 14px;
            transition: transform 0.35s var(--ease-out);
        }
        .prayer-text-toggle.expanded svg{ transform: rotate(180deg);}
        .prayer-full-text{
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.45s var(--ease-out), opacity 0.35s, padding 0.35s;
            opacity: 0;
            background: var(--bg-card);
            border-radius: 6px;
            border: 1px solid var(--border-subtle);
        }
        .prayer-full-text.visible{
            max-height: 420px;
            opacity: 1;
            padding: 18px 20px;
            margin-bottom: 18px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .prayer-full-text p{
            font-family: var(--font-body);
            font-size: 1.05rem;
            color: var(--text-secondary);
            line-height: 1.85;
        }
        /* Footer com navegação */
        .prayer-footer{
            padding: 18px 24px;
            background: linear-gradient(0deg, var(--bg-primary) 0%, transparent 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 18px;
            flex-shrink: 0;
        }
        .nav-btn{
            width: 54px;
            height: 54px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.35s var(--ease-smooth);
        }
        .nav-btn:hover:not(:disabled){
            background: var(--bg-elevated);
            border-color: var(--border-gold);
            color: var(--gold);
            transform: scale(1.08);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        .nav-btn:disabled{ opacity: 0.25; cursor: not-allowed;}
        .nav-btn svg{ width: 24px; height: 24px;}
        .nav-btn.primary{
            width: 68px;
            height: 68px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%);
            border: none;
            color: var(--bg-deep);
            box-shadow: 0 4px 20px rgba(212, 168, 85, 0.3);
        }
        .nav-btn.primary:hover:not(:disabled){
            background: linear-gradient(135deg, var(--gold-bright) 0%, var(--gold) 100%);
            transform: scale(1.1);
            box-shadow: 0 0 35px rgba(212, 168, 85, 0.5), 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        .nav-hint{
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            font-family: var(--font-body);
            font-size: 0.8rem;
            color: var(--text-dim);
            font-style: italic;
            white-space: nowrap;
        }
        /* ===== TELA DE CONCLUSÃO ===== */
        #completion-screen{
            position: fixed; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 28px;
            background: var(--bg-deep);
            z-index: 200;
            opacity: 0; visibility: hidden;
            transition: opacity 0.6s var(--ease-out), visibility 0.6s;
        }
        #completion-screen.active{ opacity: 1; visibility: visible;}
        .completion-icon{
            width: 100px;
            height: 100px;
            color: var(--gold);
            margin-bottom: 28px;
            animation: completion-glow 2.5s ease-in-out infinite;
        }
        @keyframes completion-glow{
            0%, 100%{ filter: drop-shadow(0 0 20px rgba(212, 168, 85, 0.4)); transform: scale(1);}
            50%{ filter: drop-shadow(0 0 40px rgba(212, 168, 85, 0.7)); transform: scale(1.06);}
        }
        .completion-title{
            font-family: var(--font-display);
            font-size: 1.8rem;
            color: var(--text-primary);
            letter-spacing: 0.18em;
            margin-bottom: 10px;
        }
        .completion-subtitle{
            font-family: var(--font-body);
            font-size: 1.1rem;
            font-style: italic;
            color: var(--text-secondary);
            text-align: center;
            max-width: 340px;
            margin-bottom: 32px;
            line-height: 1.6;
        }
        .completion-stats{
            display: flex;
            gap: 40px;
            margin-bottom: 36px;
        }
        .stat{ text-align: center;}
        .stat-value{
            font-family: var(--font-display);
            font-size: 2.4rem;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(212, 168, 85, 0.3);
        }
        .stat-label{
            font-family: var(--font-body);
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 4px;
        }
        .btn-home{
            background: var(--bg-card);
            border: 1px solid var(--border-gold);
            color: var(--gold);
            padding: 16px 32px;
            font-family: var(--font-display);
            font-size: 0.85rem;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.35s;
        }
        .btn-home:hover{
            background: rgba(212, 168, 85, 0.12);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        }
        /* ===== RESPONSIVO ===== */
        @media (max-width: 768px){
            :root{
                --bead-size: 54px;
                --bead-size-small: 44px;
                --bead-size-pater: 62px;
                --bead-gap: 18px;
                --rail-width: 85px;
            }
            .rosary-rail{
                order: 2;
                width: var(--rail-width);
                background: linear-gradient(-90deg, var(--bg-primary) 0%, var(--bg-deep) 100%);
                border-right: none;
                border-left: 1px solid rgba(212, 168, 85, 0.06);
            }
            .rosary-rail::before, .rosary-rail::after{ height: 110px;}
            .prayer-main{ order: 1;}
            .prayer-body{ padding: 24px 20px;}
            .prayer-name{ font-size: 1.8rem;}
            .meditation-text{ font-size: 1.1rem;}
            .nav-btn{ width: 52px; height: 52px;}
            .nav-btn.primary{ width: 62px; height: 62px;}
            .nav-hint{ display: none;}
            .progress-bar-mini{ width: 70px;}
            .audio-toggle{ bottom: 110px; right: 14px; width: 44px; height: 44px;}
            .home-title{ font-size: 1.8rem;}
        }
        @media (max-width: 380px){
            :root{
                --rail-width: 75px;
                --bead-size: 50px;
                --bead-size-small: 40px;
                --bead-size-pater: 56px;
            }
            .prayer-body{ padding: 18px 16px;}
            .prayer-name{ font-size: 1.5rem;}
            .meditation-text{ font-size: 1rem;}
            .home-title{ font-size: 1.6rem;}
        }
        @media (max-height: 500px) and (orientation: landscape){
            .rosary-rail{ width: 75px;}
            .prayer-header, .prayer-footer{ padding: 12px 18px;}
            .prayer-body{ padding: 14px 18px;}
            .prayer-name{ font-size: 1.5rem; margin-bottom: 5px;}
            .meditation-box{ padding: 14px 16px; margin-bottom: 14px;}
        }
    </style>
</head>
<body>
<!-- TELA DE AUTENTICAÇÃO -->
<div id="auth-screen">
    <div class="auth-container">
        <div class="auth-logo"></div>
        <h1 class="auth-title">Rosário</h1>
        <p class="auth-subtitle">Método de São Luís de Montfort</p>
        <div class="auth-info">
            ✨ <strong>Autenticação Segura:</strong> Seus dados são protegidos com Firebase!
        </div>
        <div class="auth-tabs">
            <button class="auth-tab active" data-tab="login" type="button">Entrar</button>
            <button class="auth-tab" data-tab="register" type="button">Criar Conta</button>
        </div>
        <form id="login-form" class="auth-form active">
            <div class="input-group">
                <label class="input-label">Nome de Usuário</label>
                <input type="text" class="input-field" id="login-username" placeholder="Seu nome de usuário" required autocomplete="username">
            </div>
            <div class="input-group">
                <label class="input-label">Senha</label>
                <input type="password" class="input-field" id="login-password" placeholder="Sua senha" required autocomplete="current-password">
            </div>
            <button type="submit" class="auth-btn" id="login-btn">Entrar</button>
            <div class="auth-error" id="login-error"></div>
        </form>
        <form id="register-form" class="auth-form">
            <div class="input-group">
                <label class="input-label">Nome de Usuário</label>
                <input type="text" class="input-field" id="register-username" placeholder="Escolha um nome" required minlength="3" autocomplete="username">
            </div>
            <div class="input-group">
                <label class="input-label">Nome Completo</label>
                <input type="text" class="input-field" id="register-displayname" placeholder="Seu nome completo" required minlength="2" autocomplete="name">
            </div>
            <div class="input-group">
                <label class="input-label">Crie uma Senha</label>
                <input type="password" class="input-field" id="register-password" placeholder="Mínimo 6 caracteres" required minlength="6" autocomplete="new-password">
            </div>
            <div class="input-group">
                <label class="input-label">Confirme a Senha</label>
                <input type="password" class="input-field" id="register-confirm" placeholder="Repita a senha" required autocomplete="new-password">
            </div>
            <button type="submit" class="auth-btn" id="register-btn">Criar Conta</button>
            <div class="auth-error" id="register-error"></div>
            <div class="auth-success" id="register-success"></div>
        </form>
    </div>
</div>
<!-- APLICATIVO PRINCIPAL -->
<div id="main-app" class="hidden">
    <div class="app-content">
        <!-- TAB HOME -->
        <div id="tab-home" class="tab-content active">
            <div class="home-screen-content" style="padding: 24px;">
                <!-- Header do usuário -->
                <div style="text-align: center; margin-bottom: 28px;">
                    <p style="font-family: var(--font-body); font-size: 1rem; color: var(--text-muted); margin-bottom: 4px;">
                        Bem-vindo(a),
                    </p>
                    <h2 style="font-family: var(--font-display); font-size: 1.4rem; color: var(--text-primary); letter-spacing: 0.1em;" id="home-user-name">
                        Peregrino
                    </h2>
                </div>
                <!-- Streak Card -->
                <div style="width: 100%; max-width: 360px; margin: 0 auto 24px; background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 32px 24px; text-align: center; position: relative; overflow: visible; min-height: 200px;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--gold-dim), var(--gold), var(--gold-dim));"></div>
                    <svg style="width: 50px; height: 50px; margin: 0 auto 12px; color: var(--gold);" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <div style="font-family: var(--font-display); font-size: 3.5rem; font-weight: 600; color: var(--gold); line-height: 1; text-shadow: 0 0 30px var(--gold-glow);" id="home-streak-count">0</div>
                    <div style="font-family: var(--font-display); font-size: 0.7rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--text-muted); margin-top: 8px;">Dias Consecutivos</div>
                    <p style="font-family: var(--font-body); font-size: 0.95rem; font-style: italic; color: var(--text-dim); margin-top: 12px;" id="home-streak-message">Comece hoje sua jornada de oração</p>
                </div>
                <!-- Intenção do Dia -->
                <div style="width: 100%; max-width: 360px; margin: 0 auto 24px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 24px; min-height: 120px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 14px;">
                        <svg style="width: 24px; height: 24px; color: var(--burgundy-light);" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        <span style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-muted);">Intenção do Dia</span>
                    </div>
                    <p style="font-family: var(--font-body); font-size: 1.1rem; font-style: italic; color: var(--text-secondary); line-height: 1.6;" id="home-intention">Carregando...</p>
                </div>
                <!-- Mistério do Dia -->
                <div style="width: 100%; max-width: 360px; margin: 0 auto 28px; text-align: center;">
                    <p style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.3em; text-transform: uppercase; color: var(--text-dim); margin-bottom: 4px;" id="home-today-day">Segunda-feira</p>
                    <p style="font-family: var(--font-body); font-size: 1.1rem; color: var(--gold);" id="home-today-mystery">Mistérios Gozosos</p>
                </div>
            </div>
        </div>
        <!-- TAB ROSÁRIO -->
        <div id="tab-rosary" class="tab-content">
            <div style="padding: 24px 24px 100px 24px; min-height: 100%;">
                <h2 style="font-family: var(--font-display); font-size: 1.2rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-primary); text-align: center; margin-bottom: 32px;">
                    Escolha o Rosário
                </h2>
                <!-- Mistério do Dia -->
                <div style="width: 100%; max-width: 360px; margin: 0 auto 32px; text-align: center; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 20px;">
                    <p style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.3em; text-transform: uppercase; color: var(--text-dim); margin-bottom: 8px;" id="rosary-today-day">Segunda-feira</p>
                    <p style="font-family: var(--font-body); font-size: 1.15rem; color: var(--gold); margin-bottom: 4px;" id="rosary-today-mystery">Mistérios Gozosos</p>
                    <p style="font-family: var(--font-body); font-size: 0.85rem; color: var(--text-dim); font-style: italic;">Recomendado para hoje</p>
                </div>
                <!-- Botões dos Mistérios -->
                <div style="width: 100%; max-width: 360px; margin: 0 auto;">
                    <div style="display: flex; flex-direction: column; gap: 14px;">
                        <button type="button" class="btn-mystery" onclick="app.start('gozosos')" style="padding: 20px 18px; font-size: 0.9rem; width: 100%;">
                            Mistérios Gozosos
                        </button>
                        <button type="button" class="btn-mystery" onclick="app.start('dolorosos')" style="padding: 20px 18px; font-size: 0.9rem; width: 100%;">
                            Mistérios Dolorosos
                        </button>
                        <button type="button" class="btn-mystery" onclick="app.start('gloriosos')" style="padding: 20px 18px; font-size: 0.9rem; width: 100%;">
                            Mistérios Gloriosos
                        </button>
                        <button type="button" class="btn-mystery btn-complete" onclick="app.start('completo')" style="padding: 24px 18px; font-size: 0.95rem; width: 100%; margin-top: 8px;">
                            Rosário Completo
                            <small style="display: block; margin-top: 6px; font-size: 0.75rem; opacity: 0.8;">Gozosos, Dolorosos e Gloriosos</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- TAB CALENDÁRIO -->
        <div id="tab-calendar" class="tab-content">
            <div style="padding: 24px 24px 100px 24px; min-height: 100%;">
                <h2 style="font-family: var(--font-display); font-size: 1.2rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-primary); text-align: center; margin-bottom: 24px;">
                    Calendário de Oração
                </h2>
                <!-- Intenção do Dia no Calendário -->
                <div style="width: 100%; max-width: 400px; margin: 0 auto 24px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 14px;">
                        <svg style="width: 24px; height: 24px; color: var(--burgundy-light);" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        <span style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-muted);">Intenção do Dia</span>
                    </div>
                    <p style="font-family: var(--font-body); font-size: 1.05rem; font-style: italic; color: var(--text-secondary); line-height: 1.6;" id="calendar-intention">Carregando...</p>
                </div>
                <!-- Seletor de Mês -->
                <div style="width: 100%; max-width: 400px; margin: 0 auto 16px; display: flex; align-items: center; justify-content: space-between;">
                    <button type="button" id="prev-month-btn" style="background: none; border: 1px solid var(--border-subtle); border-radius: 4px; padding: 8px 12px; color: var(--text-secondary); cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--gold-dim)'; this.style.color='var(--gold)';" onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.color='var(--text-secondary)';">
                        <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                    </button>
                    <h3 style="font-family: var(--font-display); font-size: 1rem; letter-spacing: 0.1em; color: var(--text-primary);" id="calendar-month-year">Janeiro 2026</h3>
                    <button type="button" id="next-month-btn" style="background: none; border: 1px solid var(--border-subtle); border-radius: 4px; padding: 8px 12px; color: var(--text-secondary); cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--gold-dim)'; this.style.color='var(--gold)';" onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.color='var(--text-secondary)';">
                        <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </button>
                </div>
                <!-- Calendário Grid -->
                <div style="width: 100%; max-width: 400px; margin: 0 auto; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 16px;">
                    <!-- Dias da Semana -->
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 12px;">
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Dom</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Seg</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Ter</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Qua</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Qui</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Sex</div>
                        <div style="font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); text-align: center;">Sáb</div>
                    </div>
                    <!-- Grid de Dias -->
                    <div id="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
                        <!-- Dias serão inseridos via JavaScript -->
                    </div>
                </div>
                <!-- Legenda -->
                <div style="width: 100%; max-width: 400px; margin: 24px auto 0; display: flex; gap: 16px; justify-content: center; font-family: var(--font-body); font-size: 0.85rem; color: var(--text-muted);">
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--gold); box-shadow: 0 0 8px var(--gold-glow);"></div>
                        <span>Rezou</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; border: 1px solid var(--border-subtle);"></div>
                        <span>Não rezou</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- TAB AMIGOS -->
        <div id="tab-friends" class="tab-content">
            <div style="padding: 24px 24px 100px 24px; min-height: 100%;">
                <h2 style="font-family: var(--font-display); font-size: 1.2rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-primary); text-align: center; margin-bottom: 24px;">
                    Amigos
                </h2>
                
                <!-- Buscar Amigos -->
                <div style="width: 100%; max-width: 400px; margin: 0 auto 24px;">
                    <div style="display: flex; gap: 8px;">
                        <input 
                            type="text" 
                            id="friend-search-input" 
                            placeholder="@nomedeusuario" 
                            style="flex: 1; padding: 12px 16px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 8px; font-family: var(--font-body); font-size: 1rem; color: var(--text-primary);"
                        />
                        <button 
                            type="button" 
                            onclick="searchFriend()" 
                            style="padding: 12px 20px; background: linear-gradient(135deg, var(--gold-dim) 0%, var(--gold) 100%); border: none; border-radius: 8px; color: var(--bg-deep); font-family: var(--font-display); font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer;"
                        >
                            Buscar
                        </button>
                    </div>
                    <div id="search-result" style="margin-top: 12px;"></div>
                </div>

                <!-- Pedidos Pendentes -->
                <div id="friend-requests-section" style="width: 100%; max-width: 400px; margin: 0 auto 24px; display: none;">
                    <h3 style="font-family: var(--font-display); font-size: 0.8rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 12px;">
                        Pedidos Recebidos
                    </h3>
                    <div id="friend-requests-list"></div>
                </div>

                <!-- Lista de Amigos -->
                <div style="width: 100%; max-width: 400px; margin: 0 auto;">
                    <h3 style="font-family: var(--font-display); font-size: 0.8rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 12px;">
                        Meus Amigos
                    </h3>
                    <div id="friends-list">
                        <p style="font-family: var(--font-body); font-size: 0.95rem; color: var(--text-dim); font-style: italic; text-align: center; padding: 40px 20px;">
                            Você ainda não tem amigos. Use a busca acima para encontrar outros usuários!
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- TAB PERFIL -->
        <div id="tab-profile" class="tab-content">
            <div style="padding: 24px 24px 100px 24px; min-height: 100%; display: flex; flex-direction: column; align-items: center;">
                <!-- Avatar e Nome -->
                <div style="text-align: center; margin-bottom: 32px;">
                    <div style="width: 80px; height: 80px; margin: 0 auto 16px; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: var(--font-display); font-size: 2rem; color: var(--bg-deep); cursor: pointer; transition: all 0.3s;" id="profile-avatar" onclick="openAvatarModal()" onmouseover="this.style.transform='scale(1.08)'; this.style.boxShadow='0 8px 25px rgba(212, 168, 85, 0.4)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                        👤
                    </div>
                    <h2 style="font-family: var(--font-display); font-size: 1.4rem; letter-spacing: 0.1em; color: var(--text-primary); margin-bottom: 8px;" id="profile-name">
                        Usuário
                    </h2>
                    <p style="font-family: var(--font-body); font-size: 0.75rem; color: var(--text-dim); font-style: italic; cursor: pointer;" onclick="openAvatarModal()">
                        Clique no avatar para alterar
                    </p>
                </div>
                <!-- Streak Card -->
                <div style="width: 100%; max-width: 360px; margin-bottom: 24px; background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 32px 24px; text-align: center; position: relative; overflow: visible; min-height: 200px;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--gold-dim), var(--gold), var(--gold-dim));"></div>
                    <svg style="width: 50px; height: 50px; margin: 0 auto 12px; color: var(--gold);" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <div style="font-family: var(--font-display); font-size: 3.5rem; font-weight: 600; color: var(--gold); line-height: 1; text-shadow: 0 0 30px var(--gold-glow);" id="profile-streak-count">0</div>
                    <div style="font-family: var(--font-display); font-size: 0.7rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--text-muted); margin-top: 8px;">Dias Consecutivos</div>
                    <p style="font-family: var(--font-body); font-size: 0.95rem; font-style: italic; color: var(--text-dim); margin-top: 12px;" id="profile-streak-message">Comece hoje sua jornada de oração</p>
                </div>
                <!-- Estatísticas -->
                <div style="width: 100%; max-width: 360px; margin-bottom: 28px;">
                    <h3 style="font-family: var(--font-display); font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-muted); text-align: center; margin-bottom: 16px;">Estatísticas</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                        <!-- Total de Rosários -->
                        <div style="background: rgba(212, 168, 85, 0.05); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-family: var(--font-display); font-size: 2rem; font-weight: 600; color: var(--gold);" id="profile-total-rosaries">0</div>
                            <div style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-muted); margin-top: 4px;">Rosários</div>
                        </div>
                        <!-- Maior Streak -->
                        <div style="background: rgba(212, 168, 85, 0.05); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-family: var(--font-display); font-size: 2rem; font-weight: 600; color: var(--gold);" id="profile-longest-streak">0</div>
                            <div style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-muted); margin-top: 4px;">Recorde</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <!-- Total Ave Marias -->
                        <div style="background: rgba(138, 61, 80, 0.08); border: 1px solid rgba(138, 61, 80, 0.2); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-family: var(--font-display); font-size: 2rem; font-weight: 600; color: var(--burgundy-light);" id="profile-total-aves">0</div>
                            <div style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-muted); margin-top: 4px;">Ave Marias</div>
                        </div>
                        <!-- Total Pai Nossos -->
                        <div style="background: rgba(138, 61, 80, 0.08); border: 1px solid rgba(138, 61, 80, 0.2); border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-family: var(--font-display); font-size: 2rem; font-weight: 600; color: var(--burgundy-light);" id="profile-total-paters">0</div>
                            <div style="font-family: var(--font-display); font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-muted); margin-top: 4px;">Pai Nossos</div>
                        </div>
                    </div>
                </div>
                <!-- Botão Sair -->
                <button type="button" style="width: 100%; max-width: 300px; padding: 16px; background: linear-gradient(135deg, rgba(180, 60, 60, 0.2) 0%, rgba(180, 60, 60, 0.08) 100%); border: 1px solid rgba(180, 60, 60, 0.3); border-radius: 8px; font-family: var(--font-display); font-size: 0.8rem; letter-spacing: 0.1em; text-transform: uppercase; color: #c07070; cursor: pointer; transition: all 0.3s;" onclick="firebaseAuth.logoutUser()" onmouseover="this.style.background='rgba(180, 60, 60, 0.15)'; this.style.borderColor='rgba(180, 60, 60, 0.5)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.background='linear-gradient(135deg, rgba(180, 60, 60, 0.2) 0%, rgba(180, 60, 60, 0.08) 100%)'; this.style.borderColor='rgba(180, 60, 60, 0.3)'; this.style.transform='translateY(0)';">
                    Sair da Conta
                </button>
            </div>
        </div>
    </div>
    <!-- BOTTOM NAVIGATION -->
   <nav class="bottom-nav">
    <button type="button" class="nav-item active" data-tab="home">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
        <span class="nav-label">Início</span>
    </button>
    <button type="button" class="nav-item" id="nav-rosary-btn" data-tab="rosary">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="3" r="2.5"/>
            <circle cx="19.5" cy="7.5" r="2"/>
            <circle cx="19.5" cy="16.5" r="2"/>
            <circle cx="12" cy="21" r="2.5"/>
            <circle cx="4.5" cy="16.5" r="2"/>
            <circle cx="4.5" cy="7.5" r="2"/>
        </svg>
        <span class="nav-label">Rosário</span>
    </button>
    <button type="button" class="nav-item" data-tab="calendar">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        <span class="nav-label">Calendário</span>
    </button>
    <button type="button" class="nav-item" data-tab="friends">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        <span class="nav-label">Amigos</span>
    </button>
    <button type="button" class="nav-item" data-tab="profile">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
        </svg>
        <span class="nav-label">Perfil</span>
    </button>
</nav>
<!-- MODAL DE SELEÇÃO DE AVATAR -->
<div id="avatar-modal">
    <div class="avatar-modal-content">
        <button type="button" class="avatar-modal-close" onclick="closeAvatarModal()">×</button>
        <h2 class="avatar-modal-title">Escolha seu Avatar</h2>
        <div class="avatar-grid" id="avatar-grid">
            <!-- Avatares serão inseridos aqui via JavaScript -->
        </div>
        <button type="button" class="avatar-save-btn" id="avatar-save-btn" onclick="saveAvatar()">
            Salvar Avatar
        </button>
    </div>
</div>
<!-- TELA DE ORAÇÃO (sobrepõe tudo quando ativa) -->
<div id="prayer-screen">
    <div class="rosary-rail">
        <div class="rosary-chain"></div>
        <div class="center-guide"></div>
        <div id="bead-track"></div>
    </div>
    <div class="prayer-main">
        <header class="prayer-header">
            <button class="back-btn" onclick="app.confirmExit()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                Sair
            </button>
            <div class="progress-compact">
                <div class="progress-bar-mini"><div class="progress-fill-mini" id="progress-fill"></div></div>
                <span class="progress-text" id="progress-text">1/59</span>
            </div>
        </header>
        <div class="prayer-body" id="prayer-body">
            <div class="prayer-group" id="prayer-group"></div>
            <div class="prayer-mystery" id="prayer-mystery"></div>
            <h2 class="prayer-name" id="prayer-name"></h2>
            <div class="prayer-count" id="prayer-count"></div>
            <div class="meditation-box" id="meditation-box">
                <div class="meditation-label">Meditação</div>
                <p class="meditation-text" id="meditation-text"></p>
            </div>
            <button class="prayer-text-toggle" id="prayer-text-toggle" onclick="app.toggleText()">
                <span>Ver texto da oração</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M6 9l6 6 6-6"/></svg>
            </button>
            <div class="prayer-full-text" id="prayer-full-text"></div>
            <p class="nav-hint">Toque nas contas ou use as setas para navegar</p>
        </div>
        <footer class="prayer-footer">
            <button class="nav-btn" id="prev-btn" onclick="app.prev()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <button class="nav-btn primary" id="next-btn" onclick="app.next()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M9 18l6-6-6-6"/></svg>
            </button>
        </footer>
    </div>
</div>
<div id="completion-screen">
    <svg class="completion-icon" viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="50" cy="50" r="42"/>
        <path d="M28 50l16 16 28-32" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <h2 class="completion-title">Deo Gratias</h2>
    <p class="completion-subtitle" id="completion-msg"></p>
    <div class="completion-stats">
        <div class="stat"><div class="stat-value" id="stat-aves">0</div><div class="stat-label">Ave Marias</div></div>
        <div class="stat"><div class="stat-value" id="stat-paters">0</div><div class="stat-label">Pai Nossos</div></div>
    </div>
    <button class="btn-home" onclick="app.home()">Voltar ao Início</button>
</div>
<button class="audio-toggle" id="audio-toggle" onclick="app.toggleAudio()" title="Ativar/Desativar sons (M)">
    <svg id="audio-icon-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="display:none;">
        <path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
    </svg>
    <svg id="audio-icon-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M11 5L6 9H2v6h4l5 4V5z"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/>
    </svg>
</button>
<!-- Firebase SDK v9 (modular) -->
<script type="module">
import { firebaseConfig } from './config.js';
import{ initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import{ getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
import{ getDatabase, ref, set, get, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
const firebaseApp = initializeApp(firebaseConfig);
const auth = getAuth(firebaseApp);
const database = getDatabase(firebaseApp);
// Converter username para email interno
function usernameToEmail(username){
    return username.toLowerCase().replace(/\s+/g, '') + '@rosario.app';
}
// Mensagens de erro em português
function getFirebaseErrorMessage(errorCode){
    const errors ={
        'auth/email-already-in-use': 'Este nome de usuário já está em uso!',
        'auth/invalid-email': 'Nome de usuário inválido!',
        'auth/operation-not-allowed': 'Operação não permitida!',
        'auth/weak-password': 'Senha muito fraca! Use no mínimo 6 caracteres.',
        'auth/user-disabled': 'Usuário desabilitado!',
        'auth/user-not-found': 'Usuário não encontrado!',
        'auth/wrong-password': 'Senha incorreta!',
        'auth/invalid-credential': 'Credenciais inválidas! Verifique seu usuário e senha.',
        'auth/too-many-requests': 'Muitas tentativas. Aguarde um momento e tente novamente.'
    };
    return errors[errorCode] || 'Erro ao processar solicitação. Tente novamente.';
}
function showElement(id){ document.getElementById(id).classList.add('visible');}
function hideElement(id){ document.getElementById(id).classList.remove('visible');}
function showError(id, message){
    const el = document.getElementById(id);
    el.textContent = message;
    showElement(id);
    setTimeout(() => hideElement(id), 5000);
}
function showSuccess(id, message){
    const el = document.getElementById(id);
    el.textContent = message;
    showElement(id);
}
function setButtonLoading(btnId, isLoading){
    const btn = document.getElementById(btnId);
    btn.disabled = isLoading;
    if (isLoading) btn.innerHTML = '<span class="loading"></span>';
}
// Autenticação
async function registerUser(username, displayName, password){
    try{
        setButtonLoading('register-btn', true);
        const email = usernameToEmail(username);
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        await set(ref(database, 'users/' + user.uid),{
            username: username,
            displayName: displayName,
            avatar: '👤',
            createdAt: new Date().toISOString(),
            prayedDays:{},
            totalRosaries: 0,
            totalAves: 0,
            totalPaters: 0,
            currentStreak: 0,
            longestStreak: 0
        });
        showSuccess('register-success', 'Conta criada com sucesso! Entrando...');
        setTimeout(() =>{
            document.getElementById('register-form').reset();
            hideElement('register-success');
        }, 2000);
    } catch (error){
        console.error('Erro no registro:', error);
        showError('register-error', getFirebaseErrorMessage(error.code));
    } finally{
        setButtonLoading('register-btn', false);
        document.getElementById('register-btn').textContent = 'Criar Conta';
    }
}
async function loginUser(username, password){
    try{
        setButtonLoading('login-btn', true);
        const email = usernameToEmail(username);
        await signInWithEmailAndPassword(auth, email, password);
    } catch (error){
        console.error('Erro no login:', error);
        showError('login-error', getFirebaseErrorMessage(error.code));
        setButtonLoading('login-btn', false);
        document.getElementById('login-btn').textContent = 'Entrar';
    }
}
async function logoutUser(){
    if (confirm('Deseja realmente sair?')){
        try{
            await signOut(auth);
            document.querySelectorAll('.input-field').forEach(f => f.value = '');
        } catch (error){
            console.error('Erro ao sair:', error);
            alert('Erro ao sair da conta. Tente novamente.');
        }
    }
}
// Auth State Observer
onAuthStateChanged(auth, async (user) =>{
    if (user){
        setButtonLoading('login-btn', false);
        document.getElementById('login-btn').textContent = 'Entrar';
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        // Carregar dados do usuário
        const userRef = ref(database, 'users/' + user.uid);
        const snapshot = await get(userRef);
        if (snapshot.exists()){
            window.userProfile = snapshot.val();
            window.currentUser = user;
            // Atualizar UI
            updateUserInterface();
        }
    } else{
        document.getElementById('main-app').classList.add('hidden');
        document.getElementById('auth-screen').classList.remove('hidden');
        window.userProfile = null;
        window.currentUser = null;
    }
});
// Atualizar interface com dados do usuário
function updateUserInterface(){
    const profile = window.userProfile;
    if (!profile) return;
    const displayName = profile.displayName || profile.username;
    const initial = displayName.charAt(0).toUpperCase();
    const avatar = profile.avatar || initial;
    
    // Atualizar Home
    document.getElementById('home-user-name').textContent = displayName;
    // Atualizar Perfil
    document.getElementById('profile-name').textContent = displayName;
    document.getElementById('profile-avatar').textContent = avatar;
    // Atualizar Streak
    const streak = profile.currentStreak || 0;
    const streakMessage = streak === 0 ? 'Comece hoje sua jornada de oração' :
                         streak === 1 ? 'Continue orando! Você começou bem!' :
                         streak < 7 ? 'Ótimo progresso! Continue assim!' :
                         streak < 30 ? 'Parabéns! Você está firme na fé!' :
                         'Incrível! Que exemplo de perseverança!';
    document.getElementById('home-streak-count').textContent = streak;
    document.getElementById('home-streak-message').textContent = streakMessage;
    document.getElementById('profile-streak-count').textContent = streak;
    document.getElementById('profile-streak-message').textContent = streakMessage;
    // Atualizar Estatísticas
    document.getElementById('profile-total-rosaries').textContent = profile.totalRosaries || 0;
    document.getElementById('profile-longest-streak').textContent = profile.longestStreak || 0;
    document.getElementById('profile-total-aves').textContent = profile.totalAves || 0;
    document.getElementById('profile-total-paters').textContent = profile.totalPaters || 0;
    // Atualizar Intenção e Mistério do Dia
    const intentions = [
        "Pelos que sofrem perseguição por causa da fé.",
        "Pela conversão dos pecadores e a salvação das almas.",
        "Pelas vocações sacerdotais e religiosas.",
        "Pela paz no mundo e o fim das guerras.",
        "Pelos enfermos e todos que cuidam deles.",
        "Pelas almas do purgatório, especialmente as mais abandonadas.",
        "Pela santificação das famílias.",
        "Pelos jovens, para que encontrem seu caminho em Cristo.",
        "Pela Igreja e pelo Santo Padre.",
        "Pelos missionários em terras distantes.",
    ];
    const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
    const intention = intentions[dayOfYear % intentions.length];
    document.getElementById('home-intention').textContent = intention;
    document.getElementById('calendar-intention').textContent = intention;
    const days = ['Domingo', 'Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado'];
    const today = new Date();
    document.getElementById('home-today-day').textContent = days[today.getDay()];
    document.getElementById('rosary-today-day').textContent = days[today.getDay()];
    const dayMap ={ 0: 'Gloriosos', 1: 'Gozosos', 2: 'Dolorosos', 3: 'Gloriosos', 4: 'Gozosos', 5: 'Dolorosos', 6: 'Gozosos' };
    document.getElementById('home-today-mystery').textContent = 'Mistérios ' + dayMap[today.getDay()];
    document.getElementById('rosary-today-mystery').textContent = 'Mistérios ' + dayMap[today.getDay()];
    // Renderizar Calendário
    renderCalendar();
}
// Estado do calendário
let currentCalendarMonth = new Date().getMonth();
let currentCalendarYear = new Date().getFullYear();
// Renderizar Calendário
function renderCalendar(){
    const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                       'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
    document.getElementById('calendar-month-year').textContent = 
        `${monthNames[currentCalendarMonth]} ${currentCalendarYear}`;
    const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1).getDay();
    const daysInMonth = new Date(currentCalendarYear, currentCalendarMonth + 1, 0).getDate();
    const grid = document.getElementById('calendar-grid');
    grid.innerHTML = '';
    // Dias vazios antes do início do mês
    for (let i = 0; i < firstDay; i++){
        const emptyDay = document.createElement('div');
        emptyDay.style.cssText = 'height: 40px;';
        grid.appendChild(emptyDay);
    }
    // Dias do mês
    const today = new Date();
    const isCurrentMonth = currentCalendarMonth === today.getMonth() && 
                          currentCalendarYear === today.getFullYear();
    const prayedDays = window.userProfile?.prayedDays ||{};
    for (let day = 1; day <= daysInMonth; day++){
        const dateKey = `${currentCalendarYear}-${String(currentCalendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const hasPrayed = prayedDays[dateKey] === true;
        const isToday = isCurrentMonth && day === today.getDate();
        const dayEl = document.createElement('div');
        dayEl.textContent = day;
        dayEl.style.cssText = `
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-family: var(--font-body);
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            ${hasPrayed ? `
                background: var(--gold);
                color: var(--bg-deep);
                font-weight: 600;
                box-shadow: 0 0 12px var(--gold-glow);
            ` : `
                color: var(--text-secondary);
                border: 1px solid var(--border-subtle);
            `}
            ${isToday ? `
                border: 2px solid var(--gold);
                ${!hasPrayed ? 'color: var(--gold);' : ''}
            ` : ''}
        `;
        dayEl.onmouseover = () =>{
            if (!hasPrayed){
                dayEl.style.borderColor = 'var(--gold-dim)';
                dayEl.style.color = 'var(--gold)';
            }
        };
        dayEl.onmouseout = () =>{
            if (!hasPrayed){
                dayEl.style.borderColor = 'var(--border-subtle)';
                dayEl.style.color = 'var(--text-secondary)';
                if (isToday){
                    dayEl.style.borderColor = 'var(--gold)';
                    dayEl.style.color = 'var(--gold)';
                }
            }
        };
        grid.appendChild(dayEl);
    }
}
// Event Listeners
document.addEventListener('DOMContentLoaded', () =>{
    // Auth tabs
    document.querySelectorAll('.auth-tab').forEach(tab =>{
        tab.addEventListener('click', () =>{
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab + '-form').classList.add('active');
        });
    });
// Login form
document.getElementById('login-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const username = document.getElementById('login-username').value.trim();
    const password = document.getElementById('login-password').value;
    loginUser(username, password);
});
// Register form
document.getElementById('register-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const username = document.getElementById('register-username').value.trim();
    const displayName = document.getElementById('register-displayname').value.trim();
    const password = document.getElementById('register-password').value;
    const confirm = document.getElementById('register-confirm').value;
    
    if (password !== confirm) {
        showError('register-error', 'As senhas não coincidem!');
        return;
    }
    
    if (username.length < 3) {
        showError('register-error', 'Nome de usuário muito curto! Use no mínimo 3 caracteres.');
        return;
    }
    
    registerUser(username, displayName, password);
});
    // Navegação de tabs
    document.querySelectorAll('.nav-item[data-tab]').forEach(btn =>{
        btn.addEventListener('click', () =>{
            // Atualizar nav items
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            btn.classList.add('active');
            // Atualizar tab contents
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
        });
    });
    // Botão Rosário na navbar - abre modal
    document.getElementById('nav-rosary-btn').addEventListener('click', () =>{
        document.getElementById('rosary-modal').classList.add('active');
    });
    // Navegação do Calendário
    document.getElementById('prev-month-btn').addEventListener('click', () =>{
        currentCalendarMonth--;
        if (currentCalendarMonth < 0){
            currentCalendarMonth = 11;
            currentCalendarYear--;
        }
        renderCalendar();
    });
    document.getElementById('next-month-btn').addEventListener('click', () =>{
        currentCalendarMonth++;
        if (currentCalendarMonth > 11){
            currentCalendarMonth = 0;
            currentCalendarYear++;
        }
        renderCalendar();
    });
});
// Exportar funções globalmente
window.firebaseAuth ={ logoutUser };
window.updateUserInterface = updateUserInterface;
window.renderCalendar = renderCalendar;
</script>
<script>
// ===== SISTEMA DE ÁUDIO INTERATIVO =====
const AudioSystem ={
    ctx: null,
    enabled: false,
    init(){
        if (!this.ctx){
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (this.ctx.state === 'suspended') this.ctx.resume();
    },
    // Som de conta - madeira de terço
    playBead(type = 'ave'){
        if (!this.enabled) return;
        this.init();
        const now = this.ctx.currentTime;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        const filter = this.ctx.createBiquadFilter();
        filter.type = 'lowpass';
        osc.type = 'triangle'; // Som mais orgânico
        if (type === 'pater'){
            // Som de madeira mais grossa/densa para Pai Nosso
            osc.frequency.setValueAtTime(180, now);
            osc.frequency.exponentialRampToValueAtTime(90, now + 0.08);
            filter.frequency.setValueAtTime(600, now);
            filter.Q.setValueAtTime(3, now);
            gain.gain.setValueAtTime(0.25, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);
        } else if (type === 'special'){
            // Som de madeira média para contas especiais
            osc.frequency.setValueAtTime(220, now);
            osc.frequency.exponentialRampToValueAtTime(110, now + 0.06);
            filter.frequency.setValueAtTime(500, now);
            filter.Q.setValueAtTime(4, now);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.12);
        } else{
            // Som de madeira leve/seca para Ave Maria
            osc.frequency.setValueAtTime(260, now);
            osc.frequency.exponentialRampToValueAtTime(130, now + 0.05);
            filter.frequency.setValueAtTime(450, now);
            filter.Q.setValueAtTime(5, now);
            gain.gain.setValueAtTime(0.18, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
        }
        osc.connect(filter);
        filter.connect(gain);
        gain.connect(this.ctx.destination);
        osc.start(now);
        osc.stop(now + 0.2);
        // Adiciona textura de toque de madeira
        this.addWoodTexture(type);
    },
    addWoodTexture(type){
        const now = this.ctx.currentTime;
        const bufferSize = this.ctx.sampleRate * 0.02;
        const noiseBuffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
        const data = noiseBuffer.getChannelData(0);
        // Ruído mais acentuado no início (percussivo)
        for (let i = 0; i < bufferSize; i++){
            const envelope = Math.exp(-i / (bufferSize * 0.15));
            data[i] = (Math.random() * 2 - 1) * 0.4 * envelope;
        }
        const noise = this.ctx.createBufferSource();
        noise.buffer = noiseBuffer;
        const noiseGain = this.ctx.createGain();
        const noiseFilter = this.ctx.createBiquadFilter();
        noiseFilter.type = 'bandpass';
        // Frequências mais baixas para som de madeira
        noiseFilter.frequency.setValueAtTime(type === 'pater' ? 800 : 1200, now);
        noiseFilter.Q.setValueAtTime(2, now);
        const vol = type === 'pater' ? 0.15 : 0.1;
        noiseGain.gain.setValueAtTime(vol, now);
        noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.02);
        noise.connect(noiseFilter);
        noiseFilter.connect(noiseGain);
        noiseGain.connect(this.ctx.destination);
        noise.start(now);
    },
    // Som de sino ao iniciar
    playBell(){
        if (!this.enabled) return;
        this.init();
        const now = this.ctx.currentTime;
        const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5
        frequencies.forEach((freq, i) =>{
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.frequency.setValueAtTime(freq, now);
            osc.type = 'sine';
            const startTime = now + i * 0.12;
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.1 / (i + 1), startTime + 0.06);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + 2.5);
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.start(startTime);
            osc.stop(startTime + 3);
        });
    },
    // Som de conclusão - acorde ascendente
    playComplete(){
        if (!this.enabled) return;
        this.init();
        const now = this.ctx.currentTime;
        const notes = [261.63, 329.63, 392, 523.25]; // C4, E4, G4, C5
        notes.forEach((freq, i) =>{
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.frequency.setValueAtTime(freq, now);
            osc.type = 'sine';
            const startTime = now + i * 0.18;
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.12, startTime + 0.06);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + 2);
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.start(startTime);
            osc.stop(startTime + 2.5);
        });
    },
    toggle(){
        this.enabled = !this.enabled;
        return this.enabled;
    }
};
// ===== TEXTOS DAS ORAÇÕES =====
const TEXTS ={
    cross: `Em nome do Pai, e do Filho, e do Espírito Santo. Amém.`,
    credo: `Creio em Deus Pai todo-poderoso, Criador do Céu e da terra; e em Jesus Cristo, seu único Filho, Nosso Senhor, que foi concebido pelo poder do Espírito Santo; nasceu da Virgem Maria; padeceu sob Pôncio Pilatos, foi crucificado, morto e sepultado; desceu à mansão dos mortos; ressuscitou ao terceiro dia; subiu aos Céus; está sentado à direita de Deus Pai todo-poderoso, de onde há de vir a julgar os vivos e os mortos. Creio no Espírito Santo; na Santa Igreja Católica; na comunhão dos Santos; na remissão dos pecados; na ressurreição da carne; na vida eterna. Amém.`,
    pater: `Pai nosso que estais nos Céus, santificado seja o vosso Nome, venha a nós o vosso Reino, seja feita a vossa vontade assim na terra como no Céu. O pão nosso de cada dia nos dai hoje, perdoai-nos as nossas ofensas assim como nós perdoamos a quem nos tem ofendido, e não nos deixeis cair em tentação, mas livrai-nos do Mal. Amém.`,
    ave: `Ave Maria, cheia de graça, o Senhor é convosco, bendita sois vós entre as mulheres e bendito é o fruto do vosso ventre, Jesus. Santa Maria, Mãe de Deus, rogai por nós pecadores, agora e na hora da nossa morte. Amém.`,
    gloria: `Glória ao Pai, e ao Filho, e ao Espírito Santo. Assim como era no princípio, agora e sempre, e por todos os séculos dos séculos. Amém.`,
    fatima: `Ó meu Jesus, perdoai-nos, livrai-nos do fogo do inferno, levai as almas todas para o Céu, principalmente as que mais precisarem da vossa Misericórdia.`,
    salve: `Salve Rainha, Mãe de Misericórdia, vida, doçura e esperança nossa, salve! A vós bradamos, os degredados filhos de Eva. A vós suspiramos, gemendo e chorando neste vale de lágrimas. Eia pois, advogada nossa, esses vossos olhos misericordiosos a nós volvei. E depois deste desterro, mostrai-nos Jesus, bendito fruto do vosso ventre. Ó clemente, ó piedosa, ó doce sempre Virgem Maria. Rogai por nós, Santa Mãe de Deus, para que sejamos dignos das promessas de Cristo. Amém.`
};
// ===== MEDITAÇÕES MONTFORT =====
const MONTFORT ={
    intro: ["Em honra do Pai Eterno, que gera seu Filho contemplando-Se.", "Em honra do Verbo Eterno, igual ao Pai, que com Ele produz o Espírito Santo.", "Em honra do Espírito Santo, que procede do Pai e do Filho por via de amor."],
    gozosos:{ name: "Mistérios Gozosos", mysteries: [
{ title: "A Anunciação do Anjo a Nossa Senhora", pater: "A caridade de Deus, imensa.", aves: ["Para lamentar o desgraçado estado de Adão desobediente, sua justa condenação e a de todos os seus filhos.", "Os desejos dos patriarcas e profetas, que pediam a vinda do Messias.", "Os desejos e as preces da Santíssima Virgem, que apressaram a vinda do Messias.", "A caridade do Pai Eterno, que nos deu Seu divino Filho.", "O amor do Filho, que se entregou por nós.", "A embaixada e a saudação do arcanjo Gabriel.", "O temor virginal de Maria.", "A fé e o consentimento da Santíssima Virgem.", "A criação da alma e a formação do Corpo de Jesus Cristo no seio de Maria, pelo Espírito Santo.", "A adoração do Verbo Encarnado, pelos anjos, no seio de Maria."] },
{ title: "A Visitação de Nossa Senhora a Santa Isabel", pater: "A majestade de Deus, adorável.", aves: ["O gozo do Coração de Maria e a morada durante nove meses, do Verbo em seu seio.", "O sacrifício que Jesus Cristo fez de Si mesmo ao Pai, ao entrar neste Mundo.", "As complacências de Jesus no seio humilde e virginal de Maria, e de Nossa Senhora, no gozo do seu Deus.", "A dúvida de São José acerca da maternidade de Maria.", "A eleição dos escolhidos, combinada entre Jesus e Maria, em seu seio.", "O fervor de Maria na sua visita a Santa Isabel.", "A santificação de João Batista no ventre de sua mãe.", "A gratidão da Santíssima Virgem para com Deus, no Magnificat.", "A sua caridade e humildade em servir sua prima.", "A mútua dependência de Jesus e de Maria, e a devoção que devemos ter para com um e outra."] },
{ title: "O Nascimento de Jesus em Belém", pater: "As riquezas de Deus, infinitas.", aves: ["Os desprezos e injúrias feitas a Maria e a São José em Belém.", "A pobreza do estábulo onde Deus veio ao mundo.", "A alta contemplação e o excessivo amor de Maria no momento de dar à luz.", "A saída do Verbo Eterno do seio de Maria sem romper o selo de sua virgindade.", "As adorações e cânticos dos anjos no nascimento de Jesus.", "A formosura arrebatadora de Sua divina infância.", "A vinda dos pastores ao estábulo, com seus presentes.", "A circuncisão de Jesus Cristo e Suas dores amorosas.", "A imposição do nome de Jesus Cristo e suas grandezas.", "A adoração dos reis magos e seus presentes."] },
{ title: "A Apresentação de Jesus no Templo", pater: "A sabedoria de Deus, eterna.", aves: ["A obediência de Jesus e de Maria à Lei.", "O sacrifício que ali fez Jesus de sua humanidade.", "O sacrifício que ali fez Maria de sua honra.", "O gozo e os cânticos de Simeão e Ana, a profetisa.", "O resgate de Jesus pela oferenda de duas rolas.", "A matança dos santos inocentes.", "A fuga de Jesus para o Egito, pela obediência de São José à voz do anjo.", "A estada misteriosa no Egito.", "A Sua volta para Nazaré.", "O seu crescimento em idade, sabedoria e graça."] },
{ title: "O Encontro de Jesus no Templo", pater: "A santidade de Deus, incompreensível.", aves: ["A Sua vida oculta, laboriosa e obediente na casa de Nazaré.", "A sua perda e encontro no Templo entre os doutores.", "O seu jejum e tentações no deserto.", "O seu Batismo por São João Batista.", "A sua pregação admirável.", "Os seus milagres portentosos.", "A eleição de seus doze Apóstolos e os poderes que lhes deu.", "A sua transfiguração maravilhosa.", "O lava-pés dos Apóstolos.", "A instituição da Sagrada Eucaristia."] }
    ]},
    dolorosos:{ name: "Mistérios Dolorosos", mysteries: [
{ title: "A Agonia de Jesus no Horto", pater: "A felicidade de Deus, essencial.", aves: ["Os divinos retiros que fez Jesus em Sua vida, principalmente no horto.", "As suas orações humildes e fervorosas durante Sua vida e nas vésperas da Paixão.", "A paciência e doçura com que suportou Seus Apóstolos, particularmente no horto.", "O tédio de sua Alma durante toda a Sua vida, principalmente no horto.", "Os rios de sangue que a dor fez brotar de seu Ser adorável.", "O consolo que teve por bem aceitar de um anjo na agonia.", "A sua conformidade com a vontade do Pai, apesar da repugnância de Sua natureza.", "A Sua traição por Judas e prisão pelos judeus.", "O valor com que saiu ao encontro dos algozes e a força da palavra com que os lançou por terra.", "O abandono que sofreu de Seus Apóstolos."] },
{ title: "A Flagelação de Jesus", pater: "A paciência de Deus, admirável.", aves: ["As cordas com que Jesus foi atado.", "A bofetada que recebeu em casa de Caifás.", "As negações de São Pedro.", "As ignomínias que sofreu em casa de Herodes, quando lhe puseram a veste branca.", "O despojamento de Suas vestes.", "Os desprezos e insultos que sofreu de seus verdugos pela Sua nudez.", "As varas espinhosas e os açoites cruéis com que foi golpeado.", "A coluna em que foi atado.", "O sangue que derramou e as chagas que recebeu.", "A Sua queda no próprio sangue por causa da fraqueza."] },
{ title: "A Coroação de Espinhos", pater: "A formosura de Deus, inefável.", aves: ["O despojamento de Suas vestes pela terceira vez.", "A Sua coroa de espinhos.", "O véu com que Lhe vendaram os olhos.", "As bofetadas e os escarros com que Lhe cobriram o rosto.", "O andrajo que Lhe puseram sobre os ombros.", "A cana que Lhe puseram nas mãos.", "A pedra pontiaguda sobre a qual O sentaram.", "Os ultrajes e os insultos que Lhe fizeram.", "O sangue e os suores que escorriam de Sua cabeça adorável.", "Os cabelos e a barba que Lhe arrancaram."] },
{ title: "Jesus Carrega a Cruz", pater: "A onipotência de Deus, sem limites.", aves: ["A apresentação de Nosso Senhor diante do povo com o 'Eis o Homem'.", "O haver sido preferido a Barrabás.", "Os falsos testemunhos que contra Ele deram.", "A Sua condenação à morte.", "O amor com que abraçou e beijou a Cruz.", "O trabalho espantoso que teve em carregá-la.", "As quedas de pura debilidade sob seu peso.", "O encontro doloroso com Sua Santa Mãe.", "O véu de Verônica, no qual Seu rosto se estampou.", "As suas lágrimas, as de Sua Santa Mãe e das piedosas mulheres que O seguiram até o Calvário."] },
{ title: "A Crucificação e Morte de Jesus", pater: "A justiça de Deus, espantosa.", aves: ["As cinco chagas de Jesus e o sangue que derramou na Cruz.", "O seu coração traspassado e a Cruz em que foi crucificado.", "Os cravos e a lança que O atravessaram.", "A vergonha e a infâmia que sofreu, sendo crucificado entre dois ladrões.", "A compaixão de Sua Mãe Santíssima.", "As sete últimas palavras.", "O seu desamparo e Seu silêncio.", "A aflição de todo o Universo.", "A Sua morte cruel e ignominiosa.", "A descida da Cruz e sepultamento."] }
    ]},
    gloriosos:{ name: "Mistérios Gloriosos", mysteries: [
{ title: "A Ressurreição de Jesus", pater: "A eternidade de Deus, sem princípio.", aves: ["A descida da Alma de Nosso Senhor aos Infernos.", "O gozo e a saída das almas dos Santos Padres que estavam no limbo.", "A reunião de Sua Alma e de Seu Corpo no sepulcro.", "A sua milagrosa saída do Sepulcro.", "As suas vitórias sobre a morte, o pecado, o mundo e o demônio.", "Os quatro dons gloriosos de Seu Corpo.", "O poder que Lhe deu Seu pai no céu e na terra.", "As aparições com que honrou Sua Santa Mãe.", "As conversações sobre o Céu e a ceia que fez com Seus Apóstolos.", "A autoridade e missão que lhes deu, para que fossem pregar por toda a Terra."] },
{ title: "A Ascensão de Jesus ao Céu", pater: "A imensidade de Deus, sem limites.", aves: ["A promessa que fez Jesus aos Apóstolos de lhes enviar o Espírito Santo.", "A reunião no Monte das Oliveiras.", "A benção que lhes deu ao se elevar da Terra aos Céus.", "A Sua gloriosa e admirável Ascensão por Sua própria virtude até o Céu Empíreo.", "O recebimento e o triunfo que lhe fez Deus, Seu Pai, e toda a corte celestial.", "O poder triunfante com que abriu as portas do Céu, onde nenhum mortal havia entrado.", "O seu assento à direita do Pai, como Seu Filho querido, igual a Ele mesmo.", "O poder que Lhe deu de julgar os vivos e os mortos.", "A Sua última vinda sobre a Terra, na qual Seu poder e majestade aparecerão em todo o seu esplendor.", "A justiça que fará no último Juízo, recompensando os bons e castigando os maus por toda a eternidade."] },
{ title: "A Vinda do Espírito Santo", pater: "A providência de Deus, universal.", aves: ["A Verdade do Espírito Santo, Deus que procede do Pai e do Filho.", "O dom do Espírito Santo pelo Pai e pelo Filho sobre os Apóstolos.", "O grande estrondo com que desceu, sinal de Sua força e Seu poder.", "As línguas de fogo que enviou sobre os Apóstolos.", "A plenitude de graças com que distinguiu Maria, Sua fiel esposa.", "A Sua conduta maravilhosa, com os santos e com o próprio Jesus Cristo.", "Os doze frutos do Espírito Santo.", "Os sete dons do Espírito Santo.", "Para pedir em particular o dom da Sabedoria e a vinda de Seu reino aos corações.", "Para obter a vitória sobre os três espíritos que Lhe são opostos: o espírito da carne, do mundo e do demônio."] },
{ title: "A Assunção de Nossa Senhora", pater: "A liberalidade de Deus, inenarrável.", aves: ["A predestinação eterna de Maria, como obra-prima das mãos de Deus.", "A Sua Conceição Imaculada, a plenitude de graças e o uso da razão no seio de sua mãe.", "A Sua Natividade que regozijou todo o Universo.", "A Sua apresentação e sua vida no Templo.", "A Sua vida admirável e isenta de todo pecado.", "A plenitude de suas virtudes singulares.", "A Sua virgindade fecunda e seu parto sem dor.", "A Sua maternidade divina e sua aliança com a Santíssima Trindade.", "A Sua morte preciosa e cheia de amor.", "A Sua ressurreição e assunção triunfante."] },
{ title: "A Coroação de Nossa Senhora", pater: "A glória de Deus, inacessível.", aves: ["A tríplice coroa com que a Santíssima Trindade coroou Maria.", "O gozo e a glória nova que recebeu o Céu por seu triunfo.", "Para reconhecê-la como Rainha do Céu e da Terra, dos anjos e dos homens.", "A tesoureira e dispensadora de todas as graças de Deus.", "A Medianeira e advogada dos homens.", "A destruidora e a ruína do demônio e das heresias.", "O refúgio seguro dos pecadores.", "A mãe e nutriz dos cristãos.", "A que é gozo e doçura dos justos.", "A que é asilo universal dos vivos, consolo todo-poderoso dos aflitos, dos moribundos e das almas do purgatório."] }
    ]}
};
// ===== APP =====
const app ={
    state:{ type: null, beads: [], index: 0, showText: false },
    els:{},
    init(){
        this.els ={
            mainApp: document.getElementById('main-app'),
            prayer: document.getElementById('prayer-screen'),
            completion: document.getElementById('completion-screen'),
            track: document.getElementById('bead-track'),
            progressFill: document.getElementById('progress-fill'),
            progressText: document.getElementById('progress-text'),
            group: document.getElementById('prayer-group'),
            mystery: document.getElementById('prayer-mystery'),
            name: document.getElementById('prayer-name'),
            count: document.getElementById('prayer-count'),
            meditationBox: document.getElementById('meditation-box'),
            meditationText: document.getElementById('meditation-text'),
            textToggle: document.getElementById('prayer-text-toggle'),
            fullText: document.getElementById('prayer-full-text'),
            prevBtn: document.getElementById('prev-btn'),
            audioToggle: document.getElementById('audio-toggle'),
            audioIconOn: document.getElementById('audio-icon-on'),
            audioIconOff: document.getElementById('audio-icon-off')
        };
        this.setTodayInfo();
        this.setupGestures();
        this.setupKeyboard();
    },
    setTodayInfo(){
        const days = ['Domingo', 'Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado'];
        const mysteries ={ 0: 'Gloriosos', 1: 'Gozosos', 2: 'Dolorosos', 3: 'Gloriosos', 4: 'Gozosos', 5: 'Dolorosos', 6: 'Gozosos' };
        const d = new Date().getDay();
        document.getElementById('today-info').innerHTML = `Hoje é <strong>${days[d]}</strong> — Mistérios <strong>${mysteries[d]}</strong>`;
    },
    setupGestures(){
        let startY = 0;
        let startX = 0;
        const body = document.getElementById('prayer-body');
        body.addEventListener('touchstart', e =>{ 
            startY = e.touches[0].clientY;
            startX = e.touches[0].clientX;
        },{ passive: true });
        body.addEventListener('touchmove', e =>{
            // Prevenir scroll durante swipe vertical
            const dy = Math.abs(startY - e.touches[0].clientY);
            const dx = Math.abs(startX - e.touches[0].clientX);
            if (dy > dx && dy > 10){
                e.preventDefault();
            }
        },{ passive: false });
        body.addEventListener('touchend', e =>{
            if (!this.state.type) return;
            const endY = e.changedTouches[0].clientY;
            const endX = e.changedTouches[0].clientX;
            const dy = startY - endY;
            const dx = Math.abs(startX - endX);
            // Só processar se movimento vertical for maior que horizontal
            if (Math.abs(dy) > 30 && Math.abs(dy) > dx){
                if (dy > 0){
                    // Swipe para cima = próxima
                    this.next();
                } else{
                    // Swipe para baixo = anterior
                    this.prev();
                }
            }
        },{ passive: true });
        // Scroll wheel
        let wheelTimeout;
        window.addEventListener('wheel', e =>{
            if (!this.state.type || wheelTimeout) return;
            if (e.deltaY > 0) this.next();
            else if (e.deltaY < 0) this.prev();
            wheelTimeout = setTimeout(() =>{ wheelTimeout = null;}, 180);
        },{ passive: true });
    },
    setupKeyboard(){
        document.addEventListener('keydown', e =>{
            if (!this.state.type) return;
            if (['ArrowDown', 'ArrowRight', ' '].includes(e.key)){ e.preventDefault(); this.next();}
            if (['ArrowUp', 'ArrowLeft'].includes(e.key)){ e.preventDefault(); this.prev();}
            if (e.key === 'Escape') this.confirmExit();
            if (e.key.toLowerCase() === 't') this.toggleText();
            if (e.key.toLowerCase() === 'm') this.toggleAudio();
        });
    },
    toggleAudio(){
        const enabled = AudioSystem.toggle();
        this.els.audioToggle.classList.toggle('active', enabled);
        this.els.audioIconOn.style.display = enabled ? 'block' : 'none';
        this.els.audioIconOff.style.display = enabled ? 'none' : 'block';
        if (enabled) AudioSystem.playBell();
    },
    generateBeads(type){
        const beads = []; let id = 0;
        const add = (beadType, name, textKey, meditation = '', meta ={}) =>{ beads.push({ id: id++, beadType, name, textKey, meditation, ...meta });};
        add('special', 'Sinal da Cruz', 'cross', 'Fé na presença de Deus; Fé no Evangelho; Fé e obediência ao Papa como Vigário de Jesus Cristo.');
        add('special', 'Creio em Deus Pai', 'credo', 'Professamos nossa fé no Deus Uno e Trino e em todos os artigos da Santa Fé Católica.');
        add('pater', 'Pai Nosso', 'pater', 'Unidade de um só Deus, vivo e verdadeiro.');
        MONTFORT.intro.forEach((med, i) =>{ add('ave', 'Ave Maria', 'ave', med,{ count: `${i + 1}ª Ave Maria · Virtudes Teologais` });});
        add('special', 'Glória ao Pai', 'gloria', 'Damos glória à Santíssima Trindade.');
        let groups = type === 'completo' ? [MONTFORT.gozosos, MONTFORT.dolorosos, MONTFORT.gloriosos] : [MONTFORT[type]];
        groups.forEach(group =>{
            group.mysteries.forEach((mystery, mIdx) =>{
                const mysteryNum = mIdx + 1;
                add('pater', 'Pai Nosso', 'pater', mystery.pater,{ group: group.name, mystery: mystery.title, count: `${mysteryNum}º Mistério` });
                mystery.aves.forEach((med, aIdx) =>{ add('ave', 'Ave Maria', 'ave', med,{ group: group.name, mystery: mystery.title, count: `${mysteryNum}ª Dezena · ${aIdx + 1}ª Ave Maria` });});
                add('special', 'Glória ao Pai', 'gloria', '',{ group: group.name, mystery: mystery.title, count: `${mysteryNum}ª Dezena` });
                add('special', 'Oração de Fátima', 'fatima', 'Oração ensinada por Nossa Senhora aos pastorinhos de Fátima.',{ group: group.name, mystery: mystery.title, count: `${mysteryNum}ª Dezena` });
            });
        });
        add('special', 'Salve Rainha', 'salve', 'Saudemos a Rainha do Céu e da Terra, nossa Mãe e Advogada.');
        return beads;
    },
    start(type){
        this.state.type = type;
        this.state.beads = this.generateBeads(type);
        this.state.index = 0;
        this.state.showText = false;
        this.els.track.innerHTML = '';
        this.state.beads.forEach((bead, idx) =>{
            const el = document.createElement('div');
            el.className = `bead ${bead.beadType}`;
            if (bead.beadType !== 'ave' && bead.beadType !== 'pater') el.classList.add('special');
            // Adicionar classe específica para Glória e Fátima (retângulos arredondados)
            if (bead.textKey === 'gloria' || bead.textKey === 'fatima'){
                el.classList.add('rectangle-bead');
            }
            if (idx === 0) el.classList.add('active');
            el.onclick = () => this.goTo(idx);
            this.els.track.appendChild(el);
        });
        this.els.prayer.classList.add('active');
        AudioSystem.playBell();
        this.update();
    },
    goTo(idx){
        if (idx >= 0 && idx < this.state.beads.length){
            this.state.index = idx;
            this.update();
            AudioSystem.playBead(this.state.beads[idx].beadType);
        }
    },
    next(){
        if (this.state.index < this.state.beads.length - 1){
            this.state.index++;
            this.update();
            AudioSystem.playBead(this.state.beads[this.state.index].beadType);
        } else{
            this.complete();
        }
    },
    prev(){
        if (this.state.index > 0){
            this.state.index--;
            this.update();
            AudioSystem.playBead(this.state.beads[this.state.index].beadType);
        }
    },
    update(){
        const idx = this.state.index;
        const bead = this.state.beads[idx];
        const total = this.state.beads.length;
        const pct = ((idx + 1) / total) * 100;
        this.els.progressFill.style.width = `${pct}%`;
        this.els.progressText.textContent = `${idx + 1} / ${total}`;
        const animatedEls = [this.els.group, this.els.mystery, this.els.name, this.els.count, this.els.meditationBox];
        animatedEls.forEach(el => el.classList.remove('visible'));
        setTimeout(() =>{
            this.els.group.textContent = bead.group || '';
            this.els.mystery.textContent = bead.mystery || '';
            this.els.name.textContent = bead.name;
            this.els.count.textContent = bead.count || '';
            this.els.meditationText.textContent = bead.meditation;
            this.els.fullText.innerHTML = `<p>${TEXTS[bead.textKey]}</p>`;
            // Lógica de exibição do texto
            const isShortPrayer = bead.textKey === 'gloria' || bead.textKey === 'fatima';
            if (isShortPrayer){
                // Glória e Fátima: sempre mostrar texto, esconder botão
                this.els.fullText.classList.add('visible');
                this.els.textToggle.style.display = 'none';
            } else{
                // Outras orações: esconder texto por padrão, mostrar botão
                this.els.textToggle.style.display = 'flex';
                if (!this.state.showText){
                    this.els.fullText.classList.remove('visible');
                    this.els.textToggle.classList.remove('expanded');
                    this.els.textToggle.querySelector('span').textContent = 'Ver texto da oração';
                } else{
                    this.els.fullText.classList.add('visible');
                    this.els.textToggle.classList.add('expanded');
                    this.els.textToggle.querySelector('span').textContent = 'Esconder texto';
                }
            }
            animatedEls.forEach(el => el.classList.add('visible'));
        }, 120);
        this.els.prevBtn.disabled = idx === 0;
        const beadEls = this.els.track.children;
        Array.from(beadEls).forEach(el => el.classList.remove('active'));
        beadEls[idx].classList.add('active');
        const activeEl = beadEls[idx];
        const beadCenter = activeEl.offsetTop + activeEl.offsetHeight / 2;
        this.els.track.style.transform = `translate(-50%, -${beadCenter}px)`;
    },
    toggleText(){
        this.state.showText = !this.state.showText;
        if (this.state.showText){
            this.els.fullText.classList.add('visible');
            this.els.textToggle.classList.add('expanded');
            this.els.textToggle.querySelector('span').textContent = 'Ocultar texto';
        } else{
            this.els.fullText.classList.remove('visible');
            this.els.textToggle.classList.remove('expanded');
            this.els.textToggle.querySelector('span').textContent = 'Ver texto da oração';
        }
    },
    confirmExit(){ if (confirm('Deseja realmente sair do Rosário?')) this.home();},
    home(){
        this.state.type = null;
        this.els.prayer.classList.remove('active');
        this.els.completion.classList.remove('active');
    },
    complete(){
        AudioSystem.playComplete();
        const aves = this.state.beads.filter(b => b.beadType === 'ave').length;
        const paters = this.state.beads.filter(b => b.beadType === 'pater').length;
        document.getElementById('stat-aves').textContent = aves;
        document.getElementById('stat-paters').textContent = paters;
        const msgs ={
            gozosos: 'Você completou os Mistérios Gozosos. Que a alegria de Maria esteja convosco.',
            dolorosos: 'Você completou os Mistérios Dolorosos. Que os sofrimentos de Cristo vos fortaleçam.',
            gloriosos: 'Você completou os Mistérios Gloriosos. Que a glória do Céu vos aguarde.',
            completo: 'Você completou o Santo Rosário inteiro! Que Nossa Senhora interceda por vós.'
        };
        document.getElementById('completion-msg').textContent = msgs[this.state.type];
        // Salvar no Firebase
        if (window.currentUser && window.userProfile){
            this.saveCompletion(aves, paters);
        }
        this.els.prayer.classList.remove('active');
        this.els.completion.classList.add('active');
    },
    async saveCompletion(aves, paters){
        try{
            // Importar update do Firebase
            const{ getDatabase, ref, update, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
            const database = getDatabase();
            const userId = window.currentUser.uid;
            const today = new Date();
            const dateKey = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            // Atualizar dados
            const updates ={};
            updates[`users/${userId}/prayedDays/${dateKey}`] = true;
            updates[`users/${userId}/totalRosaries`] = (window.userProfile.totalRosaries || 0) + 1;
            updates[`users/${userId}/totalAves`] = (window.userProfile.totalAves || 0) + aves;
            updates[`users/${userId}/totalPaters`] = (window.userProfile.totalPaters || 0) + paters;
            // Calcular streak
            const userRef = ref(database, `users/${userId}`);
            const snapshot = await get(userRef);
            const userData = snapshot.val();
            const prayedDays = userData.prayedDays ||{};
            // Verificar se rezou ontem
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayKey = `${yesterday.getFullYear()}-${String(yesterday.getMonth() + 1).padStart(2, '0')}-${String(yesterday.getDate()).padStart(2, '0')}`;
            let newStreak = 1;
            if (prayedDays[yesterdayKey]){
                newStreak = (userData.currentStreak || 0) + 1;
            }
            updates[`users/${userId}/currentStreak`] = newStreak;
            updates[`users/${userId}/longestStreak`] = Math.max(newStreak, userData.longestStreak || 0);
            await update(ref(database), updates);
            // Atualizar perfil local
            window.userProfile.prayedDays ={ ...prayedDays, [dateKey]: true };
            window.userProfile.totalRosaries = (window.userProfile.totalRosaries || 0) + 1;
            window.userProfile.totalAves = (window.userProfile.totalAves || 0) + aves;
            window.userProfile.totalPaters = (window.userProfile.totalPaters || 0) + paters;
            window.userProfile.currentStreak = newStreak;
            window.userProfile.longestStreak = Math.max(newStreak, window.userProfile.longestStreak || 0);
            // Atualizar UI
            if (window.updateUserInterface){
                window.updateUserInterface();
            }
        } catch (error){
            console.error('Erro ao salvar conclusão:', error);
        }
    }
};
app.init();
window.app = app;
// ===== SISTEMA DE AVATARES =====
const AVATARS = [
    '👤', // Padrão
    '🙏', // Mãos rezando
    '📿', // Rosário
    '✝️', // Cruz
    '⛪', // Igreja
    '🕊️', // Pomba (Espírito Santo)
    '🌟', // Estrela
    '❤️', // Coração
    '🌹', // Rosa (Nossa Senhora)
    '📖', // Bíblia
    '🕯️', // Vela
    '👑', // Coroa (Cristo Rei)
    '😇', // Anjo
    '🌙', // Lua
    '☀️', // Sol
    '💫', // Estrela cadente
];
let selectedAvatar = '👤';
// Renderizar grid de avatares
function renderAvatarGrid(){
    const grid = document.getElementById('avatar-grid');
    grid.innerHTML = '';
    AVATARS.forEach(avatar =>{
        const option = document.createElement('div');
        option.className = 'avatar-option';
        option.textContent = avatar;
        option.onclick = () => selectAvatar(avatar, option);
        // Marcar avatar atual como selecionado
        if (window.userProfile && window.userProfile.avatar === avatar){
            option.classList.add('selected');
            selectedAvatar = avatar;
        }
        grid.appendChild(option);
    });
}
// Selecionar avatar
function selectAvatar(avatar, element){
    selectedAvatar = avatar;
    // Remover seleção anterior
    document.querySelectorAll('.avatar-option').forEach(opt =>{
        opt.classList.remove('selected');
    });
    // Adicionar seleção ao novo
    element.classList.add('selected');
}
// Abrir modal
window.openAvatarModal = function(){
    renderAvatarGrid();
    document.getElementById('avatar-modal').classList.add('active');
};
// Fechar modal
window.closeAvatarModal = function(){
    document.getElementById('avatar-modal').classList.remove('active');
};
// Salvar avatar
window.saveAvatar = async function(){
    if (!window.currentUser || !selectedAvatar) return;
    const saveBtn = document.getElementById('avatar-save-btn');
    saveBtn.disabled = true;
    saveBtn.textContent = 'Salvando...';
    try{
        const{ getDatabase, ref, update } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
        const database = getDatabase();
        await update(ref(database, `users/${window.currentUser.uid}`),{
            avatar: selectedAvatar
        });
        // Atualizar perfil local
        window.userProfile.avatar = selectedAvatar;
        // Atualizar UI
        document.getElementById('profile-avatar').textContent = selectedAvatar;
        // Fechar modal
        closeAvatarModal();
        saveBtn.disabled = false;
        saveBtn.textContent = 'Salvar Avatar';
    } catch (error){
        console.error('Erro ao salvar avatar:', error);
        alert('Erro ao salvar avatar. Tente novamente.');
        saveBtn.disabled = false;
        saveBtn.textContent = 'Salvar Avatar';
    }
};
// Fechar modal ao clicar fora
document.addEventListener('click', (e) =>{
    const modal = document.getElementById('avatar-modal');
    if (e.target === modal){
        closeAvatarModal();
    }
});
// ===== SISTEMA DE AMIGOS =====

// Buscar amigo por username
async function searchFriend() {
    const input = document.getElementById('friend-search-input');
    const resultDiv = document.getElementById('search-result');
    let username = input.value.trim();
    
    username = username.replace(/^@/, '');
    
    if (!username || username.length < 2) {
        resultDiv.innerHTML = '<p style="color: var(--text-dim); font-size: 0.85rem; padding: 8px;">Digite pelo menos 2 caracteres</p>';
        return;
    }
    
    resultDiv.innerHTML = '<p style="color: var(--text-dim); font-size: 0.85rem; padding: 8px;">Buscando...</p>';
    
    try {
        const { getDatabase, ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
        const database = getDatabase();
        
        const usersRef = ref(database, 'users');
        const snapshot = await get(usersRef);
        
        if (!snapshot.exists()) {
            resultDiv.innerHTML = '<p style="color: var(--text-dim); font-size: 0.85rem; padding: 8px;">Nenhum usuário encontrado</p>';
            return;
        }
        
        const users = snapshot.val();
        let found = null;
        let foundUid = null;
        
        for (const uid in users) {
            if (users[uid].username && users[uid].username.toLowerCase() === username.toLowerCase()) {
                if (uid === window.currentUser.uid) {
                    resultDiv.innerHTML = '<p style="color: var(--text-dim); font-size: 0.85rem; padding: 8px;">Você não pode adicionar a si mesmo!</p>';
                    return;
                }
                found = users[uid];
                foundUid = uid;
                break;
            }
        }
        
        if (!found) {
            resultDiv.innerHTML = '<p style="color: var(--text-dim); font-size: 0.85rem; padding: 8px;">Usuário não encontrado</p>';
            return;
        }
        
        const myFriendsRef = ref(database, `users/${window.currentUser.uid}/friends/${foundUid}`);
        const friendCheck = await get(myFriendsRef);
        
        if (friendCheck.exists()) {
            resultDiv.innerHTML = `
                <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 16px; display: flex; align-items: center; gap: 12px;">
                    <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">${found.avatar || '👤'}</div>
                    <div style="flex: 1;">
                        <div style="font-family: var(--font-display); font-size: 0.95rem; color: var(--text-primary);">${found.displayName || found.username}</div>
                        <div style="font-family: var(--font-body); font-size: 0.85rem; color: var(--gold);">@${found.username}</div>
                        <div style="font-family: var(--font-body); font-size: 0.8rem; color: var(--text-muted); margin-top: 4px;">✅ Já são amigos</div>
                    </div>
                </div>
            `;
            return;
        }
        
        const sentRef = ref(database, `users/${window.currentUser.uid}/friendRequests/sent/${foundUid}`);
        const sentCheck = await get(sentRef);
        
        if (sentCheck.exists()) {
            resultDiv.innerHTML = `
                <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 16px; display: flex; align-items: center; gap: 12px;">
                    <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">${found.avatar || '👤'}</div>
                    <div style="flex: 1;">
                        <div style="font-family: var(--font-display); font-size: 0.95rem; color: var(--text-primary);">${found.displayName || found.username}</div>
                        <div style="font-family: var(--font-body); font-size: 0.85rem; color: var(--gold);">@${found.username}</div>
                        <div style="font-family: var(--font-body); font-size: 0.8rem; color: var(--text-muted); margin-top: 4px;">⏳ Pedido enviado</div>
                    </div>
                </div>
            `;
            return;
        }
        
        resultDiv.innerHTML = `
            <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 16px; display: flex; align-items: center; gap: 12px;">
                <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">${found.avatar || '👤'}</div>
                <div style="flex: 1;">
                    <div style="font-family: var(--font-display); font-size: 0.95rem; color: var(--text-primary);">${found.displayName || found.username}</div>
                    <div style="font-family: var(--font-body); font-size: 0.85rem; color: var(--gold);">@${found.username}</div>
                    <div style="font-family: var(--font-body); font-size: 0.8rem; color: var(--text-muted); margin-top: 4px;">🔥 ${found.currentStreak || 0} dias</div>
                </div>
                <button onclick="sendFriendRequest('${foundUid}')" style="padding: 10px 18px; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); border: none; border-radius: 6px; color: var(--bg-deep); font-family: var(--font-display); font-size: 0.7rem; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer;">Adicionar</button>
            </div>
        `;
        
    } catch (error) {
        console.error('Erro:', error);
        resultDiv.innerHTML = '<p style="color: #c07070; font-size: 0.85rem; padding: 8px;">Erro ao buscar</p>';
    }
}

async function sendFriendRequest(targetUid) {
    try {
        const { getDatabase, ref, update } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
        const database = getDatabase();
        const updates = {};
        updates[`users/${window.currentUser.uid}/friendRequests/sent/${targetUid}`] = Date.now();
        updates[`users/${targetUid}/friendRequests/received/${window.currentUser.uid}`] = Date.now();
        await update(ref(database), updates);
        alert('Pedido enviado! ✨');
        document.getElementById('friend-search-input').value = '';
        document.getElementById('search-result').innerHTML = '';
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao enviar pedido');
    }
}

async function loadFriendRequests() {
    try {
        const { getDatabase, ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
        const database = getDatabase();
        const requestsRef = ref(database, `users/${window.currentUser.uid}/friendRequests/received`);
        const snapshot = await get(requestsRef);
        const section = document.getElementById('friend-requests-section');
        const list = document.getElementById('friend-requests-list');
        
        if (!snapshot.exists()) {
            section.style.display = 'none';
            return;
        }
        
        section.style.display = 'block';
        list.innerHTML = '';
        const requests = snapshot.val();
        
        for (const uid in requests) {
            const userRef = ref(database, `users/${uid}`);
            const userSnap = await get(userRef);
            if (userSnap.exists()) {
                const user = userSnap.val();
                const card = document.createElement('div');
                card.style.cssText = 'background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 16px; display: flex; align-items: center; gap: 12px; margin-bottom: 12px;';
                card.innerHTML = `
                    <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">${user.avatar || '👤'}</div>
                    <div style="flex: 1;">
                        <div style="font-family: var(--font-display); font-size: 0.95rem; color: var(--text-primary);">${user.displayName || user.username}</div>
                        <div style="font-family: var(--font-body); font-size: 0.85rem; color: var(--gold);">@${user.username}</div>
                    </div>
                    <button onclick="acceptFriendRequest('${uid}')" style="padding: 8px 16px; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); border: none; border-radius: 6px; color: var(--bg-deep); font-family: var(--font-display); font-size: 0.7rem; text-transform: uppercase; cursor: pointer; margin-right: 8px;">Aceitar</button>
                    <button onclick="rejectFriendRequest('${uid}')" style="padding: 8px 16px; background: rgba(180, 60, 60, 0.15); border: 1px solid rgba(180, 60, 60, 0.3); border-radius: 6px; color: #c07070; font-family: var(--font-display); font-size: 0.7rem; text-transform: uppercase; cursor: pointer;">Recusar</button>
                `;
                list.appendChild(card);
            }
        }
    } catch (error) {
        console.error('Erro:', error);
    }
}

async function acceptFriendRequest(friendUid) {
    try {
        const { getDatabase, ref, update, remove } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
        const database = getDatabase();
        const updates = {};
        updates[`users/${window.currentUser.uid}/friends/${friendUid}`] = Date.now();
        updates[`users/${friendUid}/friends/${window.currentUser.uid}`] = Date.now();
        await update(ref(database), updates);
        await remove(ref(database, `users/${window.currentUser.uid}/friendRequests/received/${friendUid}`));
        await remove(ref(database, `users/${friendUid}/friendRequests/sent/${window.currentUser.uid}`));
        alert('Agora são amigos! 🎉');
        loadFriendRequests();
        loadFriends();
    } catch (error) {
        console.error('Erro:', error);
    }
}

async function rejectFriendRequest(friendUid) {
    try {
        const { getDatabase, ref, remove } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
        const database = getDatabase();
        await remove(ref(database, `users/${window.currentUser.uid}/friendRequests/received/${friendUid}`));
        await remove(ref(database, `users/${friendUid}/friendRequests/sent/${window.currentUser.uid}`));
        loadFriendRequests();
    } catch (error) {
        console.error('Erro:', error);
    }
}

async function loadFriends() {
    try {
        const { getDatabase, ref, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
        const database = getDatabase();
        const friendsRef = ref(database, `users/${window.currentUser.uid}/friends`);
        const snapshot = await get(friendsRef);
        const list = document.getElementById('friends-list');
        
        if (!snapshot.exists()) {
            list.innerHTML = '<p style="font-family: var(--font-body); font-size: 0.95rem; color: var(--text-dim); font-style: italic; text-align: center; padding: 40px 20px;">Você ainda não tem amigos. Use a busca acima!</p>';
            return;
        }
        
        list.innerHTML = '';
        const friends = snapshot.val();
        
        for (const uid in friends) {
            const userRef = ref(database, `users/${uid}`);
            const userSnap = await get(userRef);
            if (userSnap.exists()) {
                const user = userSnap.val();
                const card = document.createElement('div');
                card.style.cssText = 'background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 16px; display: flex; align-items: center; gap: 12px; margin-bottom: 12px; cursor: pointer; transition: all 0.3s;';
                card.onmouseover = () => { card.style.borderColor = 'var(--gold-dim)'; card.style.transform = 'translateY(-2px)'; };
                card.onmouseout = () => { card.style.borderColor = 'var(--border-subtle)'; card.style.transform = 'translateY(0)'; };
                card.onclick = () => viewFriendProfile(uid, user);
                card.innerHTML = `
                    <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">${user.avatar || '👤'}</div>
                    <div style="flex: 1;">
                        <div style="font-family: var(--font-display); font-size: 0.95rem; color: var(--text-primary);">${user.displayName || user.username}</div>
                        <div style="font-family: var(--font-body); font-size: 0.85rem; color: var(--gold);">@${user.username}</div>
                        <div style="font-family: var(--font-body); font-size: 0.8rem; color: var(--text-muted); margin-top: 4px;">🔥 ${user.currentStreak || 0} dias</div>
                    </div>
                    <svg style="width: 20px; height: 20px; color: var(--text-dim);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
                `;
                list.appendChild(card);
            }
        }
    } catch (error) {
        console.error('Erro:', error);
    }
}

function viewFriendProfile(uid, user) {
    alert(`Perfil: ${user.displayName}\n@${user.username}\n🔥 ${user.currentStreak || 0} dias\n📿 ${user.totalRosaries || 0} rosários\n\n(Modal completo em breve!)`);
}

document.addEventListener('DOMContentLoaded', () => {
    const friendsNavBtn = document.querySelector('.nav-item[data-tab="friends"]');
    if (friendsNavBtn) {
        friendsNavBtn.addEventListener('click', () => {
            if (window.currentUser) {
                loadFriends();
                loadFriendRequests();
            }
        });
    }
    const searchInput = document.getElementById('friend-search-input');
    if (searchInput) {
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchFriend();
        });
    }
});
</script>

<!-- PWA Service Worker Registration -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then((reg) => console.log('Service Worker registrado!', reg.scope))
        .catch((err) => console.log('Falha ao registrar:', err));
    });
  }
    
</script>
</script>
</body>
</html>
