<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Santo Ros√°rio ¬∑ M√©todo Montfort</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #080709;
            --bg-primary: #0d0b0e;
            --bg-secondary: #151316;
            --bg-elevated: #1d1a1f;
            --bg-card: #1a171c;
            
            --text-primary: #f4f1eb;
            --text-secondary: #c2b8aa;
            --text-muted: #7d7470;
            --text-dim: #4d4845;
            
            --gold: #d4a855;
            --gold-bright: #f5d680;
            --gold-light: #e8c45a;
            --gold-dim: #a58540;
            --gold-dark: #6a5225;
            --gold-glow: rgba(212, 168, 85, 0.5);
            
            --burgundy: #6b2d3d;
            --burgundy-light: #8a3d50;
            --burgundy-bright: #a04d62;
            --burgundy-glow: rgba(138, 61, 80, 0.5);
            
            --cream: #faf5e8;
            --border-subtle: rgba(212, 168, 85, 0.1);
            --border-gold: rgba(212, 168, 85, 0.25);
            
            --font-display: 'Cinzel', serif;
            --font-body: 'Cormorant Garamond', serif;
            
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
            
            --bead-size: 48px;
            --bead-size-small: 36px;
            --bead-size-pater: 56px;
            --bead-gap: 20px;
            --rail-width: 110px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; overflow: hidden; }

        body {
            background: var(--bg-deep);
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: 18px;
            line-height: 1.6;
        }

        /* Textura de fundo refinada */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(ellipse at 15% 15%, rgba(107, 45, 61, 0.12) 0%, transparent 45%),
                radial-gradient(ellipse at 85% 85%, rgba(212, 168, 85, 0.08) 0%, transparent 45%),
                radial-gradient(ellipse at 50% 50%, rgba(20, 18, 22, 0.5) 0%, transparent 100%);
            pointer-events: none;
            z-index: 0;
        }

        /* ===== TELA DE AUTENTICA√á√ÉO ===== */
        #auth-screen {
            position: fixed; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 28px;
            z-index: 200;
            transition: opacity 0.6s var(--ease-out), visibility 0.6s;
        }

        #auth-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

        .auth-container { width: 100%; max-width: 380px; text-align: center; }

        .auth-logo { width: 50px; height: 70px; position: relative; margin: 0 auto 24px; }
        
        .auth-logo::before,
        .auth-logo::after {
            content: ''; position: absolute;
            background: linear-gradient(180deg, var(--gold-bright) 0%, var(--gold) 50%, var(--gold-dim) 100%);
            border-radius: 2px;
        }
        
        .auth-logo::before { width: 4px; height: 100%; left: 50%; transform: translateX(-50%); }
        .auth-logo::after { width: 40px; height: 4px; top: 20px; left: 50%; transform: translateX(-50%); }

        .auth-title {
            font-family: var(--font-display); font-size: 1.8rem; font-weight: 500;
            letter-spacing: 0.2em; color: var(--text-primary); margin-bottom: 6px;
        }

        .auth-subtitle {
            font-family: var(--font-body); font-size: 1rem; font-style: italic;
            color: var(--text-muted); margin-bottom: 20px;
        }

        .auth-info {
            background: rgba(212, 168, 85, 0.1); border: 1px solid var(--border-subtle);
            border-radius: 8px; padding: 16px; margin-bottom: 24px;
            font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6;
        }

        .auth-tabs { display: flex; margin-bottom: 28px; border-bottom: 1px solid var(--border-subtle); }

        .auth-tab {
            flex: 1; padding: 14px; background: none; border: none;
            font-family: var(--font-display); font-size: 0.75rem;
            letter-spacing: 0.15em; text-transform: uppercase;
            color: var(--text-muted); cursor: pointer;
            transition: all 0.3s; position: relative;
        }

        .auth-tab::after {
            content: ''; position: absolute; bottom: -1px;
            left: 50%; transform: translateX(-50%); width: 0; height: 2px;
            background: var(--gold); transition: width 0.3s var(--ease-out);
        }

        .auth-tab.active { color: var(--gold); }
        .auth-tab.active::after { width: 60%; }

        .auth-form { display: none; }
        .auth-form.active { display: block; }

        .input-group { margin-bottom: 18px; text-align: left; }

        .input-label {
            display: block; font-family: var(--font-display);
            font-size: 0.6rem; letter-spacing: 0.2em;
            text-transform: uppercase; color: var(--text-dim); margin-bottom: 8px;
        }

        .input-field {
            width: 100%; padding: 14px 16px; background: #0f0d10;
            border: 1px solid var(--border-subtle); border-radius: 4px;
            font-family: var(--font-body); font-size: 1.05rem;
            color: var(--text-primary); transition: all 0.3s;
        }

        .input-field:focus {
            outline: none; border-color: var(--gold-dim);
            box-shadow: 0 0 0 3px rgba(212, 168, 85, 0.1);
        }

        .input-field::placeholder { color: var(--text-dim); }

        .auth-btn {
            width: 100%; padding: 16px; margin-top: 8px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%);
            border: none; border-radius: 4px;
            font-family: var(--font-display); font-size: 0.85rem;
            letter-spacing: 0.15em; text-transform: uppercase;
            color: var(--bg-deep); cursor: pointer; transition: all 0.3s;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 168, 85, 0.3);
        }

        .auth-btn:disabled { opacity: 0.6; cursor: not-allowed; }

        .auth-error, .auth-success {
            margin-top: 16px; padding: 12px; border-radius: 4px;
            font-size: 0.9rem; display: none;
        }

        .auth-error {
            background: rgba(180, 60, 60, 0.15);
            border: 1px solid rgba(180, 60, 60, 0.3);
            color: #e07070;
        }

        .auth-success {
            background: rgba(74, 158, 107, 0.15);
            border: 1px solid rgba(74, 158, 107, 0.3);
            color: #70e070;
        }

        .auth-error.visible, .auth-success.visible { display: block; }

        .loading {
            display: inline-block; width: 20px; height: 20px;
            border: 3px solid rgba(212, 168, 85, 0.3);
            border-radius: 50%; border-top-color: var(--gold);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ===== ESTRUTURA PRINCIPAL COM NAVBAR ===== */
        #main-app {
            position: fixed; inset: 0;
            display: flex; flex-direction: column;
            transition: opacity 0.6s var(--ease-out), visibility 0.6s;
            z-index: 100;
        }

        #main-app.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

        .app-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 70px;
        }

        .tab-content {
            display: none;
            width: 100%;
            height: 100%;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-deep) 100%);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            z-index: 150;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px 0;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .nav-icon {
            width: 26px;
            height: 26px;
            color: var(--text-dim);
            transition: all 0.3s;
            margin-bottom: 4px;
        }

        .nav-label {
            font-family: var(--font-display);
            font-size: 0.5rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--text-dim);
            transition: all 0.3s;
        }

        .nav-item.active .nav-icon {
            color: var(--gold);
            filter: drop-shadow(0 0 8px var(--gold-glow));
        }

        .nav-item.active .nav-label {
            color: var(--gold);
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: var(--gold);
            transition: width 0.3s var(--ease-out);
        }

        .nav-item.active::before {
            width: 40px;
        }

        /* ===== TELA INICIAL (HOME TAB) ===== */
        .home-screen-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100%;
            padding: 28px;
        }

        /* Cruz decorativa */
        .home-cross {
            width: 50px;
            height: 70px;
            position: relative;
            margin-bottom: 24px;
        }

        .home-cross::before,
        .home-cross::after {
            content: '';
            position: absolute;
            background: linear-gradient(180deg, var(--gold-bright) 0%, var(--gold) 50%, var(--gold-dim) 100%);
            border-radius: 2px;
        }

        .home-cross::before {
            width: 4px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
        }

        .home-cross::after {
            width: 36px;
            height: 4px;
            top: 18px;
            left: 50%;
            transform: translateX(-50%);
        }

        .home-cross-glow {
            position: absolute;
            inset: -20px;
            background: radial-gradient(circle, var(--gold-glow) 0%, transparent 70%);
            opacity: 0.5;
            animation: cross-glow 4s ease-in-out infinite;
        }

        @keyframes cross-glow {
            0%, 100% { opacity: 0.4; transform: scale(0.95); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }

        .home-title {
            font-family: var(--font-display);
            font-size: 2.2rem;
            font-weight: 500;
            letter-spacing: 0.25em;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-shadow: 0 2px 20px rgba(0,0,0,0.5);
        }

        .home-subtitle {
            font-family: var(--font-body);
            font-size: 1.1rem;
            font-style: italic;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .home-method {
            font-family: var(--font-display);
            font-size: 0.6rem;
            letter-spacing: 0.3em;
            color: var(--gold);
            text-transform: uppercase;
            margin-bottom: 36px;
            padding: 10px 20px;
            border: 1px solid var(--border-gold);
            background: linear-gradient(135deg, rgba(212, 168, 85, 0.08) 0%, rgba(212, 168, 85, 0.02) 100%);
            position: relative;
        }

        .home-method::before,
        .home-method::after {
            content: '‚ú¶';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gold-dim);
            font-size: 0.5rem;
        }

        .home-method::before { left: 8px; }
        .home-method::after { right: 8px; }

        .today-info {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 32px;
            text-align: center;
        }

        .today-info strong {
            color: var(--gold);
            font-weight: 500;
        }

        .menu-section {
            width: 100%;
            max-width: 360px;
            margin-bottom: 24px;
        }

        .menu-label {
            font-family: var(--font-display);
            font-size: 0.55rem;
            letter-spacing: 0.35em;
            color: var(--text-dim);
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .menu-label::before,
        .menu-label::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-subtle), transparent);
        }

        .menu-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* ===== BOT√ïES ELEGANTES - ESTILO ORIGINAL MELHORADO ===== */
        .btn-mystery {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            padding: 22px 28px;
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 400;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.5s var(--ease-smooth);
            position: relative;
            overflow: hidden;
        }

        /* Efeito de luz que passa */
        .btn-mystery::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(212, 168, 85, 0.15) 50%, 
                transparent 100%);
            transition: left 0.7s var(--ease-smooth);
        }

        /* Linha dourada inferior */
        .btn-mystery::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
            transition: width 0.5s var(--ease-smooth);
        }

        .btn-mystery:hover::before {
            left: 100%;
        }

        .btn-mystery:hover::after {
            width: 70%;
        }

        .btn-mystery:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
            background: rgba(212, 168, 85, 0.06);
            transform: translateY(-4px);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.4),
                0 0 50px rgba(212, 168, 85, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .btn-mystery:active {
            transform: translateY(-2px);
            transition: transform 0.1s;
        }

        /* Bot√£o do Ros√°rio Completo */
        .btn-complete {
            background: linear-gradient(135deg, rgba(107, 45, 61, 0.2) 0%, rgba(107, 45, 61, 0.08) 100%);
            border: 1px solid rgba(138, 61, 80, 0.35);
            color: var(--cream);
            padding: 24px 28px;
            margin-top: 4px;
        }

        .btn-complete::before {
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(212, 168, 85, 0.2) 50%, 
                transparent 100%);
        }

        .btn-complete:hover {
            background: linear-gradient(135deg, rgba(107, 45, 61, 0.3) 0%, rgba(107, 45, 61, 0.12) 100%);
            border-color: var(--gold-dim);
            box-shadow: 
                0 18px 45px rgba(0, 0, 0, 0.45),
                0 0 60px rgba(212, 168, 85, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.06);
        }

        .btn-complete small {
            display: block;
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-style: italic;
            font-weight: 400;
            letter-spacing: 0.02em;
            text-transform: none;
            color: var(--text-muted);
            margin-top: 8px;
        }

        /* Bot√£o de √°udio */
        .audio-toggle {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s var(--ease-smooth);
            z-index: 200;
        }

        .audio-toggle:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
            transform: scale(1.05);
        }

        .audio-toggle.active {
            color: var(--gold);
            border-color: var(--gold-dim);
            background: rgba(212, 168, 85, 0.12);
            box-shadow: 0 0 20px rgba(212, 168, 85, 0.2);
        }

        .audio-toggle svg { width: 22px; height: 22px; }

        /* ===== TELA DE ORA√á√ÉO ===== */
        #prayer-screen {
            position: fixed; inset: 0;
            display: flex; flex-direction: row;
            background: var(--bg-deep);
            opacity: 0; visibility: hidden;
            transition: opacity 0.6s var(--ease-out), visibility 0.6s;
            z-index: 200;
        }

        #prayer-screen.active { opacity: 1; visibility: visible; }

        /* Trilho do Ros√°rio */
        .rosary-rail {
            position: relative;
            width: var(--rail-width);
            height: 100%;
            background: linear-gradient(90deg, var(--bg-primary) 0%, var(--bg-deep) 100%);
            border-right: 1px solid rgba(212, 168, 85, 0.06);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
        }

        .rosary-rail::before,
        .rosary-rail::after {
            content: '';
            position: absolute;
            left: 0; right: 0;
            height: 140px;
            z-index: 10;
            pointer-events: none;
        }

        .rosary-rail::before {
            top: 0;
            background: linear-gradient(180deg, var(--bg-deep) 0%, rgba(8, 7, 9, 0.8) 50%, transparent 100%);
        }

        .rosary-rail::after {
            bottom: 0;
            background: linear-gradient(0deg, var(--bg-deep) 0%, rgba(8, 7, 9, 0.8) 50%, transparent 100%);
        }

        /* Corrente dourada */
        .rosary-chain {
            position: absolute;
            top: 50%; left: 50%;
            width: 3px;
            height: calc(100% + 300px);
            transform: translate(-50%, -50%);
            background: linear-gradient(180deg, 
                transparent 0%, 
                var(--gold-dark) 3%,
                var(--gold-dim) 15%,
                var(--gold) 50%,
                var(--gold-dim) 85%,
                var(--gold-dark) 97%,
                transparent 100%);
            opacity: 0.4;
            border-radius: 2px;
        }

        /* Guia central */
        .center-guide {
            position: absolute;
            top: 50%;
            left: 15%;
            right: 15%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(212, 168, 85, 0.2), transparent);
            transform: translateY(-50%);
            z-index: 5;
        }

        /* Container das contas */
        #bead-track {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, 0);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--bead-gap);
            transition: transform 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            will-change: transform;
            padding: 100px 0;
        }

        /* ===== CONTAS BRILHANTES E REALISTAS ===== */
        .bead {
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.45s var(--ease-smooth);
            position: relative;
            flex-shrink: 0;
        }

        /* Aura de luz ao redor da conta ativa */
        .bead::before {
            content: '';
            position: absolute;
            inset: -15px;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
            transform: scale(0.5);
            z-index: -1;
        }

        .bead.active::before {
            opacity: 1;
            transform: scale(1);
            animation: bead-aura 2.5s ease-in-out infinite;
        }

        @keyframes bead-aura {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.25); }
        }

        /* Reflexo de luz superior */
        .bead::after {
            content: '';
            position: absolute;
            top: 12%;
            left: 18%;
            width: 35%;
            height: 30%;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .bead:hover::after,
        .bead.active::after {
            opacity: 1;
        }

        /* ===== CONTA AVE MARIA - Madeira polida escura ===== */
        .bead.ave {
            width: var(--bead-size-small);
            height: var(--bead-size-small);
            background: 
                radial-gradient(ellipse at 28% 22%, rgba(255,255,255,0.18) 0%, transparent 45%),
                radial-gradient(ellipse at 70% 75%, rgba(0,0,0,0.3) 0%, transparent 50%),
                radial-gradient(circle at 35% 35%, #5a5450, #454240, #353330, #252320);
            box-shadow: 
                inset -5px -5px 12px rgba(0, 0, 0, 0.7),
                inset 4px 4px 10px rgba(255, 255, 255, 0.06),
                0 5px 15px rgba(0, 0, 0, 0.5),
                0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .bead.ave::before {
            background: radial-gradient(circle, rgba(212, 168, 85, 0.45) 0%, transparent 65%);
        }

        .bead.ave::after {
            background: radial-gradient(ellipse, rgba(255,255,255,0.35) 0%, transparent 70%);
        }

        .bead.ave:hover {
            transform: scale(1.1);
            box-shadow: 
                inset -5px -5px 12px rgba(0, 0, 0, 0.6),
                inset 4px 4px 10px rgba(255, 255, 255, 0.1),
                0 8px 25px rgba(0, 0, 0, 0.5),
                0 0 20px rgba(212, 168, 85, 0.15);
        }

        .bead.ave.active {
            width: var(--bead-size);
            height: var(--bead-size);
            transform: scale(1.15);
            background: 
                radial-gradient(ellipse at 28% 22%, rgba(255,255,255,0.28) 0%, transparent 40%),
                radial-gradient(ellipse at 70% 75%, rgba(0,0,0,0.25) 0%, transparent 50%),
                radial-gradient(circle at 35% 35%, #706a65, #5a5550, #454240, #353330);
            box-shadow: 
                inset -5px -5px 12px rgba(0, 0, 0, 0.5),
                inset 4px 4px 10px rgba(255, 255, 255, 0.12),
                0 0 40px rgba(212, 168, 85, 0.5),
                0 0 70px rgba(212, 168, 85, 0.25),
                0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* ===== CONTA PAI NOSSO - Ouro polido ===== */
        .bead.pater {
            width: calc(var(--bead-size-small) + 12px);
            height: calc(var(--bead-size-small) + 12px);
            background: 
                radial-gradient(ellipse at 22% 18%, rgba(255,255,255,0.6) 0%, transparent 35%),
                radial-gradient(ellipse at 75% 80%, rgba(100, 70, 20, 0.4) 0%, transparent 45%),
                radial-gradient(circle at 35% 35%, var(--gold-bright), var(--gold-light), var(--gold), var(--gold-dim));
            box-shadow: 
                inset -5px -5px 15px rgba(100, 70, 20, 0.5),
                inset 5px 5px 12px rgba(255, 255, 255, 0.4),
                0 5px 20px rgba(0, 0, 0, 0.5),
                0 0 25px rgba(212, 168, 85, 0.35);
        }

        .bead.pater::before {
            background: radial-gradient(circle, var(--gold-glow) 0%, transparent 60%);
        }

        .bead.pater::after {
            background: radial-gradient(ellipse, rgba(255,255,255,0.5) 0%, transparent 65%);
            opacity: 0.8;
        }

        .bead.pater:hover {
            transform: scale(1.1);
            box-shadow: 
                inset -5px -5px 15px rgba(100, 70, 20, 0.4),
                inset 5px 5px 12px rgba(255, 255, 255, 0.5),
                0 8px 30px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(212, 168, 85, 0.5);
        }

        .bead.pater.active {
            width: var(--bead-size-pater);
            height: var(--bead-size-pater);
            transform: scale(1.15);
            background: 
                radial-gradient(ellipse at 22% 18%, rgba(255,255,255,0.75) 0%, transparent 30%),
                radial-gradient(ellipse at 75% 80%, rgba(100, 70, 20, 0.3) 0%, transparent 45%),
                radial-gradient(circle at 35% 35%, #ffe890, var(--gold-bright), var(--gold-light), var(--gold));
            box-shadow: 
                inset -5px -5px 15px rgba(100, 70, 20, 0.35),
                inset 5px 5px 12px rgba(255, 255, 255, 0.55),
                0 0 55px rgba(212, 168, 85, 0.7),
                0 0 90px rgba(212, 168, 85, 0.4),
                0 12px 35px rgba(0, 0, 0, 0.5);
        }

        /* ===== CONTA ESPECIAL - Bord√¥/Rubi ===== */
        .bead.special {
            width: calc(var(--bead-size-small) + 8px);
            height: calc(var(--bead-size-small) + 8px);
            background: 
                radial-gradient(ellipse at 25% 20%, rgba(255,255,255,0.3) 0%, transparent 40%),
                radial-gradient(ellipse at 72% 78%, rgba(40, 15, 20, 0.4) 0%, transparent 45%),
                radial-gradient(circle at 35% 35%, var(--burgundy-bright), var(--burgundy-light), var(--burgundy), #4a1a28);
            box-shadow: 
                inset -4px -4px 12px rgba(40, 15, 20, 0.6),
                inset 4px 4px 10px rgba(255, 255, 255, 0.15),
                0 5px 15px rgba(0, 0, 0, 0.5),
                0 0 18px rgba(138, 61, 80, 0.3);
        }

        .bead.special::before {
            background: radial-gradient(circle, var(--burgundy-glow) 0%, transparent 60%);
        }

        .bead.special::after {
            background: radial-gradient(ellipse, rgba(255,255,255,0.4) 0%, transparent 65%);
        }

        .bead.special:hover {
            transform: scale(1.1);
            box-shadow: 
                inset -4px -4px 12px rgba(40, 15, 20, 0.5),
                inset 4px 4px 10px rgba(255, 255, 255, 0.2),
                0 8px 25px rgba(0, 0, 0, 0.5),
                0 0 30px rgba(138, 61, 80, 0.4);
        }

        .bead.special.active {
            width: calc(var(--bead-size) + 8px);
            height: calc(var(--bead-size) + 8px);
            transform: scale(1.15);
            background: 
                radial-gradient(ellipse at 25% 20%, rgba(255,255,255,0.45) 0%, transparent 35%),
                radial-gradient(ellipse at 72% 78%, rgba(40, 15, 20, 0.3) 0%, transparent 45%),
                radial-gradient(circle at 35% 35%, #c55a70, var(--burgundy-bright), var(--burgundy-light), var(--burgundy));
            box-shadow: 
                inset -4px -4px 12px rgba(40, 15, 20, 0.4),
                inset 4px 4px 10px rgba(255, 255, 255, 0.25),
                0 0 50px rgba(138, 61, 80, 0.6),
                0 0 80px rgba(138, 61, 80, 0.35),
                0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* Conte√∫do principal */
        .prayer-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            position: relative;
        }

        .prayer-header {
            padding: 18px 24px;
            background: linear-gradient(180deg, var(--bg-primary) 0%, transparent 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-family: var(--font-display);
            font-size: 0.65rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            cursor: pointer;
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .back-btn:hover {
            color: var(--gold);
            transform: translateX(-3px);
        }

        .back-btn svg { width: 16px; height: 16px; }

        .progress-compact {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .progress-bar-mini {
            width: 90px;
            height: 3px;
            background: var(--bg-elevated);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill-mini {
            height: 100%;
            background: linear-gradient(90deg, var(--gold-dim), var(--gold), var(--gold-bright));
            transition: width 0.5s var(--ease-out);
            border-radius: 2px;
        }

        .progress-text {
            font-family: var(--font-display);
            font-size: 0.65rem;
            color: var(--text-dim);
            letter-spacing: 0.08em;
        }

        .prayer-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 32px 32px;
            overflow-y: auto;
        }

        .prayer-group {
            font-family: var(--font-display);
            font-size: 0.6rem;
            letter-spacing: 0.28em;
            text-transform: uppercase;
            color: var(--gold-dim);
            margin-bottom: 8px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.45s var(--ease-out);
        }

        .prayer-group.visible { opacity: 1; transform: translateY(0); }

        .prayer-mystery {
            font-family: var(--font-body);
            font-size: 1.2rem;
            font-style: italic;
            color: var(--text-secondary);
            margin-bottom: 18px;
            min-height: 1.5em;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.45s var(--ease-out) 0.05s;
        }

        .prayer-mystery.visible { opacity: 1; transform: translateY(0); }

        .prayer-name {
            font-family: var(--font-display);
            font-size: 2.2rem;
            font-weight: 500;
            color: var(--text-primary);
            letter-spacing: 0.05em;
            margin-bottom: 8px;
            opacity: 0;
            transform: translateY(-12px);
            transition: all 0.45s var(--ease-out) 0.1s;
        }

        .prayer-name.visible { opacity: 1; transform: translateY(0); }

        .prayer-count {
            font-family: var(--font-display);
            font-size: 0.7rem;
            letter-spacing: 0.18em;
            color: var(--text-dim);
            margin-bottom: 24px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.45s var(--ease-out) 0.15s;
        }

        .prayer-count.visible { opacity: 1; transform: translateY(0); }

        /* Caixa de medita√ß√£o refinada */
        .meditation-box {
            background: linear-gradient(135deg, rgba(212, 168, 85, 0.1) 0%, rgba(212, 168, 85, 0.03) 100%);
            border-left: 3px solid var(--gold);
            padding: 20px 24px;
            margin-bottom: 24px;
            opacity: 0;
            transform: translateX(-15px);
            transition: all 0.5s var(--ease-out) 0.2s;
            position: relative;
        }

        .meditation-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, var(--gold-dim), transparent);
        }

        .meditation-box.visible { opacity: 1; transform: translateX(0); }

        .meditation-label {
            font-family: var(--font-display);
            font-size: 0.55rem;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 10px;
        }

        .meditation-text {
            font-family: var(--font-body);
            font-size: 1.2rem;
            font-style: italic;
            color: var(--text-primary);
            line-height: 1.75;
        }

        /* Toggle do texto da ora√ß√£o */
        .prayer-text-toggle {
            background: none;
            border: 1px solid var(--border-subtle);
            color: var(--text-muted);
            font-family: var(--font-display);
            font-size: 0.6rem;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            padding: 12px 18px;
            cursor: pointer;
            transition: all 0.35s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-bottom: 14px;
        }

        .prayer-text-toggle:hover {
            border-color: var(--border-gold);
            color: var(--gold);
            background: rgba(212, 168, 85, 0.04);
        }

        .prayer-text-toggle svg {
            width: 14px;
            height: 14px;
            transition: transform 0.35s var(--ease-out);
        }

        .prayer-text-toggle.expanded svg { transform: rotate(180deg); }

        .prayer-full-text {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.45s var(--ease-out), opacity 0.35s, padding 0.35s;
            opacity: 0;
            background: var(--bg-card);
            border-radius: 6px;
            border: 1px solid var(--border-subtle);
        }

        .prayer-full-text.visible {
            max-height: 420px;
            opacity: 1;
            padding: 18px 20px;
            margin-bottom: 18px;
        }

        .prayer-full-text p {
            font-family: var(--font-body);
            font-size: 1.05rem;
            color: var(--text-secondary);
            line-height: 1.85;
        }

        /* Footer com navega√ß√£o */
        .prayer-footer {
            padding: 18px 24px;
            background: linear-gradient(0deg, var(--bg-primary) 0%, transparent 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 18px;
            flex-shrink: 0;
        }

        .nav-btn {
            width: 54px;
            height: 54px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.35s var(--ease-smooth);
        }

        .nav-btn:hover:not(:disabled) {
            background: var(--bg-elevated);
            border-color: var(--border-gold);
            color: var(--gold);
            transform: scale(1.08);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-btn:disabled { opacity: 0.25; cursor: not-allowed; }
        .nav-btn svg { width: 24px; height: 24px; }

        .nav-btn.primary {
            width: 68px;
            height: 68px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%);
            border: none;
            color: var(--bg-deep);
            box-shadow: 0 4px 20px rgba(212, 168, 85, 0.3);
        }

        .nav-btn.primary:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--gold-bright) 0%, var(--gold) 100%);
            transform: scale(1.1);
            box-shadow: 0 0 35px rgba(212, 168, 85, 0.5), 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .nav-hint {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            font-family: var(--font-body);
            font-size: 0.8rem;
            color: var(--text-dim);
            font-style: italic;
            white-space: nowrap;
        }

        /* ===== TELA DE CONCLUS√ÉO ===== */
        #completion-screen {
            position: fixed; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 28px;
            background: var(--bg-deep);
            z-index: 200;
            opacity: 0; visibility: hidden;
            transition: opacity 0.6s var(--ease-out), visibility 0.6s;
        }

        #completion-screen.active { opacity: 1; visibility: visible; }

        .completion-icon {
            width: 100px;
            height: 100px;
            color: var(--gold);
            margin-bottom: 28px;
            animation: completion-glow 2.5s ease-in-out infinite;
        }

        @keyframes completion-glow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(212, 168, 85, 0.4)); transform: scale(1); }
            50% { filter: drop-shadow(0 0 40px rgba(212, 168, 85, 0.7)); transform: scale(1.06); }
        }

        .completion-title {
            font-family: var(--font-display);
            font-size: 1.8rem;
            color: var(--text-primary);
            letter-spacing: 0.18em;
            margin-bottom: 10px;
        }

        .completion-subtitle {
            font-family: var(--font-body);
            font-size: 1.1rem;
            font-style: italic;
            color: var(--text-secondary);
            text-align: center;
            max-width: 340px;
            margin-bottom: 32px;
            line-height: 1.6;
        }

        .completion-stats {
            display: flex;
            gap: 40px;
            margin-bottom: 36px;
        }

        .stat { text-align: center; }

        .stat-value {
            font-family: var(--font-display);
            font-size: 2.4rem;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(212, 168, 85, 0.3);
        }

        .stat-label {
            font-family: var(--font-body);
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .btn-home {
            background: var(--bg-card);
            border: 1px solid var(--border-gold);
            color: var(--gold);
            padding: 16px 32px;
            font-family: var(--font-display);
            font-size: 0.85rem;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.35s;
        }

        .btn-home:hover {
            background: rgba(212, 168, 85, 0.12);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        }

        /* ===== RESPONSIVO ===== */
        @media (max-width: 768px) {
            :root {
                --bead-size: 54px;
                --bead-size-small: 44px;
                --bead-size-pater: 62px;
                --bead-gap: 18px;
                --rail-width: 85px;
            }

            .rosary-rail {
                order: 2;
                width: var(--rail-width);
                background: linear-gradient(-90deg, var(--bg-primary) 0%, var(--bg-deep) 100%);
                border-right: none;
                border-left: 1px solid rgba(212, 168, 85, 0.06);
            }

            .rosary-rail::before, .rosary-rail::after { height: 110px; }
            .prayer-main { order: 1; }
            .prayer-body { padding: 24px 20px; }
            .prayer-name { font-size: 1.8rem; }
            .meditation-text { font-size: 1.1rem; }
            .nav-btn { width: 52px; height: 52px; }
            .nav-btn.primary { width: 62px; height: 62px; }
            .nav-hint { display: none; }
            .progress-bar-mini { width: 70px; }
            .audio-toggle { bottom: 110px; right: 14px; width: 44px; height: 44px; }
            .home-title { font-size: 1.8rem; }
        }

        @media (max-width: 380px) {
            :root {
                --rail-width: 75px;
                --bead-size: 50px;
                --bead-size-small: 40px;
                --bead-size-pater: 56px;
            }

            .prayer-body { padding: 18px 16px; }
            .prayer-name { font-size: 1.5rem; }
            .meditation-text { font-size: 1rem; }
            .home-title { font-size: 1.6rem; }
        }

        @media (max-height: 500px) and (orientation: landscape) {
            .rosary-rail { width: 75px; }
            .prayer-header, .prayer-footer { padding: 12px 18px; }
            .prayer-body { padding: 14px 18px; }
            .prayer-name { font-size: 1.5rem; margin-bottom: 5px; }
            .meditation-box { padding: 14px 16px; margin-bottom: 14px; }
        }
    </style>
</head>
<body>

<!-- TELA DE AUTENTICA√á√ÉO -->
<div id="auth-screen">
    <div class="auth-container">
        <div class="auth-logo"></div>
        <h1 class="auth-title">Ros√°rio</h1>
        <p class="auth-subtitle">M√©todo de S√£o Lu√≠s de Montfort</p>
        
        <div class="auth-info">
            ‚ú® <strong>Autentica√ß√£o Segura:</strong> Seus dados s√£o protegidos com Firebase!
        </div>

        <div class="auth-tabs">
            <button class="auth-tab active" data-tab="login" type="button">Entrar</button>
            <button class="auth-tab" data-tab="register" type="button">Criar Conta</button>
        </div>

        <form id="login-form" class="auth-form active">
            <div class="input-group">
                <label class="input-label">Nome de Usu√°rio</label>
                <input type="text" class="input-field" id="login-username" placeholder="Seu nome de usu√°rio" required autocomplete="username">
            </div>
            <div class="input-group">
                <label class="input-label">Senha</label>
                <input type="password" class="input-field" id="login-password" placeholder="Sua senha" required autocomplete="current-password">
            </div>
            <button type="submit" class="auth-btn" id="login-btn">Entrar</button>
            <div class="auth-error" id="login-error"></div>
        </form>

        <form id="register-form" class="auth-form">
            <div class="input-group">
                <label class="input-label">Nome de Usu√°rio</label>
                <input type="text" class="input-field" id="register-username" placeholder="Escolha um nome" required minlength="3" autocomplete="username">
            </div>
            <div class="input-group">
                <label class="input-label">Nome Completo</label>
                <input type="text" class="input-field" id="register-displayname" placeholder="Seu nome completo" required minlength="2" autocomplete="name">
            </div>
            <div class="input-group">
                <label class="input-label">Crie uma Senha</label>
                <input type="password" class="input-field" id="register-password" placeholder="M√≠nimo 6 caracteres" required minlength="6" autocomplete="new-password">
            </div>
            <div class="input-group">
                <label class="input-label">Confirme a Senha</label>
                <input type="password" class="input-field" id="register-confirm" placeholder="Repita a senha" required autocomplete="new-password">
            </div>
            <button type="submit" class="auth-btn" id="register-btn">Criar Conta</button>
            <div class="auth-error" id="register-error"></div>
            <div class="auth-success" id="register-success"></div>
        </form>
    </div>
</div>

<!-- APLICATIVO PRINCIPAL -->
<div id="main-app" class="hidden">
    <div class="app-content">
        <!-- TAB HOME -->
        <div id="tab-home" class="tab-content active">
            <div class="home-screen-content">
    <div class="home-cross">
        <div class="home-cross-glow"></div>
    </div>
    <h1 class="home-title">Ros√°rio</h1>
    <p class="home-subtitle">Em honra da Sant√≠ssima Virgem Maria</p>
    <div class="home-method">M√©todo de S√£o Lu√≠s de Montfort</div>
    <p class="today-info" id="today-info"></p>
    <div class="menu-section">
        <div class="menu-label">Mist√©rios</div>
        <div class="menu-grid">
            <button class="btn-mystery" onclick="app.start('gozosos')">Gozosos</button>
            <button class="btn-mystery" onclick="app.start('dolorosos')">Dolorosos</button>
            <button class="btn-mystery" onclick="app.start('gloriosos')">Gloriosos</button>
        </div>
    </div>
    <div class="menu-section">
        <div class="menu-label">Ros√°rio Completo</div>
        <div class="menu-grid">
            <button class="btn-mystery btn-complete" onclick="app.start('completo')">
                Todos os Mist√©rios
                <small>Gozosos, Dolorosos e Gloriosos</small>
            </button>
        </div>
    </div>
            </div>
        </div>

        <!-- TAB CALEND√ÅRIO -->
        <div id="tab-calendar" class="tab-content">
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100%; padding: 40px 20px; text-align: center;">
                <p style="color: var(--text-muted); font-style: italic; font-size: 1rem;">
                    üìÖ Calend√°rio<br>(Em desenvolvimento)
                </p>
            </div>
        </div>

        <!-- TAB PERFIL -->
        <div id="tab-profile" class="tab-content">
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100%; padding: 40px 20px; text-align: center;">
                <div style="width: 80px; height: 80px; margin: 0 auto 16px; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: var(--font-display); font-size: 2rem; color: var(--bg-deep);" id="profile-avatar">
                    üë§
                </div>
                <h2 style="font-family: var(--font-display); font-size: 1.4rem; letter-spacing: 0.1em; color: var(--text-primary); margin-bottom: 28px;" id="profile-name">
                    Usu√°rio
                </h2>
                <button type="button" style="width: 100%; max-width: 300px; padding: 16px; background: linear-gradient(135deg, rgba(180, 60, 60, 0.2) 0%, rgba(180, 60, 60, 0.08) 100%); border: 1px solid rgba(180, 60, 60, 0.3); border-radius: 8px; font-family: var(--font-display); font-size: 0.8rem; letter-spacing: 0.1em; text-transform: uppercase; color: #c07070; cursor: pointer; transition: all 0.3s;" onclick="firebaseAuth.logoutUser()" onmouseover="this.style.background='rgba(180, 60, 60, 0.15)'; this.style.borderColor='rgba(180, 60, 60, 0.5)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.background='linear-gradient(135deg, rgba(180, 60, 60, 0.2) 0%, rgba(180, 60, 60, 0.08) 100%)'; this.style.borderColor='rgba(180, 60, 60, 0.3)'; this.style.transform='translateY(0)';">
                    Sair da Conta
                </button>
            </div>
        </div>
    </div>

    <!-- BOTTOM NAVIGATION -->
    <nav class="bottom-nav">
        <button type="button" class="nav-item active" data-tab="home">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
            <span class="nav-label">In√≠cio</span>
        </button>
        <button type="button" class="nav-item" id="nav-rosary-btn">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="1.5"/>
                <circle cx="12" cy="3" r="2.5"/>
                <circle cx="19.5" cy="7.5" r="2"/>
                <circle cx="19.5" cy="16.5" r="2"/>
                <circle cx="12" cy="21" r="2.5"/>
                <circle cx="4.5" cy="16.5" r="2"/>
                <circle cx="4.5" cy="7.5" r="2"/>
            </svg>
            <span class="nav-label">Ros√°rio</span>
        </button>
        <button type="button" class="nav-item" data-tab="calendar">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <span class="nav-label">Calend√°rio</span>
        </button>
        <button type="button" class="nav-item" data-tab="profile">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
            <span class="nav-label">Perfil</span>
        </button>
    </nav>
</div>

<!-- TELA DE ORA√á√ÉO (sobrep√µe tudo quando ativa) -->

<div id="prayer-screen">
    <div class="rosary-rail">
        <div class="rosary-chain"></div>
        <div class="center-guide"></div>
        <div id="bead-track"></div>
    </div>
    <div class="prayer-main">
        <header class="prayer-header">
            <button class="back-btn" onclick="app.confirmExit()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                Sair
            </button>
            <div class="progress-compact">
                <div class="progress-bar-mini"><div class="progress-fill-mini" id="progress-fill"></div></div>
                <span class="progress-text" id="progress-text">1/59</span>
            </div>
        </header>
        <div class="prayer-body" id="prayer-body">
            <div class="prayer-group" id="prayer-group"></div>
            <div class="prayer-mystery" id="prayer-mystery"></div>
            <h2 class="prayer-name" id="prayer-name"></h2>
            <div class="prayer-count" id="prayer-count"></div>
            <div class="meditation-box" id="meditation-box">
                <div class="meditation-label">Medita√ß√£o</div>
                <p class="meditation-text" id="meditation-text"></p>
            </div>
            <button class="prayer-text-toggle" id="prayer-text-toggle" onclick="app.toggleText()">
                <span>Ver texto da ora√ß√£o</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M6 9l6 6 6-6"/></svg>
            </button>
            <div class="prayer-full-text" id="prayer-full-text"></div>
            <p class="nav-hint">Toque nas contas ou use as setas para navegar</p>
        </div>
        <footer class="prayer-footer">
            <button class="nav-btn" id="prev-btn" onclick="app.prev()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <button class="nav-btn primary" id="next-btn" onclick="app.next()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M9 18l6-6-6-6"/></svg>
            </button>
        </footer>
    </div>
</div>

<div id="completion-screen">
    <svg class="completion-icon" viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="50" cy="50" r="42"/>
        <path d="M28 50l16 16 28-32" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <h2 class="completion-title">Deo Gratias</h2>
    <p class="completion-subtitle" id="completion-msg"></p>
    <div class="completion-stats">
        <div class="stat"><div class="stat-value" id="stat-aves">0</div><div class="stat-label">Ave Marias</div></div>
        <div class="stat"><div class="stat-value" id="stat-paters">0</div><div class="stat-label">Pai Nossos</div></div>
    </div>
    <button class="btn-home" onclick="app.home()">Voltar ao In√≠cio</button>
</div>

<button class="audio-toggle" id="audio-toggle" onclick="app.toggleAudio()" title="Ativar/Desativar sons (M)">
    <svg id="audio-icon-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="display:none;">
        <path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
    </svg>
    <svg id="audio-icon-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M11 5L6 9H2v6h4l5 4V5z"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/>
    </svg>
</button>

<!-- Firebase SDK v9 (modular) -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
import { getDatabase, ref, set, get, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyAD_SvPlYGGZM1JMZmIjfai-a3TPPKDxLg",
    authDomain: "rosario-app-a9da0.firebaseapp.com",
    databaseURL: "https://rosario-app-a9da0-default-rtdb.firebaseio.com",
    projectId: "rosario-app-a9da0",
    storageBucket: "rosario-app-a9da0.firebasestorage.app",
    messagingSenderId: "928215518242",
    appId: "1:928215518242:web:09c61bfbfc0fc947570e7b"
};

const firebaseApp = initializeApp(firebaseConfig);
const auth = getAuth(firebaseApp);
const database = getDatabase(firebaseApp);

// Converter username para email interno
function usernameToEmail(username) {
    return username.toLowerCase().replace(/\s+/g, '') + '@rosario.app';
}

// Mensagens de erro em portugu√™s
function getFirebaseErrorMessage(errorCode) {
    const errors = {
        'auth/email-already-in-use': 'Este nome de usu√°rio j√° est√° em uso!',
        'auth/invalid-email': 'Nome de usu√°rio inv√°lido!',
        'auth/operation-not-allowed': 'Opera√ß√£o n√£o permitida!',
        'auth/weak-password': 'Senha muito fraca! Use no m√≠nimo 6 caracteres.',
        'auth/user-disabled': 'Usu√°rio desabilitado!',
        'auth/user-not-found': 'Usu√°rio n√£o encontrado!',
        'auth/wrong-password': 'Senha incorreta!',
        'auth/invalid-credential': 'Credenciais inv√°lidas! Verifique seu usu√°rio e senha.',
        'auth/too-many-requests': 'Muitas tentativas. Aguarde um momento e tente novamente.'
    };
    return errors[errorCode] || 'Erro ao processar solicita√ß√£o. Tente novamente.';
}

function showElement(id) { document.getElementById(id).classList.add('visible'); }
function hideElement(id) { document.getElementById(id).classList.remove('visible'); }

function showError(id, message) {
    const el = document.getElementById(id);
    el.textContent = message;
    showElement(id);
    setTimeout(() => hideElement(id), 5000);
}

function showSuccess(id, message) {
    const el = document.getElementById(id);
    el.textContent = message;
    showElement(id);
}

function setButtonLoading(btnId, isLoading) {
    const btn = document.getElementById(btnId);
    btn.disabled = isLoading;
    if (isLoading) btn.innerHTML = '<span class="loading"></span>';
}

// Autentica√ß√£o
async function registerUser(username, displayName, password) {
    try {
        setButtonLoading('register-btn', true);
        
        const email = usernameToEmail(username);
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        await set(ref(database, 'users/' + user.uid), {
            username: username,
            displayName: displayName,
            createdAt: new Date().toISOString(),
            prayedDays: {},
            totalRosaries: 0,
            totalAves: 0,
            currentStreak: 0,
            longestStreak: 0
        });

        showSuccess('register-success', 'Conta criada com sucesso! Entrando...');
        
        setTimeout(() => {
            document.getElementById('register-form').reset();
            hideElement('register-success');
        }, 2000);

    } catch (error) {
        console.error('Erro no registro:', error);
        showError('register-error', getFirebaseErrorMessage(error.code));
    } finally {
        setButtonLoading('register-btn', false);
        document.getElementById('register-btn').textContent = 'Criar Conta';
    }
}

async function loginUser(username, password) {
    try {
        setButtonLoading('login-btn', true);
        const email = usernameToEmail(username);
        await signInWithEmailAndPassword(auth, email, password);
    } catch (error) {
        console.error('Erro no login:', error);
        showError('login-error', getFirebaseErrorMessage(error.code));
        setButtonLoading('login-btn', false);
        document.getElementById('login-btn').textContent = 'Entrar';
    }
}

async function logoutUser() {
    if (confirm('Deseja realmente sair?')) {
        try {
            await signOut(auth);
            document.querySelectorAll('.input-field').forEach(f => f.value = '');
        } catch (error) {
            console.error('Erro ao sair:', error);
            alert('Erro ao sair da conta. Tente novamente.');
        }
    }
}

// Auth State Observer
onAuthStateChanged(auth, async (user) => {
    if (user) {
        setButtonLoading('login-btn', false);
        document.getElementById('login-btn').textContent = 'Entrar';
        
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        
        // Carregar dados do usu√°rio
        const userRef = ref(database, 'users/' + user.uid);
        const snapshot = await get(userRef);
        if (snapshot.exists()) {
            window.userProfile = snapshot.val();
            window.currentUser = user;
            
            // Atualizar UI do perfil
            const displayName = snapshot.val().displayName || snapshot.val().username;
            document.getElementById('profile-name').textContent = displayName;
            document.getElementById('profile-avatar').textContent = displayName.charAt(0).toUpperCase();
        }
    } else {
        document.getElementById('main-app').classList.add('hidden');
        document.getElementById('auth-screen').classList.remove('hidden');
        window.userProfile = null;
        window.currentUser = null;
    }
});

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
    // Auth tabs
    document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab + '-form').classList.add('active');
        });
    });

    // Login form
    document.getElementById('login-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value;
        loginUser(username, password);
    });

    // Register form
    document.getElementById('register-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('register-username').value.trim();
        const displayName = document.getElementById('register-displayname').value.trim();
        const password = document.getElementById('register-password').value;
        const confirm = document.getElementById('register-confirm').value;
        
        if (password !== confirm) {
            showError('register-error', 'As senhas n√£o coincidem!');
            return;
        }
        
        if (username.length < 3) {
            showError('register-error', 'Nome de usu√°rio muito curto! Use no m√≠nimo 3 caracteres.');
            return;
        }
        
        registerUser(username, displayName, password);
    });

    // Navega√ß√£o de tabs
    document.querySelectorAll('.nav-item[data-tab]').forEach(btn => {
        btn.addEventListener('click', () => {
            // Atualizar nav items
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            btn.classList.add('active');
            
            // Atualizar tab contents
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
        });
    });

    // Bot√£o Ros√°rio na navbar - inicia ros√°rio do dia
    document.getElementById('nav-rosary-btn').addEventListener('click', () => {
        const today = new Date().getDay();
        const dayMap = { 0: 'gloriosos', 1: 'gozosos', 2: 'dolorosos', 3: 'gloriosos', 4: 'gozosos', 5: 'dolorosos', 6: 'gozosos' };
        const todayRosary = dayMap[today];
        if (window.app && window.app.start) {
            window.app.start(todayRosary);
        }
    });
});

// Exportar fun√ß√µes globalmente
window.firebaseAuth = { logoutUser };
</script>

<script>
// ===== SISTEMA DE √ÅUDIO INTERATIVO =====
const AudioSystem = {
    ctx: null,
    enabled: false,
    
    init() {
        if (!this.ctx) {
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (this.ctx.state === 'suspended') this.ctx.resume();
    },
    
    // Som de conta - madeira/pedra suave
    playBead(type = 'ave') {
        if (!this.enabled) return;
        this.init();
        
        const now = this.ctx.currentTime;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        const filter = this.ctx.createBiquadFilter();
        
        filter.type = 'lowpass';
        osc.type = 'sine';
        
        if (type === 'pater') {
            // Som mais rico e ressonante para Pai Nosso
            osc.frequency.setValueAtTime(200, now);
            osc.frequency.exponentialRampToValueAtTime(100, now + 0.2);
            filter.frequency.setValueAtTime(900, now);
            gain.gain.setValueAtTime(0.18, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.35);
        } else if (type === 'special') {
            // Som cristalino para contas especiais
            osc.frequency.setValueAtTime(280, now);
            osc.frequency.exponentialRampToValueAtTime(140, now + 0.15);
            filter.frequency.setValueAtTime(700, now);
            gain.gain.setValueAtTime(0.14, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.25);
        } else {
            // Som suave de madeira para Ave Maria
            osc.frequency.setValueAtTime(160, now);
            osc.frequency.exponentialRampToValueAtTime(80, now + 0.12);
            filter.frequency.setValueAtTime(550, now);
            gain.gain.setValueAtTime(0.12, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.18);
        }
        
        osc.connect(filter);
        filter.connect(gain);
        gain.connect(this.ctx.destination);
        
        osc.start(now);
        osc.stop(now + 0.4);
        
        // Adiciona textura de toque
        this.addClickTexture(type);
    },
    
    addClickTexture(type) {
        const now = this.ctx.currentTime;
        const bufferSize = this.ctx.sampleRate * 0.04;
        const noiseBuffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
        const data = noiseBuffer.getChannelData(0);
        
        for (let i = 0; i < bufferSize; i++) {
            data[i] = (Math.random() * 2 - 1) * 0.25 * (1 - i / bufferSize);
        }
        
        const noise = this.ctx.createBufferSource();
        noise.buffer = noiseBuffer;
        
        const noiseGain = this.ctx.createGain();
        const noiseFilter = this.ctx.createBiquadFilter();
        
        noiseFilter.type = 'bandpass';
        noiseFilter.frequency.setValueAtTime(type === 'pater' ? 2500 : 3500, now);
        noiseFilter.Q.setValueAtTime(1, now);
        
        const vol = type === 'pater' ? 0.1 : 0.06;
        noiseGain.gain.setValueAtTime(vol, now);
        noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.04);
        
        noise.connect(noiseFilter);
        noiseFilter.connect(noiseGain);
        noiseGain.connect(this.ctx.destination);
        
        noise.start(now);
    },
    
    // Som de sino ao iniciar
    playBell() {
        if (!this.enabled) return;
        this.init();
        
        const now = this.ctx.currentTime;
        const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5
        
        frequencies.forEach((freq, i) => {
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            
            osc.frequency.setValueAtTime(freq, now);
            osc.type = 'sine';
            
            const startTime = now + i * 0.12;
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.1 / (i + 1), startTime + 0.06);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + 2.5);
            
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 3);
        });
    },
    
    // Som de conclus√£o - acorde ascendente
    playComplete() {
        if (!this.enabled) return;
        this.init();
        
        const now = this.ctx.currentTime;
        const notes = [261.63, 329.63, 392, 523.25]; // C4, E4, G4, C5
        
        notes.forEach((freq, i) => {
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            
            osc.frequency.setValueAtTime(freq, now);
            osc.type = 'sine';
            
            const startTime = now + i * 0.18;
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.12, startTime + 0.06);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + 2);
            
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 2.5);
        });
    },
    
    toggle() {
        this.enabled = !this.enabled;
        return this.enabled;
    }
};

// ===== TEXTOS DAS ORA√á√ïES =====
const TEXTS = {
    cross: `Em nome do Pai, e do Filho, e do Esp√≠rito Santo. Am√©m.`,
    credo: `Creio em Deus Pai todo-poderoso, Criador do C√©u e da terra; e em Jesus Cristo, seu √∫nico Filho, Nosso Senhor, que foi concebido pelo poder do Esp√≠rito Santo; nasceu da Virgem Maria; padeceu sob P√¥ncio Pilatos, foi crucificado, morto e sepultado; desceu √† mans√£o dos mortos; ressuscitou ao terceiro dia; subiu aos C√©us; est√° sentado √† direita de Deus Pai todo-poderoso, de onde h√° de vir a julgar os vivos e os mortos. Creio no Esp√≠rito Santo; na Santa Igreja Cat√≥lica; na comunh√£o dos Santos; na remiss√£o dos pecados; na ressurrei√ß√£o da carne; na vida eterna. Am√©m.`,
    pater: `Pai nosso que estais nos C√©us, santificado seja o vosso Nome, venha a n√≥s o vosso Reino, seja feita a vossa vontade assim na terra como no C√©u. O p√£o nosso de cada dia nos dai hoje, perdoai-nos as nossas ofensas assim como n√≥s perdoamos a quem nos tem ofendido, e n√£o nos deixeis cair em tenta√ß√£o, mas livrai-nos do Mal. Am√©m.`,
    ave: `Ave Maria, cheia de gra√ßa, o Senhor √© convosco, bendita sois v√≥s entre as mulheres e bendito √© o fruto do vosso ventre, Jesus. Santa Maria, M√£e de Deus, rogai por n√≥s pecadores, agora e na hora da nossa morte. Am√©m.`,
    gloria: `Gl√≥ria ao Pai, e ao Filho, e ao Esp√≠rito Santo. Assim como era no princ√≠pio, agora e sempre, e por todos os s√©culos dos s√©culos. Am√©m.`,
    fatima: `√ì meu Jesus, perdoai-nos, livrai-nos do fogo do inferno, levai as almas todas para o C√©u, principalmente as que mais precisarem da vossa Miseric√≥rdia.`,
    salve: `Salve Rainha, M√£e de Miseric√≥rdia, vida, do√ßura e esperan√ßa nossa, salve! A v√≥s bradamos, os degredados filhos de Eva. A v√≥s suspiramos, gemendo e chorando neste vale de l√°grimas. Eia pois, advogada nossa, esses vossos olhos misericordiosos a n√≥s volvei. E depois deste desterro, mostrai-nos Jesus, bendito fruto do vosso ventre. √ì clemente, √≥ piedosa, √≥ doce sempre Virgem Maria. Rogai por n√≥s, Santa M√£e de Deus, para que sejamos dignos das promessas de Cristo. Am√©m.`
};

// ===== MEDITA√á√ïES MONTFORT =====
const MONTFORT = {
    intro: ["Em honra do Pai Eterno, que gera seu Filho contemplando-Se.", "Em honra do Verbo Eterno, igual ao Pai, que com Ele produz o Esp√≠rito Santo.", "Em honra do Esp√≠rito Santo, que procede do Pai e do Filho por via de amor."],
    gozosos: { name: "Mist√©rios Gozosos", mysteries: [
        { title: "A Anuncia√ß√£o do Anjo a Nossa Senhora", pater: "A caridade de Deus, imensa.", aves: ["Para lamentar o desgra√ßado estado de Ad√£o desobediente, sua justa condena√ß√£o e a de todos os seus filhos.", "Os desejos dos patriarcas e profetas, que pediam a vinda do Messias.", "Os desejos e as preces da Sant√≠ssima Virgem, que apressaram a vinda do Messias.", "A caridade do Pai Eterno, que nos deu Seu divino Filho.", "O amor do Filho, que se entregou por n√≥s.", "A embaixada e a sauda√ß√£o do arcanjo Gabriel.", "O temor virginal de Maria.", "A f√© e o consentimento da Sant√≠ssima Virgem.", "A cria√ß√£o da alma e a forma√ß√£o do Corpo de Jesus Cristo no seio de Maria, pelo Esp√≠rito Santo.", "A adora√ß√£o do Verbo Encarnado, pelos anjos, no seio de Maria."] },
        { title: "A Visita√ß√£o de Nossa Senhora a Santa Isabel", pater: "A majestade de Deus, ador√°vel.", aves: ["O gozo do Cora√ß√£o de Maria e a morada durante nove meses, do Verbo em seu seio.", "O sacrif√≠cio que Jesus Cristo fez de Si mesmo ao Pai, ao entrar neste Mundo.", "As complac√™ncias de Jesus no seio humilde e virginal de Maria, e de Nossa Senhora, no gozo do seu Deus.", "A d√∫vida de S√£o Jos√© acerca da maternidade de Maria.", "A elei√ß√£o dos escolhidos, combinada entre Jesus e Maria, em seu seio.", "O fervor de Maria na sua visita a Santa Isabel.", "A santifica√ß√£o de Jo√£o Batista no ventre de sua m√£e.", "A gratid√£o da Sant√≠ssima Virgem para com Deus, no Magnificat.", "A sua caridade e humildade em servir sua prima.", "A m√∫tua depend√™ncia de Jesus e de Maria, e a devo√ß√£o que devemos ter para com um e outra."] },
        { title: "O Nascimento de Jesus em Bel√©m", pater: "As riquezas de Deus, infinitas.", aves: ["Os desprezos e inj√∫rias feitas a Maria e a S√£o Jos√© em Bel√©m.", "A pobreza do est√°bulo onde Deus veio ao mundo.", "A alta contempla√ß√£o e o excessivo amor de Maria no momento de dar √† luz.", "A sa√≠da do Verbo Eterno do seio de Maria sem romper o selo de sua virgindade.", "As adora√ß√µes e c√¢nticos dos anjos no nascimento de Jesus.", "A formosura arrebatadora de Sua divina inf√¢ncia.", "A vinda dos pastores ao est√°bulo, com seus presentes.", "A circuncis√£o de Jesus Cristo e Suas dores amorosas.", "A imposi√ß√£o do nome de Jesus Cristo e suas grandezas.", "A adora√ß√£o dos reis magos e seus presentes."] },
        { title: "A Apresenta√ß√£o de Jesus no Templo", pater: "A sabedoria de Deus, eterna.", aves: ["A obedi√™ncia de Jesus e de Maria √† Lei.", "O sacrif√≠cio que ali fez Jesus de sua humanidade.", "O sacrif√≠cio que ali fez Maria de sua honra.", "O gozo e os c√¢nticos de Sime√£o e Ana, a profetisa.", "O resgate de Jesus pela oferenda de duas rolas.", "A matan√ßa dos santos inocentes.", "A fuga de Jesus para o Egito, pela obedi√™ncia de S√£o Jos√© √† voz do anjo.", "A estada misteriosa no Egito.", "A Sua volta para Nazar√©.", "O seu crescimento em idade, sabedoria e gra√ßa."] },
        { title: "O Encontro de Jesus no Templo", pater: "A santidade de Deus, incompreens√≠vel.", aves: ["A Sua vida oculta, laboriosa e obediente na casa de Nazar√©.", "A sua perda e encontro no Templo entre os doutores.", "O seu jejum e tenta√ß√µes no deserto.", "O seu Batismo por S√£o Jo√£o Batista.", "A sua prega√ß√£o admir√°vel.", "Os seus milagres portentosos.", "A elei√ß√£o de seus doze Ap√≥stolos e os poderes que lhes deu.", "A sua transfigura√ß√£o maravilhosa.", "O lava-p√©s dos Ap√≥stolos.", "A institui√ß√£o da Sagrada Eucaristia."] }
    ]},
    dolorosos: { name: "Mist√©rios Dolorosos", mysteries: [
        { title: "A Agonia de Jesus no Horto", pater: "A felicidade de Deus, essencial.", aves: ["Os divinos retiros que fez Jesus em Sua vida, principalmente no horto.", "As suas ora√ß√µes humildes e fervorosas durante Sua vida e nas v√©speras da Paix√£o.", "A paci√™ncia e do√ßura com que suportou Seus Ap√≥stolos, particularmente no horto.", "O t√©dio de sua Alma durante toda a Sua vida, principalmente no horto.", "Os rios de sangue que a dor fez brotar de seu Ser ador√°vel.", "O consolo que teve por bem aceitar de um anjo na agonia.", "A sua conformidade com a vontade do Pai, apesar da repugn√¢ncia de Sua natureza.", "A Sua trai√ß√£o por Judas e pris√£o pelos judeus.", "O valor com que saiu ao encontro dos algozes e a for√ßa da palavra com que os lan√ßou por terra.", "O abandono que sofreu de Seus Ap√≥stolos."] },
        { title: "A Flagela√ß√£o de Jesus", pater: "A paci√™ncia de Deus, admir√°vel.", aves: ["As cordas com que Jesus foi atado.", "A bofetada que recebeu em casa de Caif√°s.", "As nega√ß√µes de S√£o Pedro.", "As ignom√≠nias que sofreu em casa de Herodes, quando lhe puseram a veste branca.", "O despojamento de Suas vestes.", "Os desprezos e insultos que sofreu de seus verdugos pela Sua nudez.", "As varas espinhosas e os a√ßoites cru√©is com que foi golpeado.", "A coluna em que foi atado.", "O sangue que derramou e as chagas que recebeu.", "A Sua queda no pr√≥prio sangue por causa da fraqueza."] },
        { title: "A Coroa√ß√£o de Espinhos", pater: "A formosura de Deus, inef√°vel.", aves: ["O despojamento de Suas vestes pela terceira vez.", "A Sua coroa de espinhos.", "O v√©u com que Lhe vendaram os olhos.", "As bofetadas e os escarros com que Lhe cobriram o rosto.", "O andrajo que Lhe puseram sobre os ombros.", "A cana que Lhe puseram nas m√£os.", "A pedra pontiaguda sobre a qual O sentaram.", "Os ultrajes e os insultos que Lhe fizeram.", "O sangue e os suores que escorriam de Sua cabe√ßa ador√°vel.", "Os cabelos e a barba que Lhe arrancaram."] },
        { title: "Jesus Carrega a Cruz", pater: "A onipot√™ncia de Deus, sem limites.", aves: ["A apresenta√ß√£o de Nosso Senhor diante do povo com o 'Eis o Homem'.", "O haver sido preferido a Barrab√°s.", "Os falsos testemunhos que contra Ele deram.", "A Sua condena√ß√£o √† morte.", "O amor com que abra√ßou e beijou a Cruz.", "O trabalho espantoso que teve em carreg√°-la.", "As quedas de pura debilidade sob seu peso.", "O encontro doloroso com Sua Santa M√£e.", "O v√©u de Ver√¥nica, no qual Seu rosto se estampou.", "As suas l√°grimas, as de Sua Santa M√£e e das piedosas mulheres que O seguiram at√© o Calv√°rio."] },
        { title: "A Crucifica√ß√£o e Morte de Jesus", pater: "A justi√ßa de Deus, espantosa.", aves: ["As cinco chagas de Jesus e o sangue que derramou na Cruz.", "O seu cora√ß√£o traspassado e a Cruz em que foi crucificado.", "Os cravos e a lan√ßa que O atravessaram.", "A vergonha e a inf√¢mia que sofreu, sendo crucificado entre dois ladr√µes.", "A compaix√£o de Sua M√£e Sant√≠ssima.", "As sete √∫ltimas palavras.", "O seu desamparo e Seu sil√™ncio.", "A afli√ß√£o de todo o Universo.", "A Sua morte cruel e ignominiosa.", "A descida da Cruz e sepultamento."] }
    ]},
    gloriosos: { name: "Mist√©rios Gloriosos", mysteries: [
        { title: "A Ressurrei√ß√£o de Jesus", pater: "A eternidade de Deus, sem princ√≠pio.", aves: ["A descida da Alma de Nosso Senhor aos Infernos.", "O gozo e a sa√≠da das almas dos Santos Padres que estavam no limbo.", "A reuni√£o de Sua Alma e de Seu Corpo no sepulcro.", "A sua milagrosa sa√≠da do Sepulcro.", "As suas vit√≥rias sobre a morte, o pecado, o mundo e o dem√¥nio.", "Os quatro dons gloriosos de Seu Corpo.", "O poder que Lhe deu Seu pai no c√©u e na terra.", "As apari√ß√µes com que honrou Sua Santa M√£e.", "As conversa√ß√µes sobre o C√©u e a ceia que fez com Seus Ap√≥stolos.", "A autoridade e miss√£o que lhes deu, para que fossem pregar por toda a Terra."] },
        { title: "A Ascens√£o de Jesus ao C√©u", pater: "A imensidade de Deus, sem limites.", aves: ["A promessa que fez Jesus aos Ap√≥stolos de lhes enviar o Esp√≠rito Santo.", "A reuni√£o no Monte das Oliveiras.", "A ben√ß√£o que lhes deu ao se elevar da Terra aos C√©us.", "A Sua gloriosa e admir√°vel Ascens√£o por Sua pr√≥pria virtude at√© o C√©u Emp√≠reo.", "O recebimento e o triunfo que lhe fez Deus, Seu Pai, e toda a corte celestial.", "O poder triunfante com que abriu as portas do C√©u, onde nenhum mortal havia entrado.", "O seu assento √† direita do Pai, como Seu Filho querido, igual a Ele mesmo.", "O poder que Lhe deu de julgar os vivos e os mortos.", "A Sua √∫ltima vinda sobre a Terra, na qual Seu poder e majestade aparecer√£o em todo o seu esplendor.", "A justi√ßa que far√° no √∫ltimo Ju√≠zo, recompensando os bons e castigando os maus por toda a eternidade."] },
        { title: "A Vinda do Esp√≠rito Santo", pater: "A provid√™ncia de Deus, universal.", aves: ["A Verdade do Esp√≠rito Santo, Deus que procede do Pai e do Filho.", "O dom do Esp√≠rito Santo pelo Pai e pelo Filho sobre os Ap√≥stolos.", "O grande estrondo com que desceu, sinal de Sua for√ßa e Seu poder.", "As l√≠nguas de fogo que enviou sobre os Ap√≥stolos.", "A plenitude de gra√ßas com que distinguiu Maria, Sua fiel esposa.", "A Sua conduta maravilhosa, com os santos e com o pr√≥prio Jesus Cristo.", "Os doze frutos do Esp√≠rito Santo.", "Os sete dons do Esp√≠rito Santo.", "Para pedir em particular o dom da Sabedoria e a vinda de Seu reino aos cora√ß√µes.", "Para obter a vit√≥ria sobre os tr√™s esp√≠ritos que Lhe s√£o opostos: o esp√≠rito da carne, do mundo e do dem√¥nio."] },
        { title: "A Assun√ß√£o de Nossa Senhora", pater: "A liberalidade de Deus, inenarr√°vel.", aves: ["A predestina√ß√£o eterna de Maria, como obra-prima das m√£os de Deus.", "A Sua Concei√ß√£o Imaculada, a plenitude de gra√ßas e o uso da raz√£o no seio de sua m√£e.", "A Sua Natividade que regozijou todo o Universo.", "A Sua apresenta√ß√£o e sua vida no Templo.", "A Sua vida admir√°vel e isenta de todo pecado.", "A plenitude de suas virtudes singulares.", "A Sua virgindade fecunda e seu parto sem dor.", "A Sua maternidade divina e sua alian√ßa com a Sant√≠ssima Trindade.", "A Sua morte preciosa e cheia de amor.", "A Sua ressurrei√ß√£o e assun√ß√£o triunfante."] },
        { title: "A Coroa√ß√£o de Nossa Senhora", pater: "A gl√≥ria de Deus, inacess√≠vel.", aves: ["A tr√≠plice coroa com que a Sant√≠ssima Trindade coroou Maria.", "O gozo e a gl√≥ria nova que recebeu o C√©u por seu triunfo.", "Para reconhec√™-la como Rainha do C√©u e da Terra, dos anjos e dos homens.", "A tesoureira e dispensadora de todas as gra√ßas de Deus.", "A Medianeira e advogada dos homens.", "A destruidora e a ru√≠na do dem√¥nio e das heresias.", "O ref√∫gio seguro dos pecadores.", "A m√£e e nutriz dos crist√£os.", "A que √© gozo e do√ßura dos justos.", "A que √© asilo universal dos vivos, consolo todo-poderoso dos aflitos, dos moribundos e das almas do purgat√≥rio."] }
    ]}
};

// ===== APP =====
const app = {
    state: { type: null, beads: [], index: 0, showText: false },
    els: {},
    
    init() {
        this.els = {
            mainApp: document.getElementById('main-app'),
            prayer: document.getElementById('prayer-screen'),
            completion: document.getElementById('completion-screen'),
            track: document.getElementById('bead-track'),
            progressFill: document.getElementById('progress-fill'),
            progressText: document.getElementById('progress-text'),
            group: document.getElementById('prayer-group'),
            mystery: document.getElementById('prayer-mystery'),
            name: document.getElementById('prayer-name'),
            count: document.getElementById('prayer-count'),
            meditationBox: document.getElementById('meditation-box'),
            meditationText: document.getElementById('meditation-text'),
            textToggle: document.getElementById('prayer-text-toggle'),
            fullText: document.getElementById('prayer-full-text'),
            prevBtn: document.getElementById('prev-btn'),
            audioToggle: document.getElementById('audio-toggle'),
            audioIconOn: document.getElementById('audio-icon-on'),
            audioIconOff: document.getElementById('audio-icon-off')
        };
        this.setTodayInfo();
        this.setupGestures();
        this.setupKeyboard();
    },
    
    setTodayInfo() {
        const days = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
        const mysteries = { 0: 'Gloriosos', 1: 'Gozosos', 2: 'Dolorosos', 3: 'Gloriosos', 4: 'Gozosos', 5: 'Dolorosos', 6: 'Gozosos' };
        const d = new Date().getDay();
        document.getElementById('today-info').innerHTML = `Hoje √© <strong>${days[d]}</strong> ‚Äî Mist√©rios <strong>${mysteries[d]}</strong>`;
    },
    
    setupGestures() {
        let startY = 0;
        const body = document.getElementById('prayer-body');
        body.addEventListener('touchstart', e => { startY = e.touches[0].clientY; }, { passive: true });
        body.addEventListener('touchend', e => {
            if (!this.state.type) return;
            const dy = startY - e.changedTouches[0].clientY;
            if (Math.abs(dy) > 45) { if (dy > 0) this.next(); else this.prev(); }
        }, { passive: true });
        
        // Scroll wheel
        let wheelTimeout;
        window.addEventListener('wheel', e => {
            if (!this.state.type || wheelTimeout) return;
            if (e.deltaY > 0) this.next();
            else if (e.deltaY < 0) this.prev();
            wheelTimeout = setTimeout(() => { wheelTimeout = null; }, 180);
        }, { passive: true });
    },
    
    setupKeyboard() {
        document.addEventListener('keydown', e => {
            if (!this.state.type) return;
            if (['ArrowDown', 'ArrowRight', ' '].includes(e.key)) { e.preventDefault(); this.next(); }
            if (['ArrowUp', 'ArrowLeft'].includes(e.key)) { e.preventDefault(); this.prev(); }
            if (e.key === 'Escape') this.confirmExit();
            if (e.key.toLowerCase() === 't') this.toggleText();
            if (e.key.toLowerCase() === 'm') this.toggleAudio();
        });
    },
    
    toggleAudio() {
        const enabled = AudioSystem.toggle();
        this.els.audioToggle.classList.toggle('active', enabled);
        this.els.audioIconOn.style.display = enabled ? 'block' : 'none';
        this.els.audioIconOff.style.display = enabled ? 'none' : 'block';
        if (enabled) AudioSystem.playBell();
    },
    
    generateBeads(type) {
        const beads = []; let id = 0;
        const add = (beadType, name, textKey, meditation = '', meta = {}) => { beads.push({ id: id++, beadType, name, textKey, meditation, ...meta }); };
        
        add('special', 'Sinal da Cruz', 'cross', 'F√© na presen√ßa de Deus; F√© no Evangelho; F√© e obedi√™ncia ao Papa como Vig√°rio de Jesus Cristo.');
        add('special', 'Creio em Deus Pai', 'credo', 'Professamos nossa f√© no Deus Uno e Trino e em todos os artigos da Santa F√© Cat√≥lica.');
        add('pater', 'Pai Nosso', 'pater', 'Unidade de um s√≥ Deus, vivo e verdadeiro.');
        
        MONTFORT.intro.forEach((med, i) => { add('ave', 'Ave Maria', 'ave', med, { count: `${i + 1}¬™ Ave Maria ¬∑ Virtudes Teologais` }); });
        add('special', 'Gl√≥ria ao Pai', 'gloria', 'Damos gl√≥ria √† Sant√≠ssima Trindade.');
        
        let groups = type === 'completo' ? [MONTFORT.gozosos, MONTFORT.dolorosos, MONTFORT.gloriosos] : [MONTFORT[type]];
        
        groups.forEach(group => {
            group.mysteries.forEach((mystery, mIdx) => {
                const mysteryNum = mIdx + 1;
                add('pater', 'Pai Nosso', 'pater', mystery.pater, { group: group.name, mystery: mystery.title, count: `${mysteryNum}¬∫ Mist√©rio` });
                mystery.aves.forEach((med, aIdx) => { add('ave', 'Ave Maria', 'ave', med, { group: group.name, mystery: mystery.title, count: `${mysteryNum}¬™ Dezena ¬∑ ${aIdx + 1}¬™ Ave Maria` }); });
                add('special', 'Gl√≥ria ao Pai', 'gloria', '', { group: group.name, mystery: mystery.title, count: `${mysteryNum}¬™ Dezena` });
                add('special', 'Ora√ß√£o de F√°tima', 'fatima', 'Ora√ß√£o ensinada por Nossa Senhora aos pastorinhos de F√°tima.', { group: group.name, mystery: mystery.title, count: `${mysteryNum}¬™ Dezena` });
            });
        });
        
        add('special', 'Salve Rainha', 'salve', 'Saudemos a Rainha do C√©u e da Terra, nossa M√£e e Advogada.');
        return beads;
    },
    
    start(type) {
        this.state.type = type;
        this.state.beads = this.generateBeads(type);
        this.state.index = 0;
        this.state.showText = false;
        
        this.els.track.innerHTML = '';
        this.state.beads.forEach((bead, idx) => {
            const el = document.createElement('div');
            el.className = `bead ${bead.beadType}`;
            if (bead.beadType !== 'ave' && bead.beadType !== 'pater') el.classList.add('special');
            if (idx === 0) el.classList.add('active');
            el.onclick = () => this.goTo(idx);
            this.els.track.appendChild(el);
        });
        
        this.els.prayer.classList.add('active');
        AudioSystem.playBell();
        this.update();
    },
    
    goTo(idx) {
        if (idx >= 0 && idx < this.state.beads.length) {
            this.state.index = idx;
            this.update();
            AudioSystem.playBead(this.state.beads[idx].beadType);
        }
    },
    
    next() {
        if (this.state.index < this.state.beads.length - 1) {
            this.state.index++;
            this.update();
            AudioSystem.playBead(this.state.beads[this.state.index].beadType);
        } else {
            this.complete();
        }
    },
    
    prev() {
        if (this.state.index > 0) {
            this.state.index--;
            this.update();
            AudioSystem.playBead(this.state.beads[this.state.index].beadType);
        }
    },
    
    update() {
        const idx = this.state.index;
        const bead = this.state.beads[idx];
        const total = this.state.beads.length;
        
        const pct = ((idx + 1) / total) * 100;
        this.els.progressFill.style.width = `${pct}%`;
        this.els.progressText.textContent = `${idx + 1} / ${total}`;
        
        const animatedEls = [this.els.group, this.els.mystery, this.els.name, this.els.count, this.els.meditationBox];
        animatedEls.forEach(el => el.classList.remove('visible'));
        
        setTimeout(() => {
            this.els.group.textContent = bead.group || '';
            this.els.mystery.textContent = bead.mystery || '';
            this.els.name.textContent = bead.name;
            this.els.count.textContent = bead.count || '';
            this.els.meditationText.textContent = bead.meditation;
            this.els.fullText.innerHTML = `<p>${TEXTS[bead.textKey]}</p>`;
            
            if (!this.state.showText) {
                this.els.fullText.classList.remove('visible');
                this.els.textToggle.classList.remove('expanded');
                this.els.textToggle.querySelector('span').textContent = 'Ver texto da ora√ß√£o';
            }
            
            animatedEls.forEach(el => el.classList.add('visible'));
        }, 120);
        
        this.els.prevBtn.disabled = idx === 0;
        
        const beadEls = this.els.track.children;
        Array.from(beadEls).forEach(el => el.classList.remove('active'));
        beadEls[idx].classList.add('active');
        
        const activeEl = beadEls[idx];
        const beadCenter = activeEl.offsetTop + activeEl.offsetHeight / 2;
        this.els.track.style.transform = `translate(-50%, -${beadCenter}px)`;
    },
    
    toggleText() {
        this.state.showText = !this.state.showText;
        if (this.state.showText) {
            this.els.fullText.classList.add('visible');
            this.els.textToggle.classList.add('expanded');
            this.els.textToggle.querySelector('span').textContent = 'Ocultar texto';
        } else {
            this.els.fullText.classList.remove('visible');
            this.els.textToggle.classList.remove('expanded');
            this.els.textToggle.querySelector('span').textContent = 'Ver texto da ora√ß√£o';
        }
    },
    
    confirmExit() { if (confirm('Deseja realmente sair do Ros√°rio?')) this.home(); },
    
    home() {
        this.state.type = null;
        this.els.prayer.classList.remove('active');
        this.els.completion.classList.remove('active');
    },
    
    complete() {
        AudioSystem.playComplete();
        const aves = this.state.beads.filter(b => b.beadType === 'ave').length;
        const paters = this.state.beads.filter(b => b.beadType === 'pater').length;
        document.getElementById('stat-aves').textContent = aves;
        document.getElementById('stat-paters').textContent = paters;
        
        const msgs = {
            gozosos: 'Voc√™ completou os Mist√©rios Gozosos. Que a alegria de Maria esteja convosco.',
            dolorosos: 'Voc√™ completou os Mist√©rios Dolorosos. Que os sofrimentos de Cristo vos fortale√ßam.',
            gloriosos: 'Voc√™ completou os Mist√©rios Gloriosos. Que a gl√≥ria do C√©u vos aguarde.',
            completo: 'Voc√™ completou o Santo Ros√°rio inteiro! Que Nossa Senhora interceda por v√≥s.'
        };
        document.getElementById('completion-msg').textContent = msgs[this.state.type];
        
        this.els.prayer.classList.remove('active');
        this.els.completion.classList.add('active');
    }
};

app.init();
window.app = app;
</script>
</body>
</html>
